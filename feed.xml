<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>Alex Lu's Blog Feed</title>
        <link>https://op8867555.github.io</link>
        <description><![CDATA[Alex Lu's Blog Feed]]></description>
        <atom:link href="https://op8867555.github.io/feed.xml" rel="self"
                   type="application/rss+xml" />
        <lastBuildDate>Wed, 18 Apr 2018 00:00:00 UT</lastBuildDate>
        <item>
    <title>[en] Notes on Thinkpad X1 Carbon 2017 + Arch Linux</title>
    <link>https://op8867555.github.io/posts/2017-06-11-X1C5-notes.html</link>
    <description><![CDATA[<section id="changelogs" class="level3">
<h3>changelogs</h3>
<ul>
<li>2018/04/18 Saotoâ€™s trackpoint cap and fingerprinter status update.</li>
<li>2018/02/11 add a note for recall experience and thunderbolt 3 failures.</li>
<li>2018/01/12 update info.</li>
<li>2017/08/22 update kernel to 4.12; add a WWAN section.</li>
<li>2017/07/22 rewrite the post in English, remove some outdated information.</li>
</ul>
</section>
<section id="quick-summary" class="level1">
<h1>Quick Summary</h1>
<p>Iâ€™m running Arch Linux (kernel 4.15) on a Thinkpad X1 Carbon 5th Gen (X1C5).</p>
<p>Most stuff works out of box,</p>
<ul>
<li>wifi</li>
<li>backlit keyboard</li>
<li>LEDs on keyboard (caps lock/mute/mic mute)</li>
<li>TrackPoint - slow speed but works.</li>
<li>TrackPad - not so precise but works.</li>
<li>USB-C - USB-C to HDMI / USB-C Hub<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote">I wrote a <a href="/posts/2017-07-21-adam-usb-c-dock.html">blog post</a> in Traditional Chinese ğŸ‡¹ğŸ‡¼ about the hub.<br />
<br />
</span></span> works.</li>
<li>Bluetooth - works with a FC30 game controller.</li>
<li>WWAN - works with ModemManager.</li>
<li>mini-Ethernet - works.</li>
<li>micro SD reader</li>
</ul>
<p>Things <em>partially</em> working,</p>
<ul>
<li>Fingerprint reader</li>
</ul>
<p>I havenâ€™t tried,</p>
<ul>
<li>Thunderbolt 3 <span><label for="sn-2" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="marginnote"> I confused usb-c with TB3, it turns out I donâ€™t have TB3 device.<br />
<br />
</span></span></li>
<li>hibernation - I donâ€™t setup a swap partition.</li>
</ul>
</section>
<section id="hardware" class="level1">
<h1>Hardware</h1>
<section id="trackpoint" class="level2">
<h2>TrackPoint</h2>
<section id="alps-or-elantech" class="level3">
<h3>ALPS or Elantech?</h3>
<p>X1C5 comes with two versions<span><label for="sn-3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="sidenote"><a href="https://patchwork.kernel.org/patch/9768231/" class="uri">https://patchwork.kernel.org/patch/9768231/</a><br />
<br />
</span></span> of TrackPoint: ALPS and Elantech. I confirmed mine has an Elantech one using <a href="http://pcsupport.lenovo.com/tw/zh/products/laptops-and-netbooks/thinkpad-x-series-laptops/thinkpad-x1-carbon-type-20hr-20hq/downloads/ds122148">TrackPointDetect.exe</a>.</p>
<pre><code>TouchPad-Flash Utility
2017-06-08 20:42:27
Command Line: &quot;C:\Users\alexlu\Desktop\FW_Updater_1.0.0.9\TrackPointDetect.exe&quot;
OS: 64-bit
Pst Vendor : Elan
[ERROR]: This TrackPoint is Elan (ID:03)</code></pre>
</section>
<section id="cursor-speed-trackpoint-cap" class="level3">
<h3>Cursor Speed &amp; TrackPoint Cap</h3>
<p>I used to take the plastic adapter<span><label for="sn-4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="sidenote"><img src="https://i.imgur.com/qyS29cDl.jpg" title="fig:" alt="The plastic adapter from previous Thinkpad" /><br />
<br />
</span></span> from my previous laptop - a Thinkpad E130 and trimmed a Soft Rim Cap to fit â€œSuper Low Profileâ€. <span><label for="sn-5" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="marginnote"> <img src="https://i.imgur.com/cxoY1AO.jpg" /> IMHO, a soft rim is <em>much better</em> than a soft dome.<br />
<br />
</span></span></p>
<p>I have switched to a 3d-printed rubber caps made by <a href="https://twitter.com/saoto28">Saoto</a>, it works really great.</p>
<p><img src="https://i.imgur.com/zJF2hz2.jpg" /></p>
<p>The cursor speed and acceleration gets much better.</p>
</section>
</section>
<section id="trackpad" class="level2">
<h2>TrackPad</h2>
<p>It works with libinput and pressure-based palm detection are functional. But it is still unresponsive to small movements for current release. <span><label for="sn-6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-6" class="margin-toggle"/><span class="sidenote"><a href="https://bugs.freedesktop.org/show_bug.cgi?id=98839" class="uri">https://bugs.freedesktop.org/show_bug.cgi?id=98839</a><br />
<br />
</span></span></p>
<p><span><label for="sn-7" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-7" class="margin-toggle"/><span class="marginnote"> There is a different device according to <a href="https://www.reddit.com/r/thinkpad/comments/6wimb8/doing_some_research_on_x1c5_touchpad_issues/">this thread</a>.<br />
<br />
</span></span></p>
<p><code>dmesg</code> output:</p>
<pre><code>rmi4_smbus 0-002c: registering SMbus-connected sensor
rmi4_f01 rmi4-00.fn01: found RMI device, manufacturer: Synaptics, product: TM3289-002, fw id: 2492434</code></pre>
</section>
<section id="fingerprint-reader" class="level2">
<h2>Fingerprint Reader</h2>
<p>X1C5 have a Validity Sensor 138a:0097. There is no fully-working driver for it at this moment.</p>
<p>There is an open source reverse engineered driver working in progress<span><label for="sn-8" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-8" class="margin-toggle"/><span class="sidenote"><a href="https://github.com/nmikhailov/Validity90" class="uri">https://github.com/nmikhailov/Validity90</a><br />
<br />
</span></span><span><label for="sn-9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-9" class="margin-toggle"/><span class="sidenote"><a href="https://bugs.freedesktop.org/show_bug.cgi?id=94536" class="uri">https://bugs.freedesktop.org/show_bug.cgi?id=94536</a><br />
<br />
</span></span>.</p>
<section id="partially-working-driver" class="level3">
<h3>Partially-Working Driver</h3>
<ul>
<li>Nikita Mikhailov(<span class="citation" data-cites="nmikhailov">@nmikhailov</span>) reverse-engineered how to use 0097 to verify fingerprint, but fingerprints need to be enrolled in Windows first.</li>
<li>Marco Trevisan(<span class="citation" data-cites="3v1n0">@3v1n0</span>) wrote a match-on-host driver<span><label for="sn-10" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-10" class="margin-toggle"/><span class="sidenote"><a href="https://github.com/3v1n0/libfprint" class="uri">https://github.com/3v1n0/libfprint</a><br />
<br />
</span></span> for 0090.</li>
<li>Aleksandr Saraikin(<span class="citation" data-cites="hrenod">@hrenod</span>) made a modification<span><label for="sn-11" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-11" class="margin-toggle"/><span class="sidenote"><a href="https://github.com/hrenod/libfprint" class="uri">https://github.com/hrenod/libfprint</a><br />
<br />
</span></span> for 0097 based on <span class="citation" data-cites="3v1n0">@3v1n0</span>â€™s work.</li>
</ul>
<p><span class="citation" data-cites="hrenod">@hrenod</span>â€™s fork make it possible to use 0097 to authenticate now. One just need to:</p>
<ol type="1">
<li>initialize the device and enroll fingerprints in Windows,</li>
<li>install <code>fprintd</code> and <span class="citation" data-cites="hrenod">@hrenod</span>â€™s <code>libfprint</code>,</li>
<li>do a fake enroll (ex. <code>fprintd-enroll</code>),</li>
<li>set up PAM rules.</li>
</ol>
</section>
</section>
<section id="wwan" class="level2">
<h2>WWAN</h2>
<p>X1C5 (WWAN) comes with a Sierra EM7455 LTE Modem (1199:9079).</p>
<p>It works out of box using latest ModemManager.</p>
</section>
<section id="thunderbolt-3" class="level2">
<h2>Thunderbolt 3</h2>
<section id="firmware-failures" class="level3">
<h3>Firmware Failures</h3>
<p>My X1C5â€™s usb-c port dies sometime after I plug-in and out my usb-c hub, it was unable to charge and connect any devices, and it sometimes just â€œrecoveredâ€ itself. I initially guess it is a hardware failure and sent the laptop once to repair center, but the technician canâ€™t reproduce the issue.</p>
<p>Later I found there is a new <a href="https://pcsupport.lenovo.com/us/zh/products/laptops-and-netbooks/thinkpad-x-series-laptops/thinkpad-x1-carbon-type-20hr-20hq/downloads/ds120382">Thunderbolt 3 firmware update</a>, which says it:</p>
<ul>
<li>Fixed an issue where system might not be charged after repeating AC plug-in and out.</li>
</ul>
<p>It is not happen again after firmware updated so far. Intel WTF.</p>
</section>
</section>
<section id="recall-for-loose-screws" class="level2">
<h2>Recall for loose screws</h2>
<p>Lenovo recently(2018/02/06) recalls X1C5 made before 2017/11 and Mine is unfortunately affected. I went to nearest Lenovo Service Center(around 4km) and it took 15~20 minutes for the technician to check. There is no loose screws at last.</p>
</section>
</section>
<section id="software" class="level1">
<h1>Software</h1>
<p>Iâ€™m using i3-gaps without a desktop environment.</p>
<section id="hardware-video-acceleration" class="level2">
<h2>Hardware Video Acceleration</h2>
<p>It is possible to use the integrated graphic card to decode/encode videos, and this helps power-saving a lot.</p>
<p><span><label for="sn-12" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-12" class="margin-toggle"/><span class="marginnote"> See this <a href="https://wiki.archlinux.org/index.php/Hardware_video_acceleration">article</a> on ArchWiki for more info.<br />
<br />
</span></span></p>
<p>There are two spec/implement/API: VAAPI (by Intel) and VDPAU (by Nvidia). Since most software supports VAAPI, I just need to install <code>libva-intel-driver</code> pacakge.</p>
</section>
<section id="libva-intel-driver" class="level2">
<h2>libva-intel-driver</h2>
<p>Current release version has a bug<span><label for="sn-13" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-13" class="margin-toggle"/><span class="sidenote"><a href="https://github.com/01org/intel-vaapi-driver/issues/297" class="uri">https://github.com/01org/intel-vaapi-driver/issues/297</a><br />
<br />
</span></span> when decoding VP9 videos, <code>libva-intel-driver-git</code> package should fixes that.</p>
</section>
<section id="chromium-vaapi" class="level2">
<h2>chromium-vaapi</h2>
<p>There is a VAAPI implementation for Chromium OS, and there is also a patch<span><label for="sn-14" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-14" class="margin-toggle"/><span class="sidenote"><a href="https://chromium-review.googlesource.com/c/chromium/src/+/532294" class="uri">https://chromium-review.googlesource.com/c/chromium/src/+/532294</a><br />
<br />
</span></span> to enable that on Linux. The <code>chromium-vaapi-bin</code> package on AUR provides prebuilt binary, or you can build <code>chromium-vaapi</code> by yourself (It takes about 6 hrs first time, you can use ccache to speed up if you want to build it more than one time).</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><a href="https://gist.github.com/gdamjan/141bb0def5f80257fae2b233ec16f3c2">gdamjanâ€™s Note</a></li>
<li><a href="http://fredrik.wendt.se/2017/04/26/lenovo-thinkpad-x1-carbon-5th-generation/">Fredrikâ€™s Note</a></li>
<li><a href="https://forums.lenovo.com/t5/forums/v3_1/forumtopicpage/board-id/tp02_en/thread-id/75464/page/29">discussion about TrackPad</a></li>
</ul>
</section>
<section id="outdated" class="level1">
<h1>Outdated</h1>
<p>These issues/tricks/workarounds are mostly outdated(linux kernel â‰¤ 4.12). Maybe I should just remove this section somedayâ€¦</p>
<section id="trackpoint-1" class="level2">
<h2>TrackPoint</h2>
<section id="issues" class="level3">
<h3>Issues</h3>
<ul>
<li><p>Recognized as a â€œPS/2 Generic Mouseâ€<br />
â‡’ No palm-detection during trackpoint use</p></li>
<li><p>Since kernel driver doesnâ€™t support the new trackpoint, both of sensitivity and speed arenâ€™t adjustable.<br />
â‡’ The default speed/sensitivity is too slow to use.</p></li>
</ul>
</section>
<section id="mark-it-as-a-pointing-stick" class="level3">
<h3>Mark it as a pointing stick</h3>
<p>I found I can making libinput treat the â€œPS/2 Generic Mouseâ€ as a trackpoint using a custom udev hwdb entry.</p>
<p><em>Note: this should not be used anymore once trackpoint gets kernel driver supports</em></p>
<pre><code>evdev:name:PS/2 Generic Mouse:dmi:*svnLENOVO*:pvrThinkPadX1Carbon5th*
  ID_INPUT_POINTINGSTICK=1</code></pre>
</section>
<section id="better-trackpoint-acceleration" class="level3">
<h3>Better TrackPoint Acceleration</h3>
<p>There is a <a href="https://bugs.freedesktop.org/show_bug.cgi?id=91369#c48">patch</a> which solves speed issue.</p>
<p>I get my trackpoint much usable by setting up:</p>
<ul>
<li><code>LIBINPUT_ATTR_TRACKPOINT_RANGE=10</code> in hwdb</li>
<li><code>xinput set-prop &quot;PS/2 Generic Mouse&quot; &quot;libinput Accel Speed&quot; -0.25</code> in my .xinitrc</li>
</ul>
</section>
</section>
<section id="trackpad-1" class="level2">
<h2>TrackPad</h2>
<p>The trackpad is <ins>able to</ins> use rmi4 over smbus for now(4.12).</p>
<p>Turn it on by creating a <code>psmouse.conf</code> in <code>/etc/modprobe.d/</code></p>
<pre><code>options psmouse synaptics_intertouch=1</code></pre>
<section id="palm-detection" class="level3">
<h3>Palm Detection</h3>
<ul>
<li>pressure-based palm-detection works great (libinput â‰¥ 1.8)</li>
<li>palm-detection during trackpoint use requires <a href="#mark-it-as-a-pointing-stick">mark it as a pointing stick</a>.</li>
</ul>
</section>
</section>
<section id="new-hotkeys" class="level2">
<h2>New Hotkeys</h2>
<p>Before linux-4.12, You needs <a href="https://patchwork.kernel.org/patch/9596129/">these</a> <a href="https://patchwork.kernel.org/patch/9596131/">patches</a> to get these buttons works.</p>
</section>
</section>]]></description>
    <pubDate>Wed, 18 Apr 2018 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-06-11-X1C5-notes.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>T-Digest æ¦‚å¿µç°¡ä»‹</title>
    <link>https://op8867555.github.io/posts/2018-04-09-tdigest.html</link>
    <description><![CDATA[<section>
<p>ç™¾åˆ†ä½æ•¸æ˜¯æ•˜è¿°æ€§çµ±è¨ˆä¸­ä¸€å€‹å¾ˆå¥½ç”¨çš„å·¥å…·ï¼Œåƒæ˜¯</p>
<ul>
<li>ç”¨ä¸­ä½æ•¸ä¾†ä»£è¡¨å°ç£äººçš„æ‰€å¾—</li>
<li>ç”¨ 75 ç™¾åˆ†ä½æ•¸ä¾†æ‰¾å‡ºå­¸æ¸¬å‰æ¨™çš„æˆç¸¾</li>
<li>ç”¨ 99.99 ç™¾åˆ†ä½æ•¸ä¾†æ‰¾å‡ºç‰¹åˆ¥çš„é¡§å®¢ï¼›æˆ–æ˜¯æ‰¾å‡ºç•°å¸¸çš„ä¼ºæœå™¨é€£ç·šç­‰ã€‚</li>
</ul>
<p>ä½†æ˜¯å› ç‚ºè¨ˆç®—ç›¸å°è¤‡é›œï¼Œåœ¨è³‡æ–™é‡éå¤§æ™‚å¾€å¾€ç„¡æ³•è¨ˆç®—ï¼Œ T-Digest æ˜¯ä¸€å€‹è¿‘ä¼¼å¤§é‡è³‡æ–™ä¸­ç™¾åˆ†ä½æ•¸çš„æ¼”ç®—æ³•ï¼Œé€™ç¯‡æ–‡ç« ç°¡å–®ä»‹ç´¹å…¶æƒ³æ³•ã€‚</p>
</section>
<section id="concepts" class="level1">
<h1>Concepts</h1>
<p>å‡è¨­æˆ‘å€‘ä»Šå¤©æœ‰å¾ˆå¤šæ•¸å­—ï¼Œèˆ‰ä¾‹ä¾†èªªé€™é‚Šæœ‰ 500 å€‹ -30 ~ 30 é–“çš„æ•¸å­—</p>
<p><span><label for="sn-1" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="marginnote"> é€™ç¨®åœ–ç¨±ç‚º Rug plot, å…¶ä¸­çš„æ¯ä¸€æ¢ç›´ç·šä»£è¡¨ä¸€å€‹æ•¸å­—ï¼Œå…¶ x è»¸æ˜¯å®ƒçš„å€¼ã€‚<br />
<br />
</span></span> <img src="/images/tdigest/numbers.svg" data-caption="1" /></p>
<p>æˆ‘å€‘å¯ä»¥ç”¨ Probabilistic Density Function(PDF) çš„å½¢å¼ä¾†è¡¨ç¤ºï¼š</p>
<p><span><label for="sn-2" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="marginnote"> æ©Ÿç‡å¯†åº¦å‡½æ•¸ï¼Œ<span class="math inline">\(PDF(x)\)</span> è¶Šé«˜è¡¨ç¤º <span class="math inline">\(x\)</span> ç™¼ç”Ÿçš„æ©Ÿç‡è¶Šé«˜ï¼Œå…¶é¢ç©åŠ ç¸½èµ·ä¾†æ˜¯ 100%<br />
<br />
</span></span></p>
<p><img src="/images/tdigest/dist.svg" /></p>
<p>75 ç™¾åˆ†ä½æ•¸å°±æ˜¯é¢ç©ä½” 75% æ™‚çš„ x åº§æ¨™ï¼š</p>
<p><img src="/images/tdigest/dist_75.svg" /></p>
<section id="centroid" class="level2">
<h2>Centroid</h2>
<p>ä½†æ˜¯é€™æ¨£è¦çŸ¥é“ 500 å€‹æ•¸å­—çš„é †åºæ‰èƒ½è¨ˆç®—ï¼Œé€™åœ¨æ•¸å­—éå¸¸å¤šçš„æ™‚å€™æ˜¯ä¸å®¹æ˜“çš„ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œè©¦è‘—å°‡ç”¨å¾ˆå°‘çš„æ•¸å­—ä¾†ä»£æ›¿ 500å€‹æ•¸å­—ï¼Œæ€éº¼åšå‘¢ï¼Ÿ</p>
<p><strong>å°‡é„°è¿‘çš„æ•¸å­—å€‘ç”¨å…©å€‹æ•¸å­—ä»£è¡¨ï¼š å¹³å‡å€¼è·Ÿå€‹æ•¸</strong> <span><label for="sn-3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="sidenote">åŸå§‹çš„è«–æ–‡ä¸­æ˜¯ç”¨ç¸½å’Œï¼Œä½†æ˜¯å…©è€…æ„ç¾©ç›¸åŒï¼Œå¯¦ä½œä¸Šç‚ºäº†æ•ˆç‡éƒ½æœƒé¸ç”¨å¹³å‡å€¼ã€‚<br />
<br />
</span></span></p>
<p>é€™æ¨£çš„ä¸€çµ„å¹³å‡å€¼è·Ÿå€‹æ•¸è¢«ç¨±ç‚º <em>Centroid</em> ï¼Œæˆ‘å€‘å¯ä»¥ç”¨å¥½å¹¾å€‹ centroid ä¾†ä»£æ›¿æ•´å€‹ PDF, <strong>T-Digest å°±æ˜¯åœ¨åšé€™ä»¶äº‹</strong>ã€‚</p>
<p><img src="/images/tdigest/centroids.svg" /></p>
<p>ç•¶ç„¶å¯ä»¥è‡ªç”±æ±ºå®šè¦ç”¨å¹¾å€‹ centroid ä¾†ä»£è¡¨</p>
<p><img src="/images/tdigest/centroids2.svg" /></p>
<p>è¨ˆç®—ç™¾åˆ†ä½æ•¸æ™‚å°±æ˜¯åªéœ€è¦å¾é€™äº› centroids ä¸­æ‰¾å‡ºå°æ‡‰ä½ç½®çš„é …ç›®ä¾†åšå…§æ’æ³•ã€‚</p>
<p><img src="/images/tdigest/centroids_pdf.svg" /></p>
</section>
<section id="clustering" class="level2">
<h2>Clustering</h2>
<p>å°‡å¾ˆå¤šæ•¸å­—ç”¨ä¸€å€‹æˆ–å¤šå€‹ centroids ä»£è¡¨çš„å‹•ä½œç¨±ç‚º <em>clustering</em>. æˆ‘å€‘çŸ¥é“ç•¶ä¸€å€‹ centroid ä»£è¡¨çš„æ•¸å­—è¶Šå¤šï¼Œæµå¤±çš„è³‡è¨Šä¹Ÿå°±è¶Šå¤šï¼Œä¹Ÿå°±è¶Šä¸ç²¾ç¢ºï¼Œå› æ­¤<strong>æ€éº¼ clustering å°±æ˜¯å½±éŸ¿æˆæ•ˆçš„ä¸€å€‹é‡é»</strong>ã€‚</p>
<p>T-Digest çš„ä½œæ³•æ˜¯æ§åˆ¶å„å€‹ centroid çš„å¤§å°ï¼Œåœ¨éœ€è¦ç²¾ç¢ºçš„éƒ¨ä»½ç”¨æ›´å¤š centroids ä¾†è¡¨é”ã€‚ç‚ºæ­¤è«–æ–‡æå‡ºäº†ä¸€å€‹å…¬å¼<span><label for="sn-4" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="marginnote"> <img src="/images/tdigest/k_q_function.svg" alt="k(q, Î´) çš„å‡½æ•¸åœ–å½¢" /><br />
<br />
</span></span>ä¾†å®šç¾©é€™å€‹è¡Œç‚ºï¼š</p>
<p><span class="math display">\[k(q, Î´) = Î´\left(\frac{sin^{-1}(2q - 1)}{Ï€} + \frac{1}{2}\right)\]</span></p>
<p>å…¶ä¸­ <span class="math inline">\(q\)</span> æ˜¯ quantile, <span class="math inline">\(Î´\)</span> æ˜¯å£“ç¸®ç‡åƒæ•¸ï¼Œè€Œ <span class="math inline">\(k(q, Î´)\)</span> è¡¨ç¤º <span class="math inline">\(q\)</span> æ‡‰è©²è¦ç”¨ç¬¬å¹¾å€‹ centroid è¡¨é”ã€‚å¯ä»¥å¾åœ–ä¸­çœ‹åˆ°åœ¨é è¿‘ <span class="math inline">\(q = 0\)</span> è·Ÿ <span class="math inline">\(q = 1\)</span> çš„æ™‚å€™ï¼Œ<span class="math inline">\(k\)</span> çš„è®Šå‹•å¾ˆå¤§ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘ç”¨æ¯”è¼ƒå¤šçš„ centroids ä¾†è¡¨ç¤ºã€‚ ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆå‘¢ï¼Ÿ</p>
<p>é€™æ˜¯å› ç‚ºå¤§éƒ¨åˆ†è¨ˆç®—ç™¾åˆ†ä½æ•¸æ™‚ï¼ŒçœŸæ­£é—œå¿ƒçš„é€šå¸¸æ˜¯ 1ã€0.1ã€99ã€99.9ã€99.99â€¦ç­‰å¾ˆæ¥µç«¯çš„ç™¾åˆ†ä½æ•¸ï¼Œç›¸è¼ƒä¹‹ä¸‹ä¸­é–“éƒ¨ä»½ä¸é‚£éº¼åœ¨æ„å…¶ç²¾ç¢ºç¨‹åº¦äº†ã€‚</p>
</section>
<section id="merge-and-the-rest" class="level2">
<h2>Merge and the rest â€¦</h2>
<p>é™¤äº†é€é clustering å»ºæ§‹ T-Digest ä¹‹å¤–ï¼Œè«–æ–‡ä¸­ä¹Ÿçµ¦äº†åˆä½µå…©å€‹ T-Digest çš„æ–¹æ³•ã€‚é€™å¸¶ä¾†äº†ä¸€å€‹å¾ˆå¤§çš„å¥½è™•ï¼šç•¶è³‡æ–™é»å¤ªå¤šæ™‚ï¼Œæˆ‘å€‘å¯ä»¥åˆ†çµ„è¨ˆç®— T-Digest ç„¶å¾Œåœ¨åˆä½µèµ·ä¾†ï¼Œé€™è®“å¹³è¡Œåˆ†æ•£è¨ˆç®—è®Šå¾—å¯èƒ½<span><label for="sn-5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="sidenote">å¾ˆé‡è¦çš„ä¸€é»æ˜¯ T-Digest çš„ merge éœ€è¦æ»¿è¶³çµåˆå¾‹æ‰èƒ½å®‰å…¨çš„ç”¨åœ¨å¹³è¡Œåˆ†æ•£çš„ç³»çµ±ä¸Šã€‚ä½†å¾ˆå¯æƒœçš„æ˜¯ï¼Œ T-Digest æ˜¯è¿‘ä¼¼æ¼”ç®—æ³•ï¼Œæ‰€ä»¥æ²’æœ‰çœŸæ­£çš„æ»¿è¶³çµåˆå¾‹ã€‚é›–ç„¶å¦‚æ­¤ï¼Œä»ç„¶å¯ä»¥åœ¨ä¸€å®šçš„èª¤å·®ä¹‹ä¸‹æ»¿è¶³é€™äº›æ¢ä»¶ï¼Œä¹Ÿä½¿å¾—å¯¦å‹™ä¸Šé‚„æ˜¯å¯è¡Œã€‚<br />
<br />
</span></span>ï¼Œä¹Ÿå°±æ˜¯ Divide and Conquer.</p>
<p>è«–æ–‡ä¸­å‰©ä¸‹çš„éƒ¨ä»½é™¤äº†è¨è«–æˆæ•ˆä¹‹å¤–ï¼Œé‚„çµ¦å‡ºäº†å¹¾å€‹å¯¦ç”¨çš„æ¼”ç®—æ³•ï¼š</p>
<ul>
<li>Trimmed Mean, ä¸€å€‹ quantile range ä¹‹é–“çš„å¹³å‡å€¼</li>
<li>Cumulative Density Function(CDF)</li>
<li>Inverse CDF</li>
</ul>
</section>
</section>
<section id="reference" class="level1">
<h1>Reference</h1>
<ul>
<li><a href="https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf">åŸå§‹è«–æ–‡</a></li>
<li><a href="https://blog.bcmeng.com/post/tdigest.html">TDigest ç®—æ³•åŸç†</a></li>
<li><a href="https://dataorigami.net/blogs/napkin-folding/19055451-percentile-and-quantile-estimation-of-big-data-the-t-digest">Percentile and Quantile Estimation of Big Data: The t-Digest</a></li>
</ul>
</section>]]></description>
    <pubDate>Thu, 12 Apr 2018 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2018-04-09-tdigest.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>åˆ°åº•ä»€éº¼æ˜¯ Bayesian</title>
    <link>https://op8867555.github.io/posts/2018-03-09-bayes.html</link>
    <description><![CDATA[<section>
<p>æœ€è¿‘åœ¨å…¬å¸å…§éƒ¨çš„è®€æ›¸æœƒè·ŸåŒäº‹ä¸€èµ·è®€äº†é€™æœ¬ã€ŒProbabilistic Programming and Bayesian Methods for Hackersã€ï¼Œçœ‹äº†å¾ˆä¹…è¦ºå¾—å……æ»¿è¨±å¤šç–‘æƒ‘ï¼Œæ²’æœ‰è¾¦æ³•æŠŠæ¦‚å¿µè·Ÿæ¦‚å¿µé€£çµèµ·ä¾†ï¼Œæ‰€ä»¥æˆ‘åœ¨é€™é‚Šè©¦è‘—ä»¥å¯«é€™ç¯‡æ–‡ç« çš„æ–¹å¼ä¾†å°æˆ‘è‡ªå·±è§£é‡‹ã€‚</p>
<p>å¦‚æœæœ‰ç™¼ç¾æ–‡ç« æ•˜è¿°æœ‰èª¤ï¼Œæˆ–æ˜¯æœ‰æ›´å¥½çš„æ•˜è¿°æ–¹å¼ï¼Œè«‹å‘Šè¨´æˆ‘ä¸€è²ï¼</p>
</section>
<section id="ä»€éº¼æ˜¯-bayes-theorem" class="level2">
<h2>ä»€éº¼æ˜¯ Bayesâ€™ Theorem</h2>
<p>Bayesâ€™ Theorem ä¾†è‡ªæ–¼æ¢ä»¶æ©Ÿç‡çš„å…¬å¼ï¼š <span class="math display">\[
P(A|B) = \frac{ \color{red}P(B|A) \color{black}\cdot \color{blue}P(A)}{\color{green}P(B)}
\]</span></p>
<ul>
<li>æˆ‘å€‘æœ‰å…©å€‹äº‹ä»¶<span class="math inline">\(A\)</span>ã€<span class="math inline">\(B\)</span></li>
<li><span class="math inline">\(\color{blue}P(A)\)</span>ã€<span class="math inline">\(\color{green}P(B)\)</span> æ˜¯ <span class="math inline">\(A\)</span> è·Ÿ <span class="math inline">\(B\)</span> ç¨è‡ªç™¼ç”Ÿçš„æ©Ÿç‡</li>
<li><span class="math inline">\(P(A|B)\)</span> åŠ <span class="math inline">\(\color{red}P(B|A)\)</span> åˆ†åˆ¥æ˜¯å·²çŸ¥ <span class="math inline">\(B\)</span> ä¹‹å¾Œ <span class="math inline">\(A\)</span> ç™¼ç”Ÿï¼Œä»¥åŠåéä¾†çš„æ©Ÿç‡ï¼Œåˆè¢«ç¨±ç‚º likelihood</li>
</ul>
</section>
<section id="æ€éº¼æ‡‰ç”¨-bayes-theorem" class="level2">
<h2>æ€éº¼æ‡‰ç”¨ Bayesâ€™ Theorem</h2>
<p>ç¶²è·¯ä¸Šæœ‰å¾ˆå¤šä¾‹å­ï¼š<a href="https://en.wikipedia.org/wiki/Bayes%27_theorem#Drug_testing">æª¢æ¸¬è—¥å“åæ‡‰</a>ã€<a href="https://brohrer.github.io/how_bayesian_inference_works.html">çŒœæ¸¬ä¸€å€‹äººçš„æ€§åˆ¥</a>ã€<a href="http://www.greenteapress.com/thinkbayes/html/thinkbayes004.html#sec27">æ‰¾å‡ºéª°å­é»æ•¸æ‡‰è©²ä¾†è‡ªå¹¾é¢éª°</a>ï¼Œé¡ä¼¼çš„ä¾‹å­å¾ˆå¤šï¼Œå°±æ˜¯å°‡å…©å€‹æ©Ÿç‡æ“ºåœ¨ä¸€èµ·ï¼Œç„¶å¾Œç”¨è§€å¯Ÿåˆ°çš„è­‰æ“šä¾†æ‰¾å‡ºå•é¡Œçš„ç­”æ¡ˆã€‚</p>
<p>æˆ‘å°±å·æ‡¶ä¸€ä¸‹ç›´æ¥å€Ÿç”¨ç¶­åŸºç™¾ç§‘çš„è—¥å“æª¢æ¸¬çš„ä¾‹å­ï¼š</p>
<ul>
<li>å‡è¨­æœ‰ 0.5% çš„äººä½¿ç”¨äº†é€™å€‹è—¥å“ï¼ˆ<span class="math inline">\(P(\text{User}) = 0.005\)</span>ï¼‰</li>
<li>è€Œè—¥ç‰©æ¸¬è©¦çš„æº–ç¢ºç‡æ˜¯ 99% ï¼ˆ<span class="math inline">\(P(\text{+} | \text{User}) = 0.99\)</span>ï¼‰</li>
</ul>
<p>é‚£éº¼ä¸€å€‹æ¸¬å‡ºè—¥ç‰©åæ‡‰çš„äººçœŸçš„æœ‰ä½¿ç”¨æ­¤è—¥ç‰©çš„æ©Ÿç‡æœ‰å¤šé«˜ï¼Ÿ</p>
<p><span class="math display">\[
\begin{aligned}
P({\text{User}}\mid {\text{+}})&amp;= {\frac {P({\text{+}}\mid {\text{User}})P({\text{User}})}{P(+)}}\\
&amp;={\frac {P({\text{+}}\mid {\text{User}})P({\text{User}})}{P({\text{+}}\mid {\text{User}})P({\text{User}})+P({\text{+}}\mid {\text{Non-user}})P({\text{Non-user}})}}\\[8pt]
&amp;={\frac {0.99\times 0.005}{0.99\times 0.005+0.01\times 0.995}}\\[8pt]
&amp;\approx 33.2\%
\end{aligned}
\]</span></p>
<!-- é€™é‚Šç”¨ [Monty Hall Problem][monty-hall-wiki][^monty-hall-prob] ä¾†èˆ‰ä¾‹ï¼š -->
<!--   * æˆ‘å€‘ç”¨ $P(A), P(B), P(C)$ ä¾†åˆ†åˆ¥è¡¨ç¤ºå¤§çæ±½è»Šåœ¨é–€A, é–€B, é–€Cå¾Œé¢çš„æ©Ÿç‡ -->
<!--   * æˆ‘å€‘å…ˆé¸äº†ä¸€æ‰‡é–€ï¼Œå‡è¨­é¸äº†é–€A -->
<!--   * $P(D)$ ä¾†è¡¨ç¤ºä¸»æŒäºº Monty æ‰“é–‹äº†**é–€B** è€Œä¸”å¾Œé¢æ²’æœ‰è»Šçš„æ©Ÿç‡ -->
<!-- ç›®æ¨™æ˜¯æ±‚å‡º $P(A|D), P(B|D), P(C|D)$ï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆå…ˆçŸ¥é“ likelihoodï¼š -->
<!--   * $P(D|A)$ å¦‚æœå¤§çåœ¨é–€Aå¾Œé¢ï¼Œä¸»æŒäººæœƒå¾ B è·Ÿ C ä¸­éš¨ä¾¿é¸ä¸€å€‹æ‰“é–‹ï¼Œæ‰€ä»¥æ©Ÿç‡æ˜¯ 50%ã€‚ -->
<!--   * $P(D|B)$ å¦‚æœå¤§çåœ¨é–€Bå¾Œé¢ï¼Œä¸»æŒäººå£“æ ¹å…’ä¸æœƒæ‰“é–‹å®ƒï¼Œæ‰€ä»¥æ©Ÿç‡ç‚º 0%ã€‚ -->
<!--   * $P(D|C)$å¦‚æœå¤§çåœ¨é–€Cå¾Œé¢ï¼Œä¸»æŒäººæ‰“é–‹é–€Bå¾Œï¼Œè£¡é¢çµ•å°æ²’æœ‰è»Šï¼Œæ‰€ä»¥æ©Ÿç‡çš†ç‚º 100%ã€‚ -->
<!-- ç„¶å¾Œåˆ—å‡º -->
<!-- $$ -->
<!-- \begin{aligned} -->
<!-- P(D|A) P(A) &= \frac{1}{2} \times \frac{1}{3} &= \frac{1}{6} \\ -->
<!-- P(D|B) P(B) &= 0 \times \frac{1}{3} &= 0 \\ -->
<!-- P(D|C) P(C) &= 1 \times \frac{1}{3} &= \frac{1}{3} -->
<!-- \end{aligned} -->
<!-- $$ -->
<!-- å› ç‚º $P(\mathit{H}|D) \propto P(D|\mathit{H}) P(\mathit{H}),\, \mathit{H} = A, B, C$ï¼Œ -->
<!-- æˆ‘å€‘ä¸å¿…è¨ˆç®— $P(D)$å°±å¯ä»¥å¾—å‡ºï¼š æ›åˆ°é–€Cä¸­ççš„æ©Ÿç‡æ˜¯ç¶­æŒé¸é–€Açš„å…©å€ï¼ -->
<!--
æˆ‘é€™é‚Šå€Ÿç”¨åŒäº‹åœ¨è®€æ›¸æœƒèˆ‰çš„ä¾‹å­ï¼š ä¸€æšé€£çºŒæ“²å‡ºæ­£é¢ 10 æ¬¡çš„ç¡¬å¹£æ˜¯å¦å…¬æ­£ï¼Œ
ç”¨ $FairCoin$ è¡¨ç¤ºå…¬æ­£ç¡¬å¹£å€¼å‡ºäº†æ­£é¢ï¼Œ$H10$ ä¾†è¡¨ç¤ºä¸€æšç¡¬å¹£é€£çºŒæ“²å‡º 10 æ¬¡æ­£é¢ã€‚
åœ¨é€™å€‹ä¾‹å­ä¸­ï¼Œ$P(FairCoin) = 0.5$ å°±æ˜¯å…ˆé©—æ©Ÿç‡ï¼Œè€Œæˆ‘å€‘è¦æ‰¾å‡º
$$
P(FairCoin | H10) = \frac{P(H10 | FairCoin)P(FairCoin)}{P(H10)}
$$
-->
</section>
<section id="bayesian-inference-for-parameter-estimation" class="level2">
<h2>Bayesian Inference for Parameter Estimation</h2>
<p>è·Ÿå‰é¢çš„ Bayesâ€™ Theoremä¸€æ¨£ï¼Œä½†æ˜¯é€™æ¬¡å°‡ç›®æ¨™æ”¹è®Šäº†ä¸€ä¸‹ï¼š ç”¨è­‰æ“š<span class="math inline">\(E\)</span>ï¼ˆtraining dataï¼‰ä¾†æ‰¾å‡ºæ¨¡å‹åƒæ•¸<span class="math inline">\(Î¸\)</span> çš„æ©Ÿç‡åˆ†ä½ˆ</p>
<p><span class="math display">\[\begin{darray}{rlc}
P(Î¸|E) &amp;=&amp; \frac{ \color{red}P(E|Î¸) \color{black}\cdot \color{blue}P(Î¸)}{\color{green}P(E)} \\[1em]
&amp;=&amp; \frac{ \color{red}P(E|Î¸) \color{black}\cdot \color{blue}P(Î¸)}{\color{green}\int_Î¸ P(E|Î¸&#39;) \cdot P(Î¸&#39;)\  dÎ¸&#39;}
\end{darray}\]</span></p>
<ul>
<li><span class="math inline">\(\color{blue}P(Î¸)\)</span> ç¨±ç‚ºå…ˆé©—æ©Ÿç‡ï¼Œä¹Ÿå°±æ˜¯å°æ–¼æŸäº‹ç‰©çš„çŒœæ¸¬ã€‚</li>
<li><span class="math inline">\(P(Î¸|E)\)</span> ç¨±ç‚ºå¾Œé©—æ©Ÿç‡ï¼Œä¹Ÿå°±æ˜¯è§€å¯Ÿåˆ° è­‰æ“šE ä¹‹å¾Œ H çš„æ¢ä»¶æ©Ÿç‡ã€‚</li>
<li><span class="math inline">\(\color{red}P(E|Î¸)\)</span> ç¨±ç‚º likelihood functionï¼Œæœ‰æ™‚æœƒå¯«æˆ <span class="math inline">\(L(Î¸|E)\)</span>ã€‚</li>
<li><span class="math inline">\(\color{green}P(E)\)</span> ç¨±ç‚º marginal likelihoodï¼Œæˆ–æ˜¯è­‰æ“š E äº‹ä»¶æ‰€ç™¼ç”Ÿçš„æ©Ÿç‡</li>
</ul>
</section>
<section id="æ€éº¼é€²è¡Œ-bayesian-inference" class="level2">
<h2>æ€éº¼é€²è¡Œ Bayesian Inferenceï¼Ÿ</h2>
<p>è·Ÿå‰é¢ä¸€æ¨£ï¼Œå»ºæ¨¡è€…éœ€è¦æŒ‡å®šå¥½ï¼š</p>
<ul>
<li>likelihood functionï¼Œä¹Ÿå°±æ˜¯æè¿°è³‡æ–™æ˜¯æ€éº¼ç”¢ç”Ÿçš„å‡½æ•¸ï¼Œ</li>
<li>priorï¼Œæè¿°æˆ‘å€‘å°ç›®æ¨™åƒæ•¸çš„å…ˆé©—çŸ¥è­˜ã€‚</li>
</ul>
<p>æˆ‘åœ¨ Stack Overflow <span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote"><a href="https://stackoverflow.com/questions/375913/how-can-i-profile-c-code-running-in-linux">How can I profile C++ code running in Linux?</a><br />
<br />
</span></span> ä¸Šé¢çœ‹åˆ°äº†ä¸€å€‹å° programmer å¾ˆæœ‰è¶£ï¼ˆä¹Ÿå¾ˆå¯¦ç”¨ï¼‰çš„æ‡‰ç”¨ï¼šæ‡‰ç”¨è²è‘‰æ–¯ä¾†åš profiling<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote">Profiling åœ¨è»Ÿé«”é–‹ç™¼ä¸ŠæŒ‡çš„æ˜¯åˆ†æç¨‹å¼çš„åŸ·è¡Œç‹€æ³ï¼Œä»¥æ‰¾å‡ºæ™‚é–“æˆ–æ˜¯è¨˜æ†¶é«”èŠ±è²»è¼ƒå¤šçš„ç‰‡æ®µä¾†é€²è¡Œæ”¹é€²ã€‚<br />
<br />
</span></span>ï¼</p>
<p>ç”¨é€™å€‹ä½œæ³•åªéœ€è¦ç”¨ debugger åŸ·è¡Œç¨‹å¼çš„æ™‚å€™ï¼Œä»»æ„ä¸­æ–·å€‹æ•¸æ¬¡ï¼Œç„¶å¾Œè§€å¯Ÿä¸­æ–·æ™‚çš„ call stackï¼Œæ‰¾çœ‹çœ‹è£¡é¢æœ‰æ²’æœ‰åè¦†å‡ºç¾çš„ function callã€‚</p>
<p>å‡è¨­æˆ‘å€‘è§€å¯Ÿåˆ°äº†ä¸€å€‹å¾ˆå¸¸å‡ºç¾çš„å‡½æ•¸ï¼Œå®ƒåœ¨ä¸­æ–· 10 æ¬¡ä¸­å‡ºç¾äº† 7 æ¬¡ï¼Œæˆ‘å€‘æƒ³çŸ¥é“å®ƒå‡ºç¾åœ¨ call stack çš„æ¯”ç‡ <span class="math inline">\(R\)</span>ï¼Œä¹Ÿå°±æ˜¯æ‰¾å‡ºï¼š</p>
<p><span><label for="sn-3" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="marginnote"> <span class="math inline">\(T\)</span> è¡¨ç¤ºå‡ºç¾åœ¨ call stack çš„æ¬¡æ•¸ï¼Œ <span class="math inline">\(F\)</span> è¡¨ç¤ºæ²’æœ‰å‡ºç¾çš„æ¬¡æ•¸<br />
<br />
</span></span></p>
<p><span class="math display">\[
P(R | T=7, F=3) = \frac{P(T=7, F=3 | R) P(R)}{P(T=7, F=3)}
\]</span></p>
<p>ç‚ºäº†åŒ–ç°¡è¨ˆç®—çš„è¤‡é›œåº¦ï¼ŒåŸæ–‡å°‡ <span class="math inline">\(R\)</span> åˆ†æˆ 10 ç¨®å¯èƒ½ <span class="math inline">\(0.1, 0.2, \cdots, 1.0\)</span>ã€‚<span><label for="sn-4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="sidenote">é€™æ˜¯ç‚ºäº†èˆ‰ä¾‹æ–¹ä¾¿ï¼Œå¯¦éš›ä¸Šå°±å¾—ä¹–ä¹–çš„å»ç®—ç©åˆ†äº†â€¦<br />
<br />
</span></span> æˆ‘å€‘ä¸çŸ¥é“é€™å€‹å‡½æ•¸å¯¦éš›ä¸Šçš„å‡ºç¾æ¯”ç‡ï¼Œæ‰€ä»¥æˆ‘å€‘ç”¨ Uniform Distribution ä½œç‚º Priorã€‚</p>
<p><span class="math display">\[P(R=r) = 0.1, \, r = 0.1, ..., 1.0\]</span></p>
<p>å› ç‚º <span class="math inline">\(R\)</span> æ˜¯é›¢æ•£çš„ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥ç®—å‡ºæ¯ä¸€å€‹ <span class="math inline">\(P(T=7, F=3 | R=r)\)</span> çš„æ•¸å€¼ï¼Œå‰›å¥½å°±æ˜¯ Binomial Distributionï¼š</p>
<p><span class="math display">\[P(T=t, F=f | R=r) = {t+f \choose t}\,r^{t}\,(1-r)^{f}\]</span></p>
<p><span><label for="sn-5" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="marginnote"> <img src="/images/bayes-pmf.svg" /><br />
<br />
</span></span> æ±‚å‡º <span class="math inline">\(P(R | T=7, F=3)\)</span> ä¹‹å¾Œï¼Œå¯ä»¥ç•«æˆåœ–ä¾†æª¢è¦–ã€æ‰¾å‡ºMAPã€æˆ–æ˜¯æœŸæœ›å€¼ã€‚å¾å³åœ–å¯ä»¥çœ‹åˆ°ï¼Œå¾Œé©—æ©Ÿç‡åˆ†ä½ˆçš„æœ€é«˜é»è½æ–¼ 0.7ï¼Œæˆ‘å€‘å¯ä»¥æ¯”è¼ƒå…©è€…çš„é¢ç©ï¼š</p>
<p><span class="math display">\[\begin{aligned}
  P(R | T=7, F=3, r = 0.7) \approx 30\% \\
  P(R | r = 0.7) \approx 10\%
  \end{aligned}\]</span></p>
<p>ä¹Ÿå°±æ˜¯åœ¨è§€å¯Ÿåˆ°äº†è­‰æ“šä¹‹å¾Œï¼Œ<span class="math inline">\(r = 0.7\)</span> çš„æ©Ÿç‡å¾ 10% æ›´æ–°åˆ° 30% äº†ï¼</p>
</section>
<section id="ä»€éº¼æ˜¯-likelihood-function" class="level2">
<h2>ä»€éº¼æ˜¯ likelihood functionï¼Ÿ</h2>
<p>å–®çœ‹ likelihood function <span class="math inline">\(P(E|Î¸)\)</span> çš„è©±ï¼Œæˆ‘è¦ºå¾—å¾ˆå¥‡æ€ªï¼Œä»€éº¼æ˜¯è§€å¯Ÿåˆ°å…ˆé©—Hå¾Œè­‰æ“šç™¼ç”Ÿçš„æ©Ÿç‡ï¼Ÿ</p>
<p>åœ¨ google äº†å¥½ä¸€æ®µæ™‚é–“ä¹‹å¾Œï¼Œæˆ‘èªç‚ºæ¯”è¼ƒå¥½çš„è§£é‡‹æ–¹æ³•æ˜¯ï¼Œ likelihood æ˜¯ã€Œå–å¾— è­‰æ“šB ä¾†è‡ªæ–¼æŸå€‹å…ˆé©— A çš„æ©Ÿç‡ã€çš„å‡½æ•¸ <span><label for="sn-6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-6" class="margin-toggle"/><span class="sidenote">Think Bayes çš„ <a href="http://www.greenteapress.com/thinkbayes/html/thinkbayes002.html#sec11">The diachronic interpretation</a><br />
<br />
</span></span><span><label for="sn-7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-7" class="margin-toggle"/><span class="sidenote"><a href="http://yenchic-blog.logdown.com/posts/182922-likelihood-function-myth">likelihood functionè¿·æ€</a><br />
<br />
</span></span>ï¼Œæ›å¥è©±èªªï¼Œå°±æ˜¯æè¿°è­‰æ“šï¼ˆè³‡æ–™ï¼‰æ˜¯å¦‚ä½•è¢«ç”¢ç”Ÿçš„ã€‚</p>
<p>ä¸€å€‹ç°¡å–®çš„ä¾‹å­æ˜¯ï¼ŒæŠ•æ“² <span class="math inline">\(N\)</span> æ¬¡æ­£é¢æ©Ÿç‡ç‚º <span class="math inline">\(p\)</span> çš„ç¡¬å¹£ï¼Œè§€å¯Ÿåˆ°çš„è³‡æ–™æœƒæ˜¯ã€Œ<span class="math inline">\(N\)</span>æ¬¡ è£¡é¢æœ‰ <span class="math inline">\(t\)</span> æ¬¡æ­£é¢ã€çš„è­‰æ“šï¼Œ likelihood function é€™æ™‚æœƒè¨‚æˆ <span class="math display">\[P(E|Î¸) = L(\underbrace{p}_{\text{åƒæ•¸}\, Î¸} | \underbrace{N, t}_{\text{è­‰æ“š} \, E}) = {N \choose t} {p}^t {(1 - p)}^{N - t}\]</span></p>
</section>
<section id="frequentist-vs.bayesian" class="level2">
<h2>Frequentist vs.Â Bayesian</h2>
<p>çµ±è¨ˆä¸Šæœ‰å…©å€‹æµæ´¾ï¼š</p>
<ul>
<li>Frequentist èªç‚ºæ©Ÿç‡å°±æ˜¯é »ç‡ï¼Œè€Œå»ºæ¨¡å°±æ˜¯å»æœ€å¤§åŒ– likelihood</li>
<li>Bayesian ä½¿ç”¨ä¸»è§€çš„å…ˆé©—çŸ¥è­˜ä¾†é€²è¡Œã€Œé æ¸¬ã€</li>
</ul>
<p>å…©è€…åœ¨è³‡æ–™é‡å¤ å¤§çš„æƒ…æ³æœƒå¾—åˆ°ä¸€æ¨£çš„ç­”æ¡ˆï¼Œä½†æ˜¯ Bayesian èƒ½åœ¨è³‡æ–™é‡ä¸å¤ å¤šæ™‚ï¼Œæ­é…å…ˆé©—çŸ¥è­˜ï¼Œåšå‡ºæ›´å¥½çš„é æ¸¬ã€‚</p>
</section>
<section id="è·Ÿ-sampling-çš„é—œä¿‚" class="level2">
<h2>è·Ÿ Sampling çš„é—œä¿‚</h2>
<p>æ‰¾å‡ºå¾Œé©—æ©Ÿç‡åˆ†ä½ˆçš„æ™‚å€™ï¼Œè¨ˆç®— Marginal likelihood æ˜¯ä¸€ä»¶å›°é›£çš„äº‹<span><label for="sn-8" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-8" class="margin-toggle"/><span class="sidenote"><a href="https://www.youtube.com/watch?v=EHqU9LE9tg8">Bayesian posterior sampling - YouTube</a><br />
<br />
</span></span><span><label for="sn-9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-9" class="margin-toggle"/><span class="sidenote"><a href="https://ocw.mit.edu/courses/sloan-school-of-management/15-097-prediction-machine-learning-and-statistics-spring-2012/lecture-notes/MIT15_097S12_lec15.pdf">15.097: Probabilistic Modeling and Bayesian Analysis</a><br />
<br />
</span></span>ï¼Œå°‘æ•¸ç‹€æ³ä¸‹å¯ä»¥åˆ©ç”¨æŒ‘é¸é©ç•¶çš„å…±è»›å…ˆé©—ä¾†åŒ–ç°¡è¨ˆç®—ï¼Œä½†æ˜¯å¤§å¤šæ•¸çš„æƒ…æ³ä¸‹æ˜¯è¾¦ä¸åˆ°çš„ã€‚</p>
<p>ä½†æ˜¯å› ç‚ºåœ¨å¾Œé©—æ©Ÿç‡åˆ†ä½ˆçš„æ™‚å€™ï¼Œå¸¸å¸¸ä¸éœ€è¦çŸ¥é“æº–ç¢º(exact)çš„åˆ†ä½ˆï¼Œæ–¼æ˜¯å¯ä»¥ç”¨å¾å¾Œé©—æ©Ÿç‡åˆ†ä½ˆæŠ½æ¨£ä¾†å–ä»£ã€‚</p>
<!-- ## ç‚ºä»€éº¼ä¸€å®šè¦ç®—å‡º marginal likelihoodï¼Ÿ -->
<!-- æ›å€‹å•æ³•ï¼Œæ—¢ç„¶ $P(Î¸ | E) \propto L(Î¸ | E)$ï¼Œç‚ºä»€éº¼ä¸ç›´æ¥ç”¨ likelihood ä¾†ä»£æ›¿ï¼Ÿ -->
</section>
<section id="æ€éº¼å¾å¾Œé©—æ©Ÿç‡åˆ†ä½ˆä¸­æŠ½æ¨£" class="level2">
<h2>æ€éº¼å¾å¾Œé©—æ©Ÿç‡åˆ†ä½ˆä¸­æŠ½æ¨£ï¼Ÿ</h2>
<p>ç´°ç¯€æˆ‘é›–æ²’æœ‰æ·±å…¥äº†è§£ï¼Œä½†æ˜¯å¤§æ¦‚æ˜¯åˆ©ç”¨ MCMC æˆ–æ˜¯ Metropolis æ¼”ç®—æ³•ä¾†åšï¼Œå¯ä»¥åƒè€ƒï¼š</p>
<ul>
<li>Probabilistic Programming and Bayesian Methods for Hackers æ›¸ä¸­çš„ Ch.4 æœ‰ç°¡å–®ä»‹ç´¹çˆ¬å±±æ³•çš„æ¦‚å¿µ</li>
<li><a href="http://twiecki.github.io/blog/2015/11/10/mcmc-sampling/">MCMC sampling for dummies</a> ä»‹ç´¹å¦‚ä½•æ‰‹å¯«ä¸€å€‹å¾Œé©—æ©Ÿç‡åˆ†ä½ˆçš„ sampler</li>
</ul>
</section>
<section id="probabilistic-programming" class="level2">
<h2>Probabilistic Programming?</h2>
<p>Probabilistic Programming æ˜¯ä¸€ç¨®ç”¨è»Ÿé«”å»ºç«‹æ©Ÿç‡æ¨¡å‹è·Ÿåˆ©ç”¨å®ƒå€‘é€²è¡Œ inference çš„æ–¹æ³•<span><label for="sn-10" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-10" class="margin-toggle"/><span class="sidenote">å‡ºè‡ª<a href="http://hakaru-dev.github.io/intro/probprog/">Hakaru çš„å®˜ç¶²</a><br />
<br />
</span></span>ï¼Œå¯¦ä½œä¸Šå¯èƒ½æ˜¯ä¸€é–€ç¨ç«‹çš„æ–°èªè¨€(DSL) æˆ–æ˜¯ä»¥ library çš„æ–¹å¼åµŒæ–¼æŸå€‹ General-Purpose çš„èªè¨€è£¡é¢ã€‚ä¸è«–æ˜¯ Frequentist æˆ–æ˜¯ Bayesian Inference éƒ½å¯ä»¥ç”¨é€™å€‹æ–¹æ³•å¯¦ä½œï¼Œä½†æ˜¯æ¯”è¼ƒå¸¸çœ‹åˆ° Bayesian Inference ä½¿ç”¨ã€‚</p>
<p>PyMC3 å°±æ˜¯ä¸€å€‹å¯¦ä½œ Probabilistic Programming çš„ Python libraryï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œå‰é¢çš„ profiling å•é¡Œå¯ä»¥ç”¨ PyMC3 è¡¨é”æˆï¼š</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> pymc3 <span class="im">as</span> pm</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="cf">with</span> pm.Model() <span class="im">as</span> model:</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="co"># prior</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">    r <span class="op">=</span> pm.Uniform(<span class="st">&#39;r&#39;</span>, <span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="co"># likelihood</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    res <span class="op">=</span> pm.Binomial(<span class="st">&#39;res&#39;</span>, <span class="dv">10</span>, r, observed<span class="op">=</span><span class="dv">7</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">    <span class="co"># sampling from posterior</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    trace <span class="op">=</span> pm.sample(<span class="dv">25000</span>)</a></code></pre></div>
</section>
<section id="å°çµ" class="level2">
<h2>å°çµ</h2>
<p>é›–ç„¶åœ¨å¯«é€™ç¯‡æ–‡ç« çš„éç¨‹ä¸­ï¼Œè§£æ±ºäº†æˆ‘å¿ƒä¸­ä¸å°‘çš„ç–‘æƒ‘ï¼Œä½†æ˜¯ä»ç„¶é‚„æ˜¯æœ‰è¨±å¤šä¼¼æ‡‚éæ‡‚ä¹‹è™•ï¼Œå¦‚æœæœ‰æ–°ç™¼ç¾çš„è©±æœƒå†æ›´æ–°é€™ç¯‡æ–‡ç« ã€‚</p>
</section>]]></description>
    <pubDate>Fri, 30 Mar 2018 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2018-03-09-bayes.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>æ©Ÿå™¨å¦‚ä½•è¨ˆç®—å¾®åˆ†/åå¾®åˆ†ï¼ˆä¸‹ï¼‰</title>
    <link>https://op8867555.github.io/posts/2018-01-11-autodiff-reverse-mode.html</link>
    <description><![CDATA[<section>
<p><a href="/posts/2017-12-17-autodiff.html">å‰ä¸€ç¯‡æ–‡ç« </a>çš„æœ€å¾Œä»‹ç´¹äº† Forward-Mode Automatic Differential é€™å€‹æ‡‰ç”¨ Chain Rule çš„æŠ€å·§ï¼Œé€™ä¸€ç¯‡è¦ä¾†ä»‹ç´¹ä¸€å€‹åéä¾†çš„ç‰ˆæœ¬ Reverse-Mode Automatic Differentialã€‚</p>
</section>
<section id="recap-forward-mode-ad" class="level1">
<h1>Recap: Forward-Mode AD</h1>
<p>è¨ˆç®— Foward-Mode AD çš„æ™‚å€™ï¼Œå‡è¨­è¦æ±‚ <span class="math inline">\(f(x, y) = sin(x) + x Ã— y\)</span> åœ¨ <span class="math inline">\((3, 1)\)</span> å° <span class="math inline">\(x\)</span> çš„åå¾®åˆ† <span class="math inline">\(\frac{\partial Y}{\partial x}\)</span>ï¼Œæˆ‘å€‘æœƒåƒé€™æ¨£ç”±ä¸Šåˆ°ä¸‹è¨ˆç®—ï¼š</p>
<p><span><label for="sn-1" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="marginnote"> <a href="https://upload.wikimedia.org/wikipedia/commons/a/a4/ForwardAccumulationAutomaticDifferentiation.png"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/ForwardAccumulationAutomaticDifferentiation.png/512px-ForwardAccumulationAutomaticDifferentiation.png" /></a> Forward-Mode AD åœ¨ <a href="https://en.wikipedia.org/wiki/Automatic_differentiation">Wikipedia</a> ä¸Šçš„ç¤ºæ„åœ–<br />
<br />
</span></span></p>
<p><span class="math display">\[\begin{array}{cl}
\frac{âˆ‚}{âˆ‚ x} x&amp;= 1\\[0.5em]
\frac{âˆ‚}{âˆ‚ x} sin(x) &amp;= cos(x) \\[0.5em]
\frac{âˆ‚}{âˆ‚ x} x \cdot y  &amp;= 1\\[0.5em]
\frac{âˆ‚}{âˆ‚ x} sin(x) + x \cdot y  &amp;= \frac{âˆ‚ sin(x)}{âˆ‚ x} +
\frac{âˆ‚ x \cdot y}{âˆ‚ x} = cos(x) + 1
\end{array}\]</span></p>
<p>ä¹Ÿå°±æ˜¯å¦‚æœä»Šå¤©æœ‰å€‹ <span class="math inline">\(f\)</span>ï¼Œè€Œå°‡ <span class="math inline">\(x_i\)</span> ä»¥å¤–çš„è¼¸å…¥éƒ½æ˜¯ç‚ºå¸¸æ•¸çš„è©±ï¼Œå¾—åˆ° <span class="math inline">\(f_{x_i} = g_1 \circ g_2 \circ \cdots \circ g_n\)</span>ï¼Œ</p>
<ol type="1">
<li>å¾ <span class="math inline">\(\frac{\partial x_i}{\partial x_i} = 1\)</span>ï¼Œä¸¦å°‡å…¶ä»–è®Šæ•¸ <span class="math inline">\(x_j\)</span> è¦–ç‚ºå¸¸æ•¸ï¼Œ</li>
<li>ç…§è‘—è®Šæ•¸<span class="math inline">\(x_i\)</span> çš„è¨ˆç®—éç¨‹è¨ˆç®— <span class="math inline">\(g(x_i)\)</span> çš„åå¾®åˆ†ï¼ˆé€™å€‹ä¾‹å­çš„ç¬¬ä¸€å€‹ <span class="math inline">\(g\)</span> æ˜¯ <span class="math inline">\(sin\)</span> æˆ–æ˜¯ <span class="math inline">\(x \cdot y\)</span>ï¼‰<span><label for="sn-2" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="marginnote"> æˆ‘å€‘å¯ä»¥å°‡ <span class="math inline">\(\cdot\)</span> çœ‹æˆ <span class="math inline">\(mul(x, y)\)</span>ï¼Œè€Œå› ç‚º <span class="math inline">\(y\)</span> è¢«è¦–ç‚ºå¸¸æ•¸ï¼Œæ‰€ä»¥åˆå¯ä»¥çœ‹æˆä¸€å€‹å–®è®Šæ•¸å‡½æ•¸ <span class="math inline">\(mul_{1}(x) = 1\)</span>ã€‚<br />
<br />
</span></span></li>
<li>æœ€å¾Œæ±‚å¾— <span class="math inline">\(\frac{\partial}{\partial x_i}f(..., x_i, ...)\)</span></li>
</ol>
<p>å¦‚æœè¦è¨ˆç®—æ¯å€‹è®Šæ•¸ <span class="math inline">\(x_i\)</span> çš„åå¾®åˆ†çš„è©±ï¼Œæˆ‘å€‘å°±å¿…é ˆé‡è¤‡é€™æ¨£çš„å‹•ä½œ <span class="math inline">\(N\)</span> æ¬¡ï¼Œè€Œè¨ˆç®—æ¢¯åº¦æ™‚å°±æœƒé‡åˆ°é€™å€‹å›°å¢ƒã€‚</p>
</section>
<section id="reverse-mode-ad" class="level1">
<h1>Reverse-Mode AD</h1>
<p>Reverse-Mode AD å‰‡æ˜¯åéä¾†è¨ˆç®—ï¼š</p>
<p><span><label for="sn-3" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="marginnote"> <a href="https://commons.wikimedia.org/wiki/File%3AReverseaccumulationAD.png"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a0/ReverseaccumulationAD.png" /></a> Rerverse-Mode AD åœ¨ <a href="https://en.wikipedia.org/wiki/Automatic_differentiation">Wikipedia</a> ä¸Šçš„ç¤ºæ„åœ–<br />
<br />
</span></span></p>
<p><span class="math display">\[\begin{array}{cll}
\frac{âˆ‚ Y}{âˆ‚ Y} &amp;= \frac{âˆ‚ Y}{âˆ‚ sin(x) + x \cdot y} &amp;= 1 \\[0.5em]
\frac{âˆ‚ Y}{âˆ‚ sin(x)} &amp;=
\frac{âˆ‚ Y}{âˆ‚ sin(x) + x \cdot y}\frac{âˆ‚ sin(x) + x \cdot y}{âˆ‚ sin(x)} &amp;=
1 \cdot 1
\\[0.5em]
\frac{âˆ‚ Y}{âˆ‚ x \cdot y} &amp;=
\frac{âˆ‚ Y}{âˆ‚ sin(x) + x \cdot y}\frac{âˆ‚ sin(x) + x \cdot y}{âˆ‚ x \cdot y} &amp;=
1 \cdot 1
\\[0.5em]
\frac{âˆ‚ Y}{âˆ‚ x} &amp;=
\frac{âˆ‚ Y}{âˆ‚ sin(x)}\frac{âˆ‚ sin(x)}{âˆ‚ x} +
\frac{âˆ‚ Y}{âˆ‚ x \cdot y}\frac{âˆ‚ x \cdot y}{âˆ‚ x} &amp;=
1 \cdot cos(x) + 1 \cdot y
\\[0.5em]
\frac{âˆ‚ Y}{âˆ‚ y} &amp;=
\frac{âˆ‚ Y}{âˆ‚ x \cdot y}\frac{âˆ‚ x \cdot y}{âˆ‚ y} &amp;=
1 \cdot x
\end{array}\]</span></p>
<p>Forward-Mode AD å¾ <span class="math inline">\(\frac{âˆ‚ \color{red}x}{âˆ‚ x} = 1\)</span> é–‹å§‹<strong>çµ„åˆ</strong>ï¼Œåˆ° <span class="math inline">\(\frac{âˆ‚ \color{red}Y}{âˆ‚ x}\)</span> çµæŸï¼› Reverse-Mode AD å¾ <span class="math inline">\(\frac{âˆ‚ Y}{âˆ‚ \color{red}Y} = 1\)</span> é–‹å§‹<strong>åˆ†è§£</strong>ï¼Œåˆ° <span class="math inline">\(\frac{âˆ‚ Y}{âˆ‚ \color{red}x}\)</span> çµæŸã€‚</p>
<section id="back-propagation" class="level2">
<h2>Back Propagation</h2>
<p><span><label for="sn-4" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="marginnote"> <a href="/images/autodiff-neuron.svg"><img src="/images/autodiff-neuron.svg" /></a> é¡ç¥ç¶“çš„ç¥ç¶“å…ƒç¤ºæ„åœ–<br />
<br />
</span></span></p>
<p>æ‰€ä»¥é€™æ˜¯å¦‚ä½•è·Ÿé¡ç¥ç¶“ç¶²è·¯é—œè¯æ¥ä¸€èµ·çš„ï¼Ÿä¸€å€‹ç°¡å–®çš„é¡ç¥ç¶“ç¶²è·¯<span><label for="sn-5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="sidenote">ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘çœå»äº† Bias term <span class="math inline">\(b^{(l)}\)</span>ã€‚<br />
<br />
</span></span>å¯ä»¥é€™æ¨£è¡¨ç¤º<span><label for="sn-6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-6" class="margin-toggle"/><span class="sidenote">æˆ‘é€™é‚Šä½¿ç”¨ <span class="math inline">\(a\)</span> è¡¨ç¤º summation, <span class="math inline">\(z\)</span> è¡¨ç¤º activation çš„è¼¸å‡ºï¼Œæœ‰äº›æ–‡ç« æœƒæ¡ç”¨åéä¾†çš„è¡¨ç¤ºæ–¹å¼ã€‚<br />
<br />
</span></span>ï¼š</p>
<p><span class="math display">\[\begin{aligned}
a_i^{(1)} &amp;= \sum_j w^{(1)}_{ij} \cdot x_i
&amp; z_i^{(1)} &amp;= f(a_i^{(1)}) \\
a_i^{(2)} &amp;= \sum_j w^{(2)}_{ij} \cdot z_j^{(1)}
&amp; z_1^{(2)} &amp;= f(a_i^{(2)}) \\
&amp;\cdots &amp; &amp; \cdots \\
a_i^{(l)} &amp;= \sum_j w^{(l)}_{ij} \cdot z_j^{(l-1)}
 &amp;z_i^{(l)} &amp;= f(a_i^{(l)})
\end{aligned}\]</span></p>
<p>æ¥è‘—æˆ‘å€‘æœƒå®šç¾© cost function (æˆ–ç¨±ç‚º loss function)ï¼Œæ¯”æ–¹èªª Mean Squared Errorï¼š</p>
<p><span class="math display">\[C(Y, \hat Y) = \frac{1}{n} \sum_i^n \left(Y_i - \hat{Y}_i\right)^2\]</span></p>
<p>é¡ç¥ç¶“çš„ Forward Propagation å°±æ˜¯å¸¶å…¥è³‡æ–™ <span class="math inline">\(X\)</span> è·Ÿæ¬Šé‡ <span class="math inline">\(w\)</span> è¨ˆç®—å‡ºé æ¸¬å€¼ <span class="math inline">\(z_i^{(l)}\)</span>ï¼Œè€Œ Back Propagation å°±æ˜¯åˆ©ç”¨ cost ä¾†æ‰¾å‡ºä¸€çµ„æ›´å¥½ <span class="math inline">\(w_{ij}\)</span> ä¾†ä½¿çš„ <span class="math inline">\(C\)</span> æ›´å°ã€‚</p>
<p>æ€éº¼åšï¼Ÿå¾ <span class="math inline">\(\frac{âˆ‚ C}{âˆ‚ \color{red}C} = 1\)</span> é–‹å§‹ã€ <span class="math inline">\(\frac{âˆ‚ C}{âˆ‚ \color{red}z_i^{(l)}}, \frac{âˆ‚ C}{âˆ‚ \color{red}a_i^{(l)}}, \frac{âˆ‚ C}{âˆ‚ \color{red}w_{ij}^{(l)}}, \frac{âˆ‚ C}{âˆ‚ \color{red}z_i^{(l-1)}} ...\frac{âˆ‚ C}{âˆ‚ \color{red}a_i^{(1)}}\)</span>ï¼Œæœ€å¾Œç®—åˆ° <span class="math inline">\(\frac{âˆ‚ C}{âˆ‚ \color{red}w_{ij}^{(1)}}\)</span>ï¼Œæ±‚å‡ºæ¯ä¸€å€‹ <span class="math inline">\(\frac{âˆ‚ C}{âˆ‚ w_{ij}}\)</span> ä¹‹å¾Œæˆ‘å€‘å°±å¯ä»¥åˆ©ç”¨ Gradient Descent æ³•ä¾†æ‰¾å‡ºæ›´å¥½çš„ <span class="math inline">\(w_{ij}\)</span></p>
<p><span class="math display">\[w_{ij} \leftarrow w_{ij} - \eta \frac{âˆ‚ C}{âˆ‚ w_{ij}}\]</span></p>
<p>æ³¨æ„åˆ°äº†å—ï¼Ÿé€™è·Ÿå‰é¢æ‰€æ•˜è¿°çš„ Reverse-Mode AD æ˜¯<strong>ä¸€æ¨£çš„è¨ˆç®—éç¨‹</strong>ï¼Œé€™ä»£è¡¨æˆ‘å€‘å¯ä»¥åˆ©ç”¨å®ƒä¾†å–ä»£<span><label for="sn-7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-7" class="margin-toggle"/><span class="sidenote">Back Propagation è·Ÿ AD éƒ½æ‡‰ç”¨äº† chain rule ä¾†è¨ˆç®—ï¼Œä¸åŒçš„æ˜¯ä½¿ç”¨ AD çš„æŠ€å·§å¾Œä¸å†éœ€è¦æ¨å°å…¬å¼ã€‚<br />
<br />
</span></span>æ‰‹å‹•æ¨å°çš„ Back Propagation æ¼”ç®—æ³•ã€‚</p>
</section>
<section id="ç‚ºä»€éº¼é¡ç¥ç¶“è¦ç”¨-reverse-mode-ad" class="level2">
<h2>ç‚ºä»€éº¼é¡ç¥ç¶“è¦ç”¨ Reverse-Mode AD?</h2>
<p>Jacobian matrix æ˜¯ä¸€å€‹ <span class="math inline">\(f: â„^n \rightarrow â„^m\)</span> çš„æ‰€æœ‰åå°æ•¸æ‰€çµ„åˆè€Œæˆçš„çŸ©é™£ï¼š</p>
<p><span class="math display">\[\mathbf {J} =
\begin{bmatrix}
\frac {\partial f_{1}}{\partial x_{1}} &amp; \cdots &amp; \frac {\partial f_{1}}{\partial x_{n}}\\[0.5em]
\vdots &amp;\ddots &amp;\vdots \\[0.5em]
\frac {\partial f_{m}}{\partial x_{1}} &amp; \cdots &amp; \frac {\partial f_{m}}{\partial x_{n}}
\end{bmatrix}\]</span></p>
<p>Reverse-Mode AD å°±æ˜¯ä¸€æ¬¡ç®—ä¸€å€‹ rowï¼ŒForward-Mode AD å‰‡æ˜¯ä¸€æ¬¡ç®—ä¸€å€‹ columnã€‚ç”±æ–¼é¡ç¥ç¶“ç¶²è·¯æ˜¯ä¸€å€‹ <span class="math inline">\(n \gg m\)</span> çš„å‡½æ•¸ï¼Œç”¨ Reverse-Mode AD æœ‰æ•ˆç‡äº†ä¸å°‘ã€‚</p>
</section>
</section>
<section id="implementation" class="level1">
<h1>Implementation</h1>
<p>Reverse-Mode AD çš„å¯¦ä½œæ¯”èµ· Forward-Mode AD è¤‡é›œäº†é»ï¼Œå…ˆå›ä¾†çœ‹çœ‹å‰é¢çš„<span class="math inline">\(\frac{âˆ‚ Y}{âˆ‚ x}\)</span>ï¼š</p>
<p><span class="math display">\[\frac{âˆ‚ Y}{âˆ‚ x} =
\textcolor{blue}{\frac{âˆ‚ Y}{âˆ‚ sin(x)}}
\textcolor{green}{\frac{âˆ‚ sin(x)}{âˆ‚ x}} +
\textcolor{blue}{\frac{âˆ‚ Y}{âˆ‚ x \cdot y}}
\textcolor{green}{\frac{âˆ‚ x \cdot y}{âˆ‚ x}}\]</span></p>
<p>å¯ä»¥è§€å¯Ÿåˆ°ï¼š</p>
<ol type="1">
<li><span class="math inline">\(\color{blue}\text{è—è‰²}\)</span>çš„éƒ¨ä»½è·Ÿè¨ˆç®—éç¨‹æ˜¯<strong>ç›¸åé †åºçš„</strong><span><label for="sn-8" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-8" class="margin-toggle"/><span class="sidenote">ä»¥è¨ˆç®— <span class="math inline">\(Y = (f \circ g \circ h) (x)\)</span> çš„å¾®åˆ† <span class="math inline">\(\frac{âˆ‚ Y}{âˆ‚ x}\)</span> ç‚ºä¾‹ï¼Œæˆ‘å€‘éœ€è¦å¾å¾Œé¢åˆ°å‰é¢åœ°æ±‚å‡º <span class="math inline">\(\frac{âˆ‚ Y}{âˆ‚ f}, \frac{âˆ‚ Y}{âˆ‚ g}, \frac{âˆ‚ Y}{âˆ‚ h}\)</span>ï¼Œ<br />
<br />
</span></span></li>
<li><span class="math inline">\(\color{green}\text{ç¶ è‰²}\)</span>çš„éƒ¨ä»½è·Ÿè¨ˆç®—éç¨‹æ˜¯<strong>ç›¸åŒé †åºçš„</strong><span><label for="sn-9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-9" class="margin-toggle"/><span class="sidenote">ç¹¼çºŒä¸Šé¢çš„ä¾‹å­ï¼Œè¨ˆç®—ç¶ è‰²çš„éƒ¨ä»½éœ€è¦å¾å‰é¢åˆ°å¾Œé¢çš„æ±‚å‡º <span class="math inline">\(\frac{âˆ‚ h(x)}{âˆ‚ x}, \frac{âˆ‚ g(h(x))}{âˆ‚ h(x)}, \frac{âˆ‚ f(g(h(x)))}{âˆ‚ g(h(x))}\)</span>ã€‚<br />
<br />
</span></span></li>
<li>æˆ‘å€‘éœ€è¦è¿½è¹¤ä¸€å€‹è®Šæ•¸è¢«åœ¨å“ªäº›åœ°æ–¹ï¼Œä¸Šé¢ <span class="math inline">\(Y = sin(x) + x \cdot y\)</span> çš„ä¾‹å­ <span class="math inline">\(x\)</span> å°±è¢«ç”¨ <span class="math inline">\(sin(x)\)</span> è·Ÿ <span class="math inline">\(x \cdot y\)</span> å…©è™•ã€‚</li>
</ol>
<section id="wengert-tape" class="level2">
<h2>Wengert Tape</h2>
<p>å…¶ä¸­ä¸€å€‹ä½œæ³•æ˜¯ä½¿ç”¨ Wengert Tape ï¼Œé€™å€‹è³‡æ–™çµæ§‹è¿½è¹¤é †å‘è¨ˆç®—çš„éç¨‹ï¼ŒReverse-Mode AD æ™‚å‰‡æ˜¯æœƒåéä¾†è¨ˆç®—ã€‚</p>
<p>ç‚ºäº†ç°¡åŒ–ï¼Œé€™é‚Šå°‡è¨ˆç®—çš„éç¨‹æ¨å»£æˆä¸‰ç¨®å½¢å¼ï¼š è®Šæ•¸ã€å–®è®Šæ•¸å‡½æ•¸ã€é›™è®Šæ•¸å‡½æ•¸ã€‚<span><label for="sn-10" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-10" class="margin-toggle"/><span class="sidenote">é€™é‚Šçš„å¯¦ä½œåƒè€ƒè‡ª Edward Kmett æ‰€å¯«çš„ <a href="https://github.com/ekmett/ad"><code>ad</code></a> è‡ªå‹•å¾®åˆ†å‡½å¼åº«ã€‚<br />
<br />
</span></span><span><label for="sn-11" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-11" class="margin-toggle"/><span class="sidenote">æ³¨æ„ï¼šç‚ºäº†æ–¹ä¾¿å¯¦ä½œè·Ÿè§£é‡‹ï¼Œæˆ‘çš„å¯¦ä½œæœ‰ç¨å¾®è®ŠåŒ–éã€‚<br />
<br />
</span></span></p>
<ul>
<li><code>x</code> ï¼ˆæˆ–æ˜¯ <code>y</code>ï¼‰ è¡¨ç¤ºé€™å€‹è¨ˆç®—çš„è¼¸å…¥ç¯€é» <span class="math inline">\(x, y\)</span>ï¼ˆåå‘çš„é”åˆ°äº†å‰è¿°ç¬¬ 3 é»ï¼‰</li>
<li><code>dx</code> ï¼ˆæˆ–æ˜¯ <code>dy</code>ï¼‰ è¡¨ç¤ºè¼¸å…¥å°é€™å€‹è¨ˆç®—çš„å½±éŸ¿ <span class="math inline">\(\frac{âˆ‚f}{âˆ‚x}, \frac{âˆ‚f}{âˆ‚y}\)</span>ï¼Œä¹Ÿå°±æ˜¯å‰è¿°ç¬¬ 2 é»çš„<span class="math inline">\(\color{green}\text{ç¶ è‰²}\)</span>éƒ¨ä»½ã€‚</li>
<li><code>ss</code> è¡¨ç¤ºé€™å€‹è¨ˆç®—å°æ–¼æ•´å€‹è¨ˆç®—çš„å½±éŸ¿ <span class="math inline">\(\frac{âˆ‚ Y}{âˆ‚ f}\)</span>ï¼Œä¹Ÿå°±æ˜¯å‰è¿°ç¬¬ 1 é»çš„<span class="math inline">\(\color{blue}\text{è—è‰²}\)</span>éƒ¨ä»½ã€‚</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">from</span> collections <span class="im">import</span> namedtuple</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">Var <span class="op">=</span> namedtuple(<span class="st">&#39;Var&#39;</span>, [<span class="st">&#39;ss&#39;</span>])</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">Un  <span class="op">=</span> namedtuple(<span class="st">&#39;Un&#39;</span>,  [<span class="st">&#39;x&#39;</span>, <span class="st">&#39;dx&#39;</span>, <span class="st">&#39;ss&#39;</span>])</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">Bin <span class="op">=</span> namedtuple(<span class="st">&#39;Bin&#39;</span>, [<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;dx&#39;</span>, <span class="st">&#39;dy&#39;</span>, <span class="st">&#39;ss&#39;</span>])</a></code></pre></div>
<p>é€™æ¨£å°±å¯ä»¥ä¸‹é¢çš„é€™æ®µç¨‹å¼ä¾†è¡¨é” <span class="math inline">\(sin(x) + x \cdot y \bigg\vert_{x = 3, y = 1}\)</span> çš„é †å‘è¨ˆç®—éç¨‹<span><label for="sn-12" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-12" class="margin-toggle"/><span class="sidenote">ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘çœå»äº†ç•¶ä¸‹è¨ˆç®—çš„è¼¸å‡ºæ•¸å€¼<code>v</code>(<span class="math inline">\(f(x)\)</span>)<br />
<br />
</span></span></p>
<p><span><label for="sn-13" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-13" class="margin-toggle"/><span class="marginnote"> é€™é‚Šæˆ‘å°å°çš„ä½œå¼Šäº†ä¸€ä¸‹ï¼Œç›´æ¥ä½¿ç”¨ <code>Dict</code> ä¾†æ–¹ä¾¿æ›´æ–° <code>ss</code> çš„å€¼ã€‚<br />
<br />
</span></span></p>
<p><span><label for="sn-14" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-14" class="margin-toggle"/><span class="marginnote"> <a href="/images/autodiff-forward-ad.svg"><img src="/images/autodiff-forward-ad.svg" /></a> é€™å¼µåœ–è¡¨ç¤ºé †å‘è¨ˆç®—æ™‚æ‰€ç´¯è¨ˆçš„æ•¸å€¼<br />
<br />
</span></span></p>
<p><span><label for="sn-15" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-15" class="margin-toggle"/><span class="marginnote"> <a href="/images/autodiff-tape.svg"><img src="/images/autodiff-tape.svg" /></a> é€™å¼µåœ–è¡¨ç¤ºç¯€é»ä¹‹é–“çš„ç›¸ä¾é—œä¿‚<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="im">from</span> math <span class="im">import</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">def</span> box(v<span class="op">=</span><span class="dv">0</span>):</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="cf">return</span> {<span class="st">&#39;value&#39;</span>: v}</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">x <span class="op">=</span> Var(box())</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">y <span class="op">=</span> Var(box())</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">sin_x <span class="op">=</span> Un(x, cos(<span class="dv">1</span>), box())</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">x_times_y <span class="op">=</span> Bin(x, y, <span class="dv">1</span>, <span class="dv">3</span>, box())</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">Y <span class="op">=</span> Bin(sin_x, x_times_y, <span class="dv">1</span>, <span class="dv">1</span>, box())</a></code></pre></div>
<p>Wengert Tape å°±æ˜¯ç´€éŒ„è¼¸å…¥è®Šæ•¸åŠé€™ä¸€é€£çºŒçš„è¨ˆç®—éç¨‹ã€‚</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1">tape <span class="op">=</span> [x, y, sin_x, x_times_y, Y]</a></code></pre></div>
<p>ç•¶è¨ˆç®— Reverse-Mode ADæ™‚ï¼Œæˆ‘å€‘æœƒå°‡ tape åéä¾†ç´¯è¨ˆï¼š<span><label for="sn-16" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-16" class="margin-toggle"/><span class="marginnote"> æ³¨æ„åˆ°é€™é‚Šçš„å¯¦ä½œå·²ç¶“åœ¨å‰é¢å»ºæ§‹é€™äº›ç¯€é»çš„åŒæ™‚ï¼Œå°‡é †å‘è¨ˆç®—çš„éç¨‹çµ¦åµŒé€²å»äº†ã€‚<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1">Y.ss[<span class="st">&#39;value&#39;</span>] <span class="op">=</span> <span class="dv">1</span> <span class="co"># å¾ âˆ‚Y/âˆ‚Y = 1 é–‹å§‹</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="cf">for</span> cell <span class="kw">in</span> <span class="bu">reversed</span>(tape):</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    <span class="cf">if</span> <span class="bu">isinstance</span>(cell, Bin):</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">        cell.x.ss[<span class="st">&#39;value&#39;</span>] <span class="op">+=</span> cell.ss[<span class="st">&#39;value&#39;</span>] <span class="op">*</span> cell.dx</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">        cell.y.ss[<span class="st">&#39;value&#39;</span>] <span class="op">+=</span> cell.ss[<span class="st">&#39;value&#39;</span>] <span class="op">*</span> cell.dy</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    <span class="cf">elif</span> <span class="bu">isinstance</span>(cell, Un):</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">        cell.x.ss[<span class="st">&#39;value&#39;</span>] <span class="op">+=</span> cell.ss[<span class="st">&#39;value&#39;</span>] <span class="op">*</span> cell.dx</a></code></pre></div>
<p>Reverse Mode AD å°±åƒé€™æ¨£åœ¨ä¸€å€‹ pass å°±èƒ½ç®—å‡ºæ‰€æœ‰è¼¸å…¥çš„åå°æ•¸</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="op">&gt;&gt;&gt;</span> x.ss[<span class="st">&#39;value&#39;</span>], y.ss[<span class="st">&#39;value&#39;</span>]</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">(<span class="fl">0.010007503399554585</span>, <span class="dv">3</span>)</a></code></pre></div>
<p>å‰©ä¸‹çš„å°±æ˜¯å¯¦ä½œä¸€å€‹æ˜“ç”¨çš„ç•Œé¢çµ¦ä½¿ç”¨è€…äº†ï¼Œä¹Ÿå°±æ˜¯åªéœ€è¦æŒ‡å®šé †å‘è¨ˆç®—çš„éç¨‹ã€‚</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> var(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="op">&gt;&gt;&gt;</span> y <span class="op">=</span> var(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="op">&gt;&gt;&gt;</span> Y <span class="op">=</span> sin(x) <span class="op">+</span> x <span class="op">*</span> y</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="op">&gt;&gt;&gt;</span> Y.value</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="fl">3.1411200080598674</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="op">&gt;&gt;&gt;</span> Y.tape</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">Tape([<span class="op">&lt;</span>Var <span class="bu">object</span> at <span class="bn">0x7f84dbfed198</span><span class="op">&gt;</span>,</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"> <span class="op">&lt;</span>Unary <span class="bu">object</span> at <span class="bn">0x7f84e6968c50</span><span class="op">&gt;</span>,</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"> <span class="op">&lt;</span>Var <span class="bu">object</span> at <span class="bn">0x7f84e3e567b8</span><span class="op">&gt;</span>,</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"> <span class="op">&lt;</span>Binary <span class="bu">object</span> at <span class="bn">0x7f84e0dff4e0</span><span class="op">&gt;</span>,</a>
<a class="sourceLine" id="cb6-11" data-line-number="11"> <span class="op">&lt;</span>Binary <span class="bu">object</span> at <span class="bn">0x7f84dbfed630</span><span class="op">&gt;</span>])</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="op">&gt;&gt;&gt;</span> Y.backprop()</a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="op">&gt;&gt;&gt;</span> x.sensitivity</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="fl">0.010007503399554585</span></a></code></pre></div>
<section id="å…¶ä»–è®ŠåŒ–" class="level3">
<h3>å…¶ä»–è®ŠåŒ–</h3>
<ul>
<li>å¦å¤–ä¸€å€‹åšæ³•æ˜¯å°‡æ‰€æœ‰ç¯€é»è¡¨ç¤ºæˆä¸€å€‹æœ‰å‘ç„¡ç’°åœ–ï¼ˆDAG; Directed Acyclic Graphï¼‰ï¼Œæ¥è‘—åš Topological sort ä¾†è¨ˆç®—å‡ºé †å‘è·Ÿåå‘çš„è¨ˆç®—é †åºã€‚</li>
<li>å¯ä»¥é¸æ“‡å°‡è¨˜ä½è¨ˆç®—çš„å‡½æ•¸åŠè¼¸å…¥è¼¸å‡ºï¼Œè€Œéåå°æ•¸çš„æ•¸å€¼ <span><label for="sn-17" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-17" class="margin-toggle"/><span class="sidenote">å¦‚æœæˆ‘æ²’å¼„éŒ¯çš„è©±ï¼Œ tensorflow å°±æ˜¯ä»¥ DAG è¡¨ç¤ºï¼Œç”¨ DFS ä¾†æ‰¾å‡ºè¨ˆç®—é †åºï¼Œä¸¦æ¡ç”¨åªå„²å­˜å‡½æ•¸æœ¬èº«è·Ÿè¼¸å…¥è¼¸å‡ºçš„åšæ³•ã€‚<br />
<br />
</span></span>ã€‚</li>
<li>å¯ä»¥åœ¨è®Šæ•¸ç¯€é»è¨˜ä¸‹åç¨±ï¼Œæ–¹ä¾¿äº‹å¾Œè§€å¯Ÿã€‚</li>
</ul>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>é€™ç¯‡æ–‡ç« ä»‹ç´¹äº† Reverse-Mode AD ä»¥åŠå¯¦ä½œçš„æ–¹æ³•ï¼Œå­¸æœƒé€™äº›ç´°ç¯€é›–ç„¶æ²’æœ‰è®“æˆ‘æ›´æœƒè¨“ç·´é¡ç¥ç¶“ç¶²è·¯ï¼Œä½†ä¹Ÿæ˜¯æ›´äº†è§£é€™äº›é»‘ç›’å­åº•ä¸‹åˆ°åº•åœ¨åšäº›ä»€éº¼ã€‚</p>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<section id="example-softmax-regression" class="level2">
<h2>Example: Softmax Regression</h2>
<p><span><label for="sn-18" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-18" class="margin-toggle"/><span class="marginnote"> æˆ‘çš„ã€Œç©å…·ç‰ˆã€ Reverse-Mode AD å¯¦ä½œå‡½æ•¸åº«æ”¾åœ¨<a href="https://gist.github.com/op8867555/59d246a54188fe0d282656fe83e84a65">é€™é‚Š</a>ã€‚<br />
<br />
</span></span></p>
<p>é€™æ¬¡ä»¥ ML å¸¸ç”¨çš„ iris è³‡æ–™é›†ä½œç‚ºç¯„ä¾‹ï¼Œå»ºæ§‹ä¸€å€‹ Softmax Regression ä¾†åˆ†é¡é€™äº›èŠ±æœµã€‚</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="im">from</span> reverse_ad <span class="im">import</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="im">from</span> sklearn.datasets <span class="im">import</span> load_iris</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">iris <span class="op">=</span> load_iris()</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">X <span class="op">=</span> iris[<span class="st">&#39;data&#39;</span>]</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">Y <span class="op">=</span> iris[<span class="st">&#39;target&#39;</span>]</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">X_train, X_test, Y_train, Y_test <span class="op">=</span> train_test_split(X, Y)</a></code></pre></div>
<p>é€™é‚Šä½¿ç”¨ Softmax Regression åšåˆ†é¡ï¼Œç”¨ Cross Entropy åšç‚º loss functionã€‚<span><label for="sn-19" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-19" class="margin-toggle"/><span class="marginnote"> <span class="math display">\[\begin{gathered}
  Softmax(X_i) = \frac{exp(X_i)}{\sum_k exp(X_i)} \\
  f(X; W, B) = Softmax(W \times X + B) \\
  Cost(Y, \hat Y) = \frac{-1}{|Y|}\sum_{y} \sum_{k} y_k \log(\hat{y}_k)
  \end{gathered}\]</span><br />
<br />
</span></span></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">def</span> softmax(z):</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">    z_exp <span class="op">=</span> [exp(i) <span class="cf">for</span> i <span class="kw">in</span> z]</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    sum_z_exp <span class="op">=</span> <span class="bu">sum</span>(z_exp)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="cf">return</span> [i <span class="op">/</span> sum_z_exp <span class="cf">for</span> i <span class="kw">in</span> z_exp]</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="kw">def</span> reg(xs, w, b):</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">    <span class="cf">return</span> softmax([<span class="bu">sum</span>(w[i][j] <span class="op">*</span> x <span class="cf">for</span> j, x <span class="kw">in</span> <span class="bu">enumerate</span>(xs)) <span class="op">+</span> b[i]</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">                    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="kw">def</span> categorical_cross_entropy(Y, Y_):</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">    loss <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">sum</span>(k <span class="op">*</span> log(k_) <span class="cf">for</span> k, k_ <span class="kw">in</span> <span class="bu">zip</span>(y, y_)) <span class="cf">for</span> y, y_ <span class="kw">in</span> <span class="bu">zip</span>(Y, Y_))</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">    <span class="cf">return</span> <span class="dv">-1</span> <span class="op">*</span> loss <span class="op">/</span> <span class="bu">len</span> (Y_)</a></code></pre></div>
<p>ç”¨ Gradient Descent ä¾†æ‰¾åˆ°æ›´å¥½çš„ <span class="math inline">\(W\)</span> è·Ÿ <span class="math inline">\(B\)</span></p>
<p><span><label for="sn-20" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-20" class="margin-toggle"/><span class="marginnote"> é€™é‚Šéœ€è¦å…ˆå°æ¨™ç±¤åš one-hot encoding æ‰æœƒæœ‰è·Ÿå…¬å¼è¼¸å‡ºä¸€è‡´çš„ç¶­åº¦ã€‚<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">Y_encoded <span class="op">=</span> OneHotEncoder().fit_transform(Y_train.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).todense().tolist()</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">w <span class="op">=</span> [[var(<span class="dv">0</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)]</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">b <span class="op">=</span> [var(<span class="dv">0</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)]</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">lr <span class="op">=</span> <span class="fl">0.1</span></a></code></pre></div>
<p><span><label for="sn-21" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-21" class="margin-toggle"/><span class="marginnote"> ä½¿ç”¨ Reverse Mode AD å°±ä¸å†éœ€è¦æ¯ä¸€å€‹åƒæ•¸éƒ½å†è¨ˆç®—ä¸€æ¬¡ã€‚<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    Y_predicted <span class="op">=</span> [reg(x, w<span class="op">=</span>w, b<span class="op">=</span>b) <span class="cf">for</span> x <span class="kw">in</span> X_train]</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">    loss <span class="op">=</span> categorical_cross_entropy(Y_encoded, Y_predicted)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">    loss.backprop()</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">        b[i] <span class="op">-=</span> lr <span class="op">*</span> b[i].sensitivity</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">            w[i][j] <span class="op">-=</span> lr <span class="op">*</span> w[i][j].sensitivity</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">    <span class="cf">if</span> epoch <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">        accuracy <span class="op">=</span> accuracy_score(Y_test, [tolabel(reg(x, w<span class="op">=</span>w, b<span class="op">=</span>b)) <span class="cf">for</span> x <span class="kw">in</span> X_test])</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">        <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="sc">{</span>epoch<span class="sc">: 5d}</span><span class="ss"> loss </span><span class="sc">{</span>loss<span class="sc">.</span>value<span class="sc">}</span><span class="ss"> acc </span><span class="sc">{</span>accuracy<span class="sc">}</span><span class="ss">&#39;</span>)</a></code></pre></div>
<p>è·‘èµ·ä¾†æˆæœåƒæ˜¯é€™æ¨£ï¼š</p>
<pre><code>    0 loss 1.098612288668108   acc 0.34210526315789475
   10 loss 0.84323472659183    acc 0.6578947368421053
   20 loss 0.716723873894274   acc 0.6578947368421053
   30 loss 0.6493242141034026  acc 0.6578947368421053
   40 loss 0.6030807982006535  acc 0.6578947368421053
   50 loss 0.5661515656844388  acc 0.6578947368421053
   60 loss 0.5340659822896819  acc 0.6578947368421053
   70 loss 0.5047568856139167  acc 0.6578947368421053
   80 loss 0.4771475569375817  acc 0.6578947368421053
   90 loss 0.45064476873213055 acc 0.6578947368421053
  100 loss 0.42493012219412674 acc 0.6578947368421053
  110 loss 0.39987107522910936 acc 0.7105263157894737
  120 loss 0.37549205547113373 acc 0.7105263157894737
  130 loss 0.3519881981460512  acc 0.7368421052631579
  140 loss 0.3297816399879364  acc 0.7631578947368421
  150 loss 0.30960905639139913 acc 0.868421052631579
  160 loss 0.2925264903210591  acc 0.9210526315789473</code></pre>
<!--

example :: Diagram B
example = nodes # applyAll [connectOutside a b | (a, b) <- names]
                # padX 1.2 # padY 1.1
                # centerXY
    where names = concat [ zip inputsNames weightsNames
                         , zip weightsNames (repeat "sum")
                         , [("sum", "act"), ("act", "out")]
                         ]

nodes = foldl1 (|||)  [ vsep 1 inputs # centerY
                      , strutX 3
                      , vsep 1 weights # centerY
                      , strutX 3
                      , sum_ # centerY
                      , strutX 1.5
                      , text "a" # translateY 0.5
                      , strutX 1.5
                      , act # centerY
                      , strutX 1
                      , out
                      ]
withText = replicate 5 (text "Ã—" # translateY 0.5)

inputsNames = map (("input_"++) . show) [1..5]
weightsNames = map (("weight_"++) . show) [1..5]
inputs  = (\x -> mconcat [ text "zâ½Ë¡â»Â¹â¾"
                         , circle 1.25 # named x
                         , text "Ã—" # translate (r2 (3, 0.5))
                         ]) <$> inputsNames
weights = map (\x -> text "w" <> circle 1.25 # named x) weightsNames
sum_    = text "Î£" <> circle 1.25 # named "sum"
act     = text "f" <> circle 1.25 # named "act"
out     = text "zâ½Ë¡â¾"
-->
</section>
</section>]]></description>
    <pubDate>Sun, 28 Jan 2018 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2018-01-11-autodiff-reverse-mode.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>æ©Ÿå™¨å¦‚ä½•è¨ˆç®—å¾®åˆ†/åå¾®åˆ†ï¼ˆä¸Šï¼‰</title>
    <link>https://op8867555.github.io/posts/2017-12-17-autodiff.html</link>
    <description><![CDATA[<section>
<p>æåˆ°è¿‘å¹´ä¾†ç†±é–€çš„é¡ç¥ç¶“ç¶²è·¯æ¨¡å‹ï¼Œåå‚³å°(back propagation)æ˜¯ä¸€å€‹ç›¸ç•¶é‡è¦çš„éç¨‹ï¼Œå…¶ä¸­æ‡‰ç”¨çš„å°±æ˜¯è¨ˆç®—æ¢¯åº¦ï¼ˆgradientï¼Œå°±æ˜¯æ¯å€‹åƒæ•¸çš„åå¾®åˆ†ï¼‰ä¿®æ­£ç¥ç¶“åƒæ•¸ä¾†é”åˆ°ã€Œå­¸ç¿’ã€çš„æ•ˆæœï¼Œé¡ç¥ç¶“ç¶²è·¯çš„çµæ§‹è¶Šä¾†è¶Šè¤‡é›œï¼Œä½¿å¾—äººå·¥æ¨å°æ¢¯åº¦å…¬å¼è¶Šä¾†è¶Šä¸å¯è¡Œï¼Œå¦‚ä½•æ‡‰ç”¨é›»è…¦è¨ˆç®—å¾®åˆ†è®Šæˆäº†ä¸€å€‹é‡è¦çš„å•é¡Œã€‚</p>
</section>
<div class="fullwidth">
<figure>
<img src="https://i.imgur.com/R5QzZY4.png" alt="é€™å¼µåœ–ç°¡å–®åœ°è§£é‡‹äº†è¨ˆç®—å¾®åˆ†çš„å¹¾ç¨®ä½œæ³•ã€‚æ‘˜è‡ªâ€œAutomatic Differentiation of Algorithms for Machine Learningâ€" /><figcaption>é€™å¼µåœ–ç°¡å–®åœ°è§£é‡‹äº†è¨ˆç®—å¾®åˆ†çš„å¹¾ç¨®ä½œæ³•ã€‚æ‘˜è‡ªâ€œAutomatic Differentiation of Algorithms for Machine Learningâ€</figcaption>
</figure>
</div>
<section id="numerical-differential" class="level1">
<h1>Numerical Differential</h1>
<p><span><label for="sn-1" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="marginnote"> <img src="https://upload.wikimedia.org/wikipedia/commons/1/18/Derivative.svg" /> æ•¸å€¼å¾®åˆ†ï¼Œ By Olivier Cleynen (Own work) [CC0], via Wikimedia Commons<br />
<br />
</span></span></p>
<p>æ•¸å€¼å¾®åˆ†å°±æ˜¯ç”¨ <span class="math inline">\(\frac{f(x + h) - f(x)}{h}\)</span> è·Ÿä¸€å€‹å¾ˆå°çš„ <span class="math inline">\(h\)</span> ä¾†<strong>è¿‘ä¼¼</strong> <span class="math inline">\(\lim_{h \rightarrow 0}\frac{f(x + h) - f(x)}{h}\)</span>ï¼Œå¯¦ä½œä¸Šä¹Ÿåªæ˜¯è¨ˆç®—ç”¨ä¸åŒçš„åƒæ•¸ä¾†è¨ˆç®—å‡½æ•¸ <span class="math inline">\(f\)</span> çš„å·®ç•°ï¼Œä½†æ˜¯ <span class="math inline">\(f\)</span> çš„è¨ˆç®—æˆæœ¬å¯èƒ½ä¸ä½ï¼Œè€Œä¸”å¾ˆå®¹æ˜“é‡åˆ°æµ®é»æ•¸è¨ˆç®—çš„ round-off error è·Ÿ truncating errorï¼Œæ‰€ä»¥å¯¦å‹™ä¸Šä¸¦ä¸å¯¦ç”¨ã€‚</p>
<section id="å¯¦ä½œ" class="level2">
<h2>å¯¦ä½œ</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">from</span> math <span class="im">import</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">def</span> diff(f, x, epilson<span class="op">=</span><span class="fl">0.00001</span>):</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="cf">return</span> (f(x<span class="op">+</span>epilson) <span class="op">-</span> f(x))<span class="op">/</span>epilson</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">diff(sin, pi) <span class="co"># -0.9999999999898844</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">def</span> f(x, y):</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="cf">return</span> sin(x) <span class="op">+</span> x <span class="op">*</span> y</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co"># è¨ˆç®—åå¾®åˆ†å°±æ˜¯æŠŠä¸é—œå¿ƒçš„åƒæ•¸è¦–ç‚ºå¸¸æ•¸</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="im">from</span> functools <span class="im">import</span> partial</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">diff(partial(f, y<span class="op">=</span><span class="dv">2</span>), <span class="dv">3</span>) <span class="co"># 1.0100067978413563 (df(2,3)dx)</span></a></code></pre></div>
</section>
</section>
<section id="symbolic-differential" class="level1">
<h1>Symbolic Differential</h1>
<p>ç¬¦è™Ÿå¾®åˆ†æ˜¯ç¬¦è™Ÿè¨ˆç®— (Symbolic Computing) çš„ä¸€å€‹ç¶“å…¸ä¾‹å­ï¼šä¸å»è¨ˆç®—æ•¸å€¼ï¼Œè€Œæ˜¯ <em>è·Ÿäººé¡ä¸€æ¨£</em> ç›´æ¥è™•ç†é€™äº›ç¬¦è™Ÿã€‚<span><label for="sn-2" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="marginnote"> æˆ‘æœ€æ—©æ˜¯åœ¨ SICP ä¸€æ›¸çœ‹è¦‹é€™å€‹ä½œæ³•ï¼Œå¯ä»¥å¿å—å¾ˆå¤šæ‹¬è™Ÿçš„è®€è€…å¯ä»¥å»çœ‹ä¸€ä¸‹ <a href="https://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3.2">Â§2.3.2</a> çš„ä»‹ç´¹ã€‚<br />
<br />
</span></span> åœ¨ä¿®ç¿’å¾®ç©åˆ†èª²ç¨‹æ™‚ï¼Œä¸€å®šæœƒæåˆ°å¦‚ä½•åˆ©ç”¨ <a href="https://en.wikipedia.org/wiki/Differentiation_rules">Differentiation rules</a> ä¾†æ±‚å‡ºå°æ•¸ï¼Œåƒæ˜¯:</p>
<ul>
<li><span class="math inline">\((a \cdot f)&#39; = af&#39;\)</span></li>
<li><span class="math inline">\((f + g)&#39; = f&#39; + g&#39;\)</span></li>
<li><span class="math inline">\((f(x) \cdot g(x))&#39; = f&#39;(x)g(x) + f(x)g&#39;(x)\)</span></li>
<li><span class="math inline">\((f(g(x)))&#39; = f&#39;(g(x)) g&#39;(x)\)</span></li>
</ul>
<p>è€Œ Symbolic Differential å°±æ˜¯æ¡ç”¨è·Ÿäººé¡ä¸€æ¨£çš„æ–¹æ³•ï¼Œå°è‘— expression tree ä¸æ–·çš„åš pattern matching è·Ÿ rewriteã€‚é€™å€‹æ–¹æ³•å¾ˆå¥½å¯¦ä½œï¼Œåªéœ€è¦ç…§è‘— Differential rules æ”¹å¯«ä¾¿æ˜¯ï¼Œè€Œä¸”å¯ä»¥å¾—åˆ°<strong>çœŸæ­£çš„</strong><span><label for="sn-3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="sidenote">Exact Derivativeï¼Œä¹Ÿå°±æ˜¯è·Ÿæ‰‹å‹•æ¨å°çš„çµæœä¸€è‡´ï¼ŒNumerical Differential å› ç‚ºæµ®é»æ•¸çš„ç‰¹æ€§ï¼Œæœƒç”¢ç”Ÿèª¤å·®è€Œç„¡æ³•ç®—å‡ºçœŸæ­£çš„å°æ•¸/åå°æ•¸<br />
<br />
</span></span>å°æ•¸/åå°æ•¸ã€‚</p>
<p>ä½†æ˜¯é€™å€‹æ–¹æ³•æœ€å¤§çš„å•é¡Œæ˜¯åœ¨æ”¹å¯«çš„éç¨‹ä¸­ï¼Œæœƒå‡ºç¾å¾ˆå¤šå†—æ–¼çš„å¼å­ï¼š <span class="math inline">\(x \times 1\)</span>, <span class="math inline">\(x + 0\)</span> ä¹‹é¡çš„ï¼Œå› æ­¤å¾ˆå®¹æ˜“ç”¢ç”Ÿå‡ºå·¨å¤§çš„ï¼ˆæ²’æ•ˆç‡ï¼‰çš„çµæœã€‚<span><label for="sn-4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="sidenote">â€œAutomatic Differentiation in Machine Learning: a Surveyâ€ ä¸€æ–‡ä¸­èˆ‰ä¾‹åˆ°ï¼š <span class="math display">\[f(x) = 64x(1 - x)(1 - 2x)^2(1 - 8x + 8x^2)^2\]</span> åœ¨æ²’æœ‰åŒ–ç°¡çš„æƒ…æ³åšç¬¦è™Ÿå¾®åˆ†æœƒå¾—åˆ° <span class="math display">\[\begin{gathered}
  128x(1 - x)(-8 + 16x)(1 - 2x)^2(1 - 8x+8x^2) \\
  + 64(1-x)(1-2x)^2 (1-8x+ 8x^2)^2\\
  - 64x(1-2x)^2 (1-8x+8x^2)^2 \\
  - 256x(1 - x)(1 - 2x)(1 - 8x + 8x^2)^2
  \end{gathered} \]</span> é€™æ¢å¾ˆè¤‡é›œçš„å¼å­ï¼Œä½†æ˜¯ç¶“éåŒ–ç°¡å‰‡åªå‰©ä¸‹ <span class="math display">\[\begin{gathered}
  64(1 - 42x + 504x^2 - 2640x^3  \\
  + 7040x^4 -9984x^5 + 7168x^6 -2048x^7)
  \end{gathered}\]</span>ï¼Œè€Œéš¨è‘—åŸå¼<span class="math inline">\(f\)</span>çš„è¤‡é›œåº¦ä¸Šå‡ï¼Œæ²’åšå¥½ç°¡åŒ–çš„ç¬¦è™Ÿå¾®åˆ†æœƒè†¨è„¹éå¸¸å¿«ã€‚<br />
<br />
</span></span></p>
<p>ä»¥ Python ä¾†èªªï¼ŒSymPy å°±å¯¦ä½œäº†ç¬¦è™Ÿç©åˆ†ï¼Œå¯ä»¥çœ‹åˆ° <code>diff</code> æœƒç”¢å‡ºä¸€å€‹æ–°çš„é‹ç®—å¼ã€‚</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="im">from</span> sympy <span class="im">import</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">x <span class="op">=</span> var(<span class="st">&#39;x&#39;</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">expr <span class="op">=</span> diff(sin(x)) <span class="co"># cos(x)</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">expr.evalf(subs<span class="op">=</span>{<span class="st">&#39;x&#39;</span>: pi}) <span class="co"># -1.000000000000</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">expr2 <span class="op">=</span> diff(sin(x)<span class="op">+</span> x <span class="op">*</span> y, x)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">expr2.evalf(subs<span class="op">=</span>{<span class="st">&#39;x&#39;</span>: <span class="dv">3</span>, <span class="st">&#39;y&#39;</span>: <span class="dv">2</span>}) <span class="co"># 1.0100075033995546</span></a></code></pre></div>
<!--

å·¦åœ–ç‚º$f(x, y) = sin(x) + x*y$çš„ç¤ºæ„åœ–ï¼Œå³åœ–ç‚ºä»¥ç¬¦è™Ÿè¨ˆç®—$\frac{df}{dx}$çš„ç¤ºæ„åœ–ï¼š


~~~~
        f(x, y)    |         dfdx
          +-+      |         +-+
          |+|      |         |+|
          +-+      |         +-+
         /  \      |        /  \
        /    \     |       /    \
    +---+     +-+  |   +---+     +-+
    |sin|     |Ã—|  |   |cos|     |0|
    +---+     +-+  |   +---+     +-+
      |       /|   |     |
      | _____/ |   |     |
      |/       |   |     |
     +-+      +-+  |    +-+
     |x|      |y|  |    |x|
     +-+      +-+  |    +-+
~~~~~
-->
</section>
<section id="forward-mode-automatic-differential" class="level1">
<h1>Forward-Mode Automatic Differential</h1>
<p>è‡ªå‹•å¾®åˆ†ï¼ˆADï¼‰çš„åç¨±å–å¾—å¾ˆå®¹æ˜“è®“äººèª¤è§£ï¼Œå…¶å¯¦å°±æ˜¯æ‡‰ç”¨ chain rule è·Ÿä¸€äº›èªè¨€ç‰¹æ€§æˆ–æ˜¯åŸå§‹ç¢¼è½‰æ›å·¥å…·ï¼Œä¾†é”æˆä¸ç”¨æ‰‹å¯«å°æ•¸çš„ç¨‹å¼ï¼Œè€Œå¯ä»¥åœ¨è¨ˆç®—å‡½æ•¸çš„åŒæ™‚ï¼ˆä¹Ÿå°±æ˜¯ overhead ä¸å¤§ï¼‰å¾—å‡º<strong>çœŸæ­£çš„</strong>å°æ•¸/åå°æ•¸ã€‚</p>
<p>è‡ªå‹•å¾®åˆ†æ ¹æ“šè¨ˆç®—çš„é †åºï¼Œå¯ä»¥åˆ†ç‚º Forward Mode è·Ÿ Reverse Modeï¼Œé€™æ¬¡å…ˆä»‹ç´¹æ¯”è¼ƒç°¡å–®çš„ Forward Modeã€‚</p>
<p><span><label for="sn-5" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="marginnote"> Forward Mode AD å°‡ä¸€å€‹å‡½æ•¸ <span class="math inline">\(y = f(... , x, ...) = (w_m \circ w_{m-1} ... \circ w_1)(..., x, ...)\)</span> å° <span class="math inline">\(x\)</span> çš„å¾®åˆ†ï¼Œæ‹†è§£æˆ <span class="math display">\[
  \begin{aligned}
  \frac {\partial y}{\partial x} =&amp;\frac {\partial y}{\partial w_{m-1}}{\frac {\partial w_{m-1}}{\partial x}} \\
  =&amp;\frac {\partial y}{\partial w_{m-1}}\left({\frac {\partial w_{m-1}}{\partial w_{m-2}}}{\frac {\partial w_{m-2}}{\partial x}}\right) \\
  =&amp;\frac {\partial y}{\partial w_{m-1}}\left({\frac {\partial w_{m-1}}{\partial w_{m-2}}}\left({\frac {\partial w_{m-2}}{\partial w_{m-3}}}{\frac {\partial w_{m-3}}{\partial x}}\right)\right) \\
  =&amp;{\frac {\partial y}{\partial w_{m-1}}} \left( \frac {\partial w_{m-1}}{\partial w_{m-2}} \cdots
  \left(\frac {\partial w_{2}}{\partial w_{1}}  \frac {\partial w_{1}}{\partial x} \right)\right)\\
  \end{aligned}
  \]</span> ç„¶å¾Œå¾ <span class="math inline">\(\frac{\partial x}{\partial x} = 1\)</span> é–‹å§‹ï¼Œ ç”± <span class="math inline">\(\frac{\partial w_1}{\partial x}\)</span> é–‹å§‹è¨ˆç®—åˆ° <span class="math inline">\(\frac{\partial w_m}{x}\)</span>ï¼ˆç”±å…§è€Œå¤–ï¼‰ã€‚<br />
<br />
</span></span></p>
<p>é€™é‚Šç¹¼çºŒä½¿ç”¨ä¸Šé¢çš„ <span class="math inline">\(Y = f(x, y) = sin(x) + x Ã— y\)</span> çš„ä¾‹å­ï¼Œ</p>
<p>æˆ‘å€‘å¯ä»¥æŠŠ <span class="math inline">\(Y\)</span> æ‹†è§£æˆä¸‹åœ–ï¼ˆå·¦ï¼‰</p>
<p><span class="math display">\[
\begin{array}{rl|rl}
  Y &amp; =  w_5       &amp; \dot{Y} &amp; = \dot{w_5} \\
w_5 &amp; =  w_3 + w_4 &amp; \dot{w_5} &amp; = \dot{w_3} + \dot{w_4} \\
w_4 &amp; =  w_1 Ã— w_2 &amp; \dot{w_4} &amp; = w_2 Ã— \dot{w_1} + w_1 Ã— \dot{w_2}\\
w_3 &amp; =  sin(w_1)  &amp; \dot{w_3} &amp; = cos(w_1) \\
w_2 &amp; =  y         &amp; \dot{w_2} &amp; = 0\\
w_1 &amp; =  x         &amp; \dot{w_1} &amp; = 1\\
\end{array}
\]</span></p>
<p>ç„¶å¾Œæˆ‘å€‘å°±å¯ä»¥å¾ <span class="math inline">\(\frac{\partial x}{\partial x} = 1, \frac{\partial y}{\partial x} = 0\)</span> é–‹å§‹ï¼Œæ±‚å‡º <span class="math inline">\(\frac{\partial w_i}{\partial x} \big \vert_{i = 1 \cdots 5}\)</span>ï¼Œæœ€å¾Œæ±‚å‡º<span class="math inline">\(\frac{\partial Y}{\partial x}\)</span> ï¼ˆå¦‚ä¸Šåœ–ï¼ˆå³ï¼‰ï¼Œé€™é‚Šç”¨ <span class="math inline">\(\dot{X}\)</span> ä¾†è¡¨ç¤º <span class="math inline">\(\frac{\partial X}{\partial x}\)</span>ï¼‰ã€‚</p>
<p>å¾è¨ˆç®—é †åºä¸Šï¼ŒForward-Mode AD è·ŸåŸå…ˆå‡½æ•¸æ˜¯ä¸€æ¨£çš„ï¼Œæ‰€ä»¥è¢«ç¨±ç‚º Forward Modeã€‚</p>
<section id="å¯¦ä½œ-1" class="level2">
<h2>å¯¦ä½œ</h2>
<p>ä¸€å€‹å¸¸è¦‹çš„å¯¦ä½œæ–¹æ³•æ˜¯å®šç¾©ä¸€å€‹æ–°çš„è³‡æ–™çµæ§‹ Dual Numberï¼Œè·Ÿåˆ©ç”¨ operator overloading ä¾†å¯¦ä½œå…¶ç®—è¡“ç³»çµ±ã€‚ä¸‹é¢ä½¿ç”¨ Python èˆ‰ä¾‹<span><label for="sn-6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-6" class="margin-toggle"/><span class="sidenote">è¼ƒå®Œæ•´çš„ Dual Number å®šç¾©å¯ä»¥åœ¨ <a href="https://en.wikipedia.org/wiki/Automatic_differentiation#Automatic_differentiation_using_dual_numbers">Wikipedia</a> æ‰¾åˆ°ã€‚å¦‚åŒæ–‡ä¸­å¯«åˆ°ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ <span class="math inline">\(g(\langle u,u&#39; \rangle , \langle v,v&#39; \rangle )  = \langle g(u,v) , g_u(u,v) u&#39; + g_v(u,v) v&#39; \rangle\)</span> ä¾†å®šç¾©é€™äº› primitive functions(<span class="math inline">\(sin, cos, \cdots\)</span>)ã€‚<br />
<br />
</span></span><span><label for="sn-7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-7" class="margin-toggle"/><span class="sidenote">ç‚ºäº†å¯ä»¥å¯«å‡ºåƒæ˜¯ <code class="sourceCode python"><span class="dv">4</span> <span class="op">*</span> Dual(<span class="dv">1</span>, <span class="dv">1</span>)</code> é€™æ¨£æ··åˆè‘— <code>float</code> è·Ÿ <code>Dual</code> çš„ç¨‹å¼ï¼Œå¯ä»¥åƒè€ƒ <a href="https://docs.python.org/3/reference/datamodel.html#emulating-numeric-types">Python Reference Â§3.3.7</a> ä½¿ç”¨ <code>__radd__</code> ç³»åˆ—çš„ method ä¾†å¯¦ä½œã€‚<br />
<br />
</span></span>ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="im">from</span> collections <span class="im">import</span> namedtuple</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="im">import</span> math</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw">class</span> Dual(namedtuple(<span class="st">&quot;Dual&quot;</span>, [<span class="st">&quot;x&quot;</span>, <span class="st">&quot;dx&quot;</span>])):</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="co">&#39;&#39;&#39;dx è¿½è¹¤ x çš„è®ŠåŒ–å°ç•¶ä¸‹è¼¸å‡ºçš„å½±éŸ¿&#39;&#39;&#39;</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="kw">def</span> <span class="fu">__add__</span>(<span class="va">self</span>, other):</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">        <span class="cf">return</span> Dual(<span class="va">self</span>.x <span class="op">+</span> other.x, <span class="va">self</span>.dx <span class="op">+</span> other.dx)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="kw">def</span> <span class="fu">__mul__</span>(<span class="va">self</span>, other):</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">        <span class="cf">return</span> Dual(<span class="va">self</span>.x <span class="op">*</span> other.x, other.x <span class="op">*</span> <span class="va">self</span>.dx <span class="op">+</span> <span class="va">self</span>.x <span class="op">*</span> other.dx)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="co"># ä¸‹ç•¥</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="kw">def</span> sin(dual):</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    <span class="co"># inline chain rule here</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="cf">return</span> Dual(math.sin(dual.x), dual.dx <span class="op">*</span> math.cos(dual.x))</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co"># é€™é‚Šçœç•¥å…¶ä»–å‡½æ•¸</span></a></code></pre></div>
<p>èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥é€éæ§åˆ¶<code>Dual(x, dx)</code>çš„<code>dx</code>ä¾†åˆ†åˆ¥è¨ˆç®— <span class="math inline">\(\frac{\partial f}{\partial x}\)</span> è·Ÿ <span class="math inline">\(\frac{\partial f}{\partial y}\)</span></p>
<p><span><label for="sn-8" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-8" class="margin-toggle"/><span class="marginnote"> <a href="https://upload.wikimedia.org/wikipedia/commons/a/a4/ForwardAccumulationAutomaticDifferentiation.png"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/ForwardAccumulationAutomaticDifferentiation.png/512px-ForwardAccumulationAutomaticDifferentiation.png" /></a> é€™æ˜¯ Wikipedia ä¸Šé¢å° <span class="math inline">\(Y = f(x,y) = sin(x) + x Ã— y\)</span> åš forward-mode AD çš„ç¤ºæ„åœ–ã€‚<br />
By Berland at English Wikipedia [Public domain], via Wikimedia Commons<br />
<br />
</span></span></p>
<p><span class="math display">\[f(x,y) = sin(x) + x*y\]</span></p>
<p>ï¼ˆ<code class="sourceCode python">Dual(x, <span class="dv">1</span>)</code> å°æ‡‰åˆ° <span class="math inline">\(\frac{dx}{dx} = 1\)</span>ï¼›<code class="sourceCode python">Dual(c, <span class="dv">0</span>)</code> å°æ‡‰åˆ° <span class="math inline">\(\frac{dc}{dx} = 0\)</span>ï¼‰</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># è¦è¨ˆç®—åå°æ•¸çš„å‡½æ•¸å¯ä»¥ç”¨æœ¬ä¾†çš„å¯«æ³•ï¼Œè€Œä¸ç”¨è‡ªå¹¹ï¼Œæœ‰æ²’æœ‰æ„Ÿè¦ºåˆ°ã€Œè‡ªå‹•ã€ï¼Ÿ</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">def</span> f(x, y):</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="cf">return</span> sin(x) <span class="op">+</span> x<span class="op">*</span>y</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">f(Dual(<span class="dv">3</span>, <span class="dv">1</span>), Dual(<span class="dv">2</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co"># Dual(x=6.141120008059867, dx=1.0100075033995546)</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">f(Dual(<span class="dv">3</span>, <span class="dv">0</span>), Dual(<span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co"># Dual(x=6.141120008059867, dx=3.0)</span></a></code></pre></div>
<p>é€™æ˜¯æ€éº¼è¾¦åˆ°çš„ï¼Ÿæˆ‘å€‘å¯ä»¥ç”¨é¡ä¼¼ Equational Reasoning<span><label for="sn-9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-9" class="margin-toggle"/><span class="sidenote">Equational Reasoning å°±åƒæ•¸å­¸è­‰æ˜ä¸€æ¨£ï¼Œæ¯”è¼ƒå¸¸ç”¨åœ¨ Pure Functional çš„ç¨‹å¼èªè¨€ä¸Šï¼Œä¸éæ—¢ç„¶é€™å€‹ä¾‹å­ä¹Ÿå¹¾ä¹æ˜¯ Pure Functional çš„ï¼Œåœ¨é€™é‚Šå°±ä½¿ç”¨é€™å€‹æŠ€å·§ä¾†èªªæ˜ã€‚<br />
<br />
</span></span> çš„æ–¹å¼ä¾†å±•é–‹ï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1">(  f(Dual(<span class="dv">3</span>, <span class="dv">1</span>), Dual(<span class="dv">2</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="op">==</span> sin(Dual(<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span> Dual(<span class="dv">3</span>, <span class="dv">1</span>) <span class="op">*</span> Dual(<span class="dv">2</span>,<span class="dv">0</span>)                        <span class="co"># definition of f</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="op">==</span> Dual(math.sin(<span class="dv">3</span>), <span class="dv">1</span> <span class="op">*</span> math.cos(<span class="dv">3</span>)) <span class="op">+</span> Dual(<span class="dv">3</span>, <span class="dv">1</span>) <span class="op">*</span> Dual(<span class="dv">2</span>,<span class="dv">0</span>)     <span class="co"># definition of sin</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="op">==</span> Dual(math.sin(<span class="dv">3</span>), <span class="dv">1</span> <span class="op">*</span> math.cos(<span class="dv">3</span>)) <span class="op">+</span> Dual(<span class="dv">3</span> <span class="op">*</span> <span class="dv">2</span>, <span class="dv">2</span> <span class="op">*</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> <span class="dv">0</span>) <span class="co"># definition of __mul__</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="op">==</span> Dual(math.sin(<span class="dv">3</span>) <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> <span class="dv">2</span>, <span class="dv">1</span> <span class="op">*</span> math.cos(<span class="dv">3</span>) <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> <span class="dv">0</span>)      <span class="co"># definition of __add__</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="op">==</span> Dual(x<span class="op">=</span><span class="fl">6.141120008059867</span>, dx<span class="op">=</span><span class="fl">1.0100075033995546</span>)  )</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co"># returns True since this is a valid python expression.</span></a></code></pre></div>
<p>é †å¸¶ä¸€æï¼Œæˆ‘å€‘ä¸éœ€è¦é¡å¤–å¯¦ä½œ Chain Ruleï¼Œå› ç‚ºå®ƒå·²ç¶“åŒ…å«åœ¨ Dual Number çš„ç®—è¡“ç³»çµ±å…§äº†ã€‚</p>
<p><span><label for="sn-10" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-10" class="margin-toggle"/><span class="marginnote"> å¯ä»¥çœ‹åˆ°ç¬¬ 3 è¡Œçš„ <code>dx</code> æ­£å¥½ç­‰æ–¼æ‡‰ç”¨ Chain Rule æ±‚å‡ºçš„ <span class="math inline">\(\frac{\partial sin(sin(x))}{\partial x} = cos(x) Ã— cos(sin(x))\)</span>ã€‚<br />
é€™æ˜¯å› ç‚ºåœ¨ <code>sin(dual)</code> çš„å®šç¾©ä¸­ <code class="sourceCode python">Dual(math.sin(dual.x), dual.dx <span class="op">*</span> math.cos(dual.x))</code> è£¡é¢å°±å·²ç¶“ <em>inline</em> chain rule äº†<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python numberLines"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" data-line-number="1">(  sin(sin(Dual(<span class="dv">1</span>, <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="op">==</span> sin(Dual(math.sin(<span class="dv">1</span>), <span class="dv">1</span> <span class="op">*</span> math.cos(<span class="dv">1</span>)))                          <span class="co"># definition of sin</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="op">==</span> Dual(math.sin(math.sin(<span class="dv">1</span>)), math.cos(<span class="dv">1</span>) <span class="op">*</span> math.cos(math.sin(<span class="dv">1</span>))) <span class="co"># definition of sin</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="op">==</span> Dual(x<span class="op">=</span><span class="fl">0.7456241416655579</span>, dx<span class="op">=</span><span class="fl">0.36003948908962097</span>) )</a></code></pre></div>
<!--

å·¦åœ–ç‚º$f = sin(x) + x * y$çš„ç¤ºæ„åœ–ï¼Œå³é‚Šç‚ºä»¥ Dual Number å¯¦ä½œçš„ç¤ºæ„åœ–ï¼š

~~~~
        f(x, y)    |       f(x, y); dfdx                      f(3,2); dfdx
          +-+      |          +---+---+                       +-----+-----+
          |+|      |          | + | + |                       |6.14 | 1.01|
          +-+      |          +---+---+                       +-----+-----+
         /  \      |          /       \                        /       \
        /    \     |         /         \                      /         \
    +---+     +-+  |  +------+------+  +--+----------+   +----+-----+   +--+--+
    |sin|     |Ã—|  |  |sin(a)|cos(a)|  |Ã— | a*db+b*db|   |0.14|-0.98|   | 6| 2|
    +---+     +-+  |  +------+------+  +--+----------+   +----+-----+   +--+--+
      |       /|   |        |           / |                   |          / |
      | _____/ |   |        |  ________/  |                   |  _______/  |
      |/       |   |        | /           |                   | /          |
     +-+      +-+  |     +--+--+       +--+--+             +--+--+      +--+--+
     |x|      |y|  |     |x | 1|       |y | 0|             |3 | 1|      |2 | 0|
     +-+      +-+  |     +--+--+       +--+--+             +--+--+      +--+--+
~~~~

-->
<p>é€™å€‹æ–¹æ³•çš„å•é¡Œæ˜¯æ¯ä¸€å€‹åƒæ•¸<span class="math inline">\(x_i\)</span>éƒ½å¿…é ˆç®—éä¸€æ¬¡ï¼Œé¡ç¥ç¶“çš„æ¢¯åº¦ä¾†èªªéœ€è¦<span class="math inline">\(O(n)\)</span>çš„æ™‚é–“æ‰èƒ½ç®—å®Œï¼ˆ<span class="math inline">\(n\)</span>æ˜¯åƒæ•¸çš„å€‹æ•¸ï¼‰ï¼Œä¸¦ä¸æ˜¯å¾ˆé©åˆé¡ç¥ç¶“ç¶²è·¯è¨ˆç®—æ¢¯åº¦ï¼ˆå› ç‚º<span class="math inline">\(n\)</span>é€šå¸¸éƒ½ä¸å°ï¼‰ã€‚</p>
</section>
</section>
<section id="å°çµ" class="level1">
<h1>å°çµ</h1>
<p>æœ¬æ–‡ä»‹ç´¹äº†</p>
<ul>
<li>Numerical Differentialï¼Œç”¨è¿‘ä¼¼çš„æ–¹æ³•è¨ˆç®—ï¼Œå…¶å„ªé»æ˜¯å¯¦ä½œæœ€ç°¡å–®ï¼Œç¼ºé»æ˜¯è¨ˆç®—èª¤å·®å¤§åˆ°ä¸å¤ å¯¦ç”¨</li>
<li>Symbolic Differentialï¼Œå…¶å¯¦å°±æ˜¯æŠŠäººé¡è¨ˆç®—å¾®åˆ†çš„éç¨‹ç”¨é›»è…¦å¯¦ä½œï¼Œå¯ä»¥å¾—åˆ°æ­£ç¢ºçš„æ•¸å€¼ï¼Œä½†æ˜¯æœƒé‡åˆ°ç®—å¼è†¨è„¹çš„å•é¡Œ</li>
<li>Forward-Mode Automatic Differentialï¼Œæ‡‰ç”¨äº† chain ruleï¼Œåœ¨è¨ˆç®—çš„éç¨‹ä¹Ÿå¯ä»¥ç°¡å–®çš„ç®—å‡ºæ­£ç¢ºçš„åå°æ•¸ï¼Œä½†æ˜¯ä¸é©åˆè¨ˆç®—æ¢¯åº¦ã€‚</li>
</ul>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« æœƒä»‹ç´¹ Reverse-Mode Automatic Differentialï¼Œæ˜¯ Forward-Mode ç›¸åæ–¹å‘çš„ç‰ˆæœ¬ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ back propagation çš„ general ç‰ˆæœ¬ã€‚</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Automatic_differentiation">Automatic differentiation on Wikipedia</a></li>
<li><a href="https://idontgetoutmuch.wordpress.com/2013/10/13/backpropogation-is-just-steepest-descent-with-automatic-differentiation-2">Backpropogation is Just Steepest Descent with Automatic Differentiation</a></li>
<li><a href="https://arxiv.org/pdf/1502.05767.pdf">Automatic Differentiation in Machine Learning: a Survey</a></li>
<li><a href="https://arxiv.org/pdf/1404.7456.pdf">Automatic Differentiation of Algorithms for Machine Learning</a></li>
</ul>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<section id="example-logistic-regression" class="level2">
<h2>Example: Logistic Regression</h2>
<p>é€™é‚Šç”¨æŒ‘æˆ°è€…è™Ÿçš„Oå‹ç’°å¤±æ•ˆè³‡æ–™<span><label for="sn-11" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-11" class="margin-toggle"/><span class="marginnote"> é¸é€™ä»½è³‡æ–™æ˜¯å› ç‚ºæˆ‘æœ€è¿‘åœ¨è®€ â€œProbabilistic Programming &amp; Bayesian Methods for Hackersâ€ å‰›å¥½ä»‹ç´¹åˆ°é€™ä¸€ä»½<a href="https://raw.githubusercontent.com/CamDavidsonPilon/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers/master/Chapter2_MorePyMC/data/challenger_data.csv">è³‡æ–™é›†</a>ã€‚<br />
<br />
</span></span>ä½œç‚ºç¯„ä¾‹ï¼Œä»¥ä¸Šè¿°çš„ Forward-Mode AD<span><label for="sn-12" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-12" class="margin-toggle"/><span class="marginnote"> <strong>æ³¨æ„:</strong> é€™é‚Šçš„ <code>forwardad</code> å·²ç¶“æœ‰å¯¦ä½œ <code>__radd__</code>, <code>exp</code>, <code>log</code>â€¦ç­‰æ»¿è¶³ä¸‹é¢ç¨‹å¼æ‰€éœ€çš„æœ€å°éœ€æ±‚ã€‚<br />
<br />
</span></span> å¯¦ä½œ Gradient Descent ä¾†é€²è¡Œ Logistic Regressionã€‚</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="im">from</span> forwardad <span class="im">import</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="im">from</span> io <span class="im">import</span> StringIO</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">data <span class="op">=</span> StringIO(<span class="st">&#39;Date,Temperature,Damage Incident</span><span class="ch">\n</span><span class="st">04/12/1981,66,0.0</span><span class="ch">\n</span><span class="st">11/12/1981,70,1.0</span><span class="ch">\n</span><span class="st">3/22/82,69,0.0</span><span class="ch">\n</span><span class="st">6/27/82,80,</span><span class="ch">\n</span><span class="st">01/11/1982,68,0.0</span><span class="ch">\n</span><span class="st">04/04/1983,67,0.0</span><span class="ch">\n</span><span class="st">6/18/83,72,0.0</span><span class="ch">\n</span><span class="st">8/30/83,73,0.0</span><span class="ch">\n</span><span class="st">11/28/83,70,0.0</span><span class="ch">\n</span><span class="st">02/03/1984,57,1.0</span><span class="ch">\n</span><span class="st">04/06/1984,63,1.0</span><span class="ch">\n</span><span class="st">8/30/84,70,1.0</span><span class="ch">\n</span><span class="st">10/05/1984,78,0.0</span><span class="ch">\n</span><span class="st">11/08/1984,67,0.0</span><span class="ch">\n</span><span class="st">1/24/85,53,1.0</span><span class="ch">\n</span><span class="st">04/12/1985,67,0.0</span><span class="ch">\n</span><span class="st">4/29/85,75,0.0</span><span class="ch">\n</span><span class="st">6/17/85,70,0.0</span><span class="ch">\n</span><span class="st">7/29/85,81,0.0</span><span class="ch">\n</span><span class="st">8/27/85,76,0.0</span><span class="ch">\n</span><span class="st">10/03/1985,79,0.0</span><span class="ch">\n</span><span class="st">10/30/85,75,1.0</span><span class="ch">\n</span><span class="st">11/26/85,76,0.0</span><span class="ch">\n</span><span class="st">01/12/1986,58,1.0</span><span class="ch">\n</span><span class="st">1/28/86,31,1.0</span><span class="ch">\n</span><span class="st">&#39;</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">df <span class="op">=</span> pd.read_csv(data).dropna()</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">X <span class="op">=</span> df[<span class="st">&#39;Temperature&#39;</span>].tolist()</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">Y <span class="op">=</span> df[<span class="st">&#39;Damage Incident&#39;</span>].tolist()</a></code></pre></div>
<p>é€™é‚Šä½¿ç”¨ logistic function åšæ¨¡å‹ï¼Œbinary cross-entropy ä½œç‚º loss functionã€‚</p>
<p><span class="math display">\[
\begin{gathered}
f(x) = \frac{1}{1+ exp(\beta x + \alpha)} \\
Cost(y, \hat y) = -\frac{1}{N}\sum_{i=1}^N \bigg[ y_i \log(\hat{y}_i)+(1-y_i) \log(1-\hat{y}_i) \bigg]
\end{gathered}
\]</span> <span><label for="sn-13" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-13" class="margin-toggle"/><span class="marginnote"> é€™é‚Šå¯ä»¥çœ‹åˆ°ï¼Œå¯«å‡ºä¾†çš„ç¨‹å¼å¹¾ä¹æ²’æœ‰ç‚ºäº†è¨ˆç®—å¾®åˆ†è€Œæ”¹è®Šï¼Œè€Œæ˜¯ç…§è‘—æœ¬ä¾†çš„å®šç¾©åœ¨å¯«ã€‚<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">def</span> f(alpha, beta, x):</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">    <span class="cf">return</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp(beta <span class="op">*</span> x <span class="op">+</span> alpha))</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw">def</span> cross_entroy(Y, Y_):</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    loss <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="cf">for</span> y, y_ <span class="kw">in</span> <span class="bu">zip</span>(Y, Y_):</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">        loss <span class="op">-=</span> y <span class="op">*</span> log(y_) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> y) <span class="op">*</span> log(<span class="dv">1</span> <span class="op">-</span> y_)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    <span class="cf">return</span> loss <span class="op">/</span> <span class="bu">len</span>(Y)</a></code></pre></div>
<p>æœ€å¾Œä½¿ç”¨ Gradient Descent ä¾†æ‰¾å‡º <span class="math inline">\(\alpha, \beta\)</span>ã€‚</p>
<p><span><label for="sn-14" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-14" class="margin-toggle"/><span class="marginnote"> <code>alpha</code>, <code>beta</code>, <code>lr</code>, <code>n_epoch</code> é€™äº›åƒæ•¸éƒ½æ˜¯å¯ä»¥è¨­å®šçš„ã€‚<br />
<br />
</span></span></p>
<p><span><label for="sn-15" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-15" class="margin-toggle"/><span class="marginnote"> å—é™æ–¼ Forward-Mode AD å…ˆå¤©ä¸Šçš„é™åˆ¶ï¼Œ<span class="math inline">\(\alpha\)</span> è·Ÿ <span class="math inline">\(\beta\)</span> çš„å¾®åˆ†éœ€è¦åˆ†é–‹è¨ˆç®—ã€‚<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" data-line-number="1">alpha <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">beta  <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">lr <span class="op">=</span> <span class="fl">0.005</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">n_epoch <span class="op">=</span> <span class="dv">1000</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co"># ç‚ºäº†é¿å… log(0) ï¼Œé€™é‚Šå…ˆç½®æ›æˆ 0 â‰ˆ 1e-18</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">Y <span class="op">=</span> [<span class="fl">1e-18</span> <span class="cf">if</span> x <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> x <span class="cf">for</span> x <span class="kw">in</span> Y]</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(n_epoch):</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    Y_alpha <span class="op">=</span> [f(Dual(alpha, <span class="dv">1</span>), beta, x) <span class="cf">for</span> x <span class="kw">in</span> X]</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    Y_beta  <span class="op">=</span> [f(alpha, Dual(beta, <span class="dv">1</span>), x) <span class="cf">for</span> x <span class="kw">in</span> X]</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    loss_alpha <span class="op">=</span> cross_entroy(Y, Y_alpha)</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">    loss_beta  <span class="op">=</span> cross_entroy(Y, Y_beta)</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">    <span class="cf">if</span> epoch <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">        <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="sc">{</span>epoch<span class="sc">: 5d}</span><span class="ss"> loss </span><span class="sc">{</span>loss_alpha<span class="sc">.x}</span><span class="ss"> alpha </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss"> beta </span><span class="sc">{</span>beta<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">    alpha <span class="op">-=</span> lr <span class="op">*</span> loss_alpha.dx</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">    beta  <span class="op">-=</span> lr <span class="op">*</span> loss_beta.dx</a></code></pre></div>
<p>é€™é‚Šæ˜¯ä¸Šé¢ç¨‹å¼åŸ·è¡Œçš„çµæœï¼ˆé‡æ–°æ’ç‰ˆéï¼‰ï¼Œå¯ä»¥çœ‹åˆ° Learning Rate è¨­å®šçš„æœ‰é»å¤ªå¤§äº†ã€‚æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥è©¦è‘—è‡ªå·±å¯¦ä½œçœ‹çœ‹ã€‚</p>
<pre><code>    0 loss 0.693147180559945  alpha  0                   beta  0
  100 loss 0.966931426916483  alpha -0.0201008838271800  beta  0.0465418617995232
  200 loss 1.114664696718874  alpha -0.0417346760460772  beta -0.0170795861942109
  300 loss 3.558155059566457  alpha -0.0595466871292758  beta  0.1800165252346373
  400 loss 0.961973323155755  alpha -0.0821799396148940  beta  0.0472951650365717
  500 loss 1.110644944663376  alpha -0.1037522632990092  beta -0.0161308641984885
  600 loss 3.555985812065263  alpha -0.1215047609258659  beta  0.1809462252622945
  700 loss 0.957097575658038  alpha -0.1440822016889158  beta  0.0480494092224557
  800 loss 1.106712443731962  alpha -0.1655931706446121  beta -0.0151865701942648
  900 loss 3.553772437842705  alpha -0.1832862200585766  beta  0.1818707335807102</code></pre>
</section>
</section>]]></description>
    <pubDate>Tue, 09 Jan 2018 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-12-17-autodiff.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>æ›´æ› blog ä¸»é¡Œä»¥è¿æ¥ 2018 å¹´</title>
    <link>https://op8867555.github.io/posts/2018-01-05-new-style.html</link>
    <description><![CDATA[<section>
<p>éäº† 2017ï¼Œæˆ‘æ±ºå®šæ›æ‰ä¹‹å‰ç”¨ Google çš„ <a href="https://getmdl.io/">Material Design Lite</a> æ‰‹åˆ»çš„ cssï¼Œæ”¹ç”¨äº† <a href="https://github.com/edwardtufte/tufte-css">Tufte CSS</a> <span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote">æ­£ç¢ºä¾†èªªæ˜¯å®ƒçš„ pandoc ç‰ˆ fork â€œ<a href="https://github.com/jez/tufte-pandoc-css">tufte-pandoc-css</a>â€<br />
<br />
</span></span> é€™å¥—ä»¥ Edward Tufte çš„æ›¸ç±åŠæ‰‹ç¨¿<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote">æˆ‘æ²’çœ‹éï¼Œä½†æ˜¯å°±æ˜¯æ¨£åˆ©ç”¨å…©æ¬„è¨­è¨ˆï¼ŒæŠŠ foot note æ”¹ä½œ side note çš„é¢¨æ ¼ã€‚<br />
<br />
</span></span>çš„é¢¨æ ¼ç‚ºåŸºç¤çš„ä¸»é¡Œã€‚</p>
<p>é€™é‚Šç‰¹åœ°æˆªäº†å…©è€…çš„æˆªåœ–ä»¥ä½œç‚ºç´€å¿µï¼ˆä¸éå…¶å¯¦<code>git checkout</code>ä¸€ä¸‹ä¹Ÿè¡Œï¼‰</p>
<p><span><label for="sn-3" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="marginnote"> ä¹‹å‰çš„ä¸»é¡Œèµ° Material Design çš„å¡ç‰‡é¢¨æ ¼ï¼Œä»¥ç„¡è¥¯ç·šçš„é»‘é«”ç‚ºä¸»ã€‚ <a href="https://i.imgur.com/TQjq0Ju.png"><img src="https://i.imgur.com/TQjq0Ju.png" /></a><br />
<br />
</span></span></p>
<p><a href="https://i.imgur.com/e5mGJpO.png"><img src="https://i.imgur.com/e5mGJpO.png" /></a></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘é‚„åšäº†ï¼š</p>
<ul>
<li>æ”¹ç”¨ <a href="https://khan.github.io/KaTeX/"><span class="math inline">\(\KaTeX\)</span></a> é€™å€‹å‰ç«¯æ¸²æŸ“å¼•æ“ä¾†å‘ˆç¾ LaTeX çš„é‹ç®—å¼ï¼Œç›¸è¼ƒæ–¼ä¹‹å‰ pandoc çš„åŸºæœ¬æ¬¾å¯¦ä½œæ”¯æ´æ›´å¤šèªæ³•ï¼Œè€Œä¸”æ¸²æŸ“çµæœä¹Ÿå¥½çœ‹äº†ä¸å°‘ã€‚</li>
<li>ä½¿ç”¨ pandoc çš„ <code>eastAsianLineBreakFilter</code> ä¾†æ”¹é€²ä¸­æ–‡æ–·è¡Œçš„å‘ˆç¾ã€‚</li>
</ul>
</section>]]></description>
    <pubDate>Fri, 05 Jan 2018 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2018-01-05-new-style.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>ç­†è¨˜ï¼šå¹¾å€‹ CLI å¯¦ç”¨å·¥å…·: ag, fzf, fd, ripgrep</title>
    <link>https://op8867555.github.io/posts/2017-11-27-cli-tools-ag-rg-fzf-fd.html</link>
    <description><![CDATA[<p>ç­†è¨˜æœ€è¿‘ç”¨çš„å¹¾å€‹ CLI å·¥å…·ã€‚</p>
<section id="the-silver-searcher" class="level1">
<h1>The Silver Searcher</h1>
<p><a href="https://github.com/ggreer/the_silver_searcher">The Silver Searcher</a> æ˜¯ä¸€å€‹é¡ä¼¼ ack çš„æœå°‹å·¥å…·ï¼Œä¹Ÿå°±æ˜¯æ‰¾å‡ºå‡ºç¾æŸå­—ä¸²çš„æ‰€æœ‰æª”æ¡ˆã€‚</p>
<ul>
<li>é£›å¤©å¿«</li>
<li>é è¨­æ’é™¤ <code>.gitignore</code> <code>.hgignore</code> è£¡çš„ pattern</li>
<li>å…¶ä»–ä¸æƒ³è¦çš„ pattern å¯ä»¥å¯«åœ¨ <code>.ignore</code></li>
<li>ç”¨ c å¯¦ä½œ</li>
<li>ç›´åˆ° <span class="citation" data-cites="caasih">@caasih</span> æåˆ°ä¹‹å‰æˆ‘éƒ½æ²’ç™¼ç¾åŸ·è¡Œæª”åç¨± <code>ag</code> æ˜¯æ°´éŠ€çš„å…ƒç´ ç¬¦è™Ÿ</li>
</ul>
</section>
<section id="ripgrep" class="level1">
<h1>ripgrep</h1>
<p><a href="https://github.com/BurntSushi/ripgrep">Ripgrep</a> è·Ÿå‰è¿°çš„ The Silver Searcher åŠŸèƒ½å·®ä¸å¤š</p>
<ul>
<li>ä½†æ˜¯æ¯”é£›å¤©å¿«é‚„å¿«</li>
<li>å°æ–¼ ignore æª”æ¡ˆçš„å¯¦ä½œæ›´æ­£ç¢ºï¼Œag æœƒå¤šåä¸€äº›ä¸æ‡‰è©²å‡ºç¾çš„çµæœ</li>
<li>regexp çš„åŠŸèƒ½æ¯”è¼ƒå°‘ï¼ˆæ¯”æ–¹èªªæˆ‘å¾ä¾†æ²’ç”¨éçš„ lookaround è·Ÿ backreference å°±æ²’æœ‰å¯¦ä½œï¼‰</li>
<li>ç”¨ rust å¯¦ä½œ</li>
</ul>
</section>
<section id="fd" class="level1">
<h1>fd</h1>
<p><a href="https://github.com/sharkdp/fd">fd</a> æ˜¯ä¸€å€‹é¡ä¼¼ find çš„æª”æ¡ˆæœå°‹å·¥å…·</p>
<ul>
<li>ä¹Ÿæœƒé è¨­æ’é™¤ <code>.gitignore</code></li>
<li>é è¨­æ’é™¤éš±è—æª”æ¡ˆ</li>
<li>ä¹Ÿæ˜¯é£›å¤©å¿«</li>
<li>ä¹Ÿæ˜¯ rust å¯¦ä½œ</li>
</ul>
<section id="ç¯„ä¾‹" class="level2">
<h2>ç¯„ä¾‹</h2>
<ul>
<li><p>ç”¨ regexp æœå°‹</p>
<pre><code>fd &#39;[0-9]\.jpg$&#39;</code></pre></li>
<li><p>æœå°‹éš±è—æª”æ¡ˆè·Ÿè¢« ignore çš„æª”æ¡ˆ</p>
<pre><code>fd -H -I &#39;[0-9]\.jpg$&#39;</code></pre></li>
<li><p>æœå°‹ç‰¹å®šå‰¯æª”å</p>
<pre><code>fd -e jpg</code></pre></li>
<li><p>å°æœå°‹çµæœä¸‹æŒ‡ä»¤<strong>å¹³è¡ŒåŸ·è¡Œ</strong></p>
<pre><code>fd -e jpg -x convert {} {.}.png</code></pre>
<table>
<thead>
<tr class="header">
<th>variable</th>
<th style="text-align: left;">example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{}</td>
<td style="text-align: left;">documents/images/party.jpg</td>
</tr>
<tr class="even">
<td>{.}</td>
<td style="text-align: left;">documents/images/party</td>
</tr>
<tr class="odd">
<td>{/}</td>
<td style="text-align: left;">party.jpg</td>
</tr>
<tr class="even">
<td>{//}</td>
<td style="text-align: left;">documents/images</td>
</tr>
<tr class="odd">
<td>{/.}</td>
<td style="text-align: left;">party</td>
</tr>
</tbody>
</table></li>
</ul>
</section>
</section>
<section id="fzf" class="level1">
<h1>fzf</h1>
<p><a href="https://github.com/junegunn/fzf">fzf</a> æ˜¯ä¸€å€‹ fuzzy finderï¼Œå°±æ˜¯ cmd+T æˆ–æ˜¯ ctrl+p æˆ–æ˜¯ä»»ä½•ä¸€å€‹ æ–‡å­—ç·¨è¼¯å™¨/IDE è£¡é¢ä¸ç”¨æ‰“å…¨åå°±å¯ä»¥æ‰¾æª”æ¡ˆçš„é‚£å€‹åŠŸèƒ½</p>
<ul>
<li>ç”¨ go å¯«çš„</li>
<li><p>é è¨­ç”¨ find ï¼Œæ‰€ä»¥å¾ˆæ…¢ï¼Œç”¨ç’°å¢ƒè®Šæ•¸å¯ä»¥æ›ç”¨ fd</p>
<p>export FZF_DEFAULT_COMMAND=â€˜fd â€“type f â€“follow â€“exclude .gitâ€™</p></li>
<li><p>ctrl+r ä¾†æœå°‹æ­·å²</p>
<blockquote class="imgur-embed-pub" lang="en" data-id="IwjCK2l">
<a href="//imgur.com/IwjCK2l">View post on imgur.com</a>
</blockquote>
<script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script></li>
<li><p><code>**&lt;tab&gt;</code> å¯ä»¥é¸å–å¤šå€‹æª”æ¡ˆ</p>
<blockquote class="imgur-embed-pub" lang="en" data-id="ocxqb0C">
<a href="//imgur.com/ocxqb0C">View post on imgur.com</a>
</blockquote>
<script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script></li>
<li><p>ctrl+t ä¾†æœå°‹æª”æ¡ˆ</p>
<blockquote class="imgur-embed-pub" lang="en" data-id="SfiGWjD">
<a href="//imgur.com/SfiGWjD">View post on imgur.com</a>
</blockquote>
<script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script></li>
</ul>
</section>]]></description>
    <pubDate>Mon, 27 Nov 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-11-27-cli-tools-ag-rg-fzf-fd.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>[EN] Use your UNIX toolbox with pandas</title>
    <link>https://op8867555.github.io/posts/2017-10-13-use-your-unix-toolbox-with-pandas.html</link>
    <description><![CDATA[<p>I do analysis on log / csv / json files with a Python + Pandas + Jupyter Notebook stack at work. These files are so large that I usually need to do some pre-processing before loading them into memory.</p>
<p>UNIX tools are powerful to stream processing files: concatenation, filtering, transformingâ€¦, but it is annoying to â€œcontext-switchâ€ between Jupyter Notebook and shell. Also, Itâ€™s generate immediate files that need to remove later manually, quite annoying.</p>
<p>After some stackoverflow-ing, I found a solution<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote"><a href="https://stackoverflow.com/questions/13651117/pandas-filter-lines-on-load-in-read-csv/13653490#13653490">pandas: filter lines on load in read_csv</a><br />
<br />
</span></span> says you can read files in chunks:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1">df <span class="op">=</span> pd.concat(process(chunk_df) <span class="co"># do processing in python</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">               <span class="cf">for</span> chunk_df <span class="kw">in</span> pd.read_csv(<span class="st">&#39;bigdata.csv&#39;</span>, chunksize<span class="op">=</span><span class="dv">10000</span>))</a></code></pre></div>
<p>But there is a big overhead to create/process immediate data-frames.</p>
<p>Another solution<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote"><a href="https://stackoverflow.com/questions/39864304/how-to-use-subprocess-and-cat-to-read-in-data-line-by-line/39864368#39864368">How to use subprocess and â€˜catâ€™ to read in data line by line?</a><br />
<br />
</span></span> says you can use <code>subprocess</code> with PIPE, a clever idea. So I end up with this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="im">from</span> subprocess <span class="im">import</span> Popen, PIPE</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="cf">with</span> Popen(<span class="st">&#39;cat bigdata.csv | grep WHAT_I_CARE_ABOUT | some_transformations&#39;</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">           shell<span class="op">=</span><span class="va">True</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">           stdout<span class="op">=</span>PIPE) <span class="im">as</span> process:</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    df <span class="op">=</span> pd.read_csv(process.stdout)</a></code></pre></div>
<p>With this trick, I can now do some bash-fu with pandas in Jupyter-Notebook easily.</p>
<p><strong>Reading multiples files</strong></p>
<pre class="shell"><code>cat stats/2017/*/*.csv</code></pre>
<p><strong>JSON query with jq</strong></p>
<pre class="shell"><code>cat data.json | jq &#39;{.loc = .loc}&#39;</code></pre>
<p><strong>filter lines with awk or grep</strong></p>
<pre class="shell"><code>zcat data.csv.gz | grep &#39;SOME_TAG&#39; | awk &#39;$1 == 2017&#39;</code></pre>
<p><strong>pipe over files in .tar</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="fu">tar</span> -xOf bigdatas.tar.gz --wildcards <span class="st">&quot;*.data.csv&quot;</span></a></code></pre></div>]]></description>
    <pubDate>Fri, 13 Oct 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-10-13-use-your-unix-toolbox-with-pandas.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>æ‡‰ç”¨ git bisect æ‰¾å‡º linux kernel ä¸­å‡ºç¾å•é¡Œçš„ commit</title>
    <link>https://op8867555.github.io/posts/2017-10-05-bisecting-linux-kernel-bug.html</link>
    <description><![CDATA[<section id="tldr" class="level3">
<h3>TL;DR</h3>
<p>é€™ç¯‡æ–‡ç« ç­†è¨˜æˆ‘ä½¿ç”¨ git bisect ä¾†æ‰¾å‡º linux kernel (drm/i915) ä¸­çš„å°è‡´è¡Œç‚ºç•°å¸¸çš„æ˜¯å“ªä¸€å€‹ commit çš„éç¨‹ã€‚</p>
</section>
<section id="èµ·å› " class="level1">
<h1>èµ·å› </h1>
<p>æˆ‘çš„ç­†é›»ä¸Šè£çš„æ˜¯ Arch Linuxï¼ŒChromium åœ¨ linux ä¸Šæ˜¯<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=463440">ä¸æœƒæœ‰ç¡¬é«”åŠ é€ŸåŠŸèƒ½</a>çš„ï¼Œç‚ºäº†æ¸›å°‘ CPU è³‡æºçš„æµªè²»ï¼Œä¹Ÿç‚ºäº†å¢åŠ çºŒèˆªåŠ›ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¸€å€‹éå®˜æ–¹ç‰ˆæœ¬çš„ <a href="https://aur.archlinux.org/packages/chromium-vaapi/">chromium-vaapi</a>ã€‚</p>
<p>æœ€è¿‘åšå®Œç³»çµ±æ›´æ–°ä¹‹å¾Œç™¼ç¾ç¡¬é«”åŠ é€Ÿçš„åŠŸèƒ½å‡ºäº†äº›ç•°å¸¸ï¼Œåœ¨è·Ÿ AUR package çš„ä½¿ç”¨è€…è¨è«–å¾Œå¾—çŸ¥ï¼š</p>
<ul>
<li>mesa çš„ç‰ˆæœ¬æœƒå½±éŸ¿ï¼Œä½†æ˜¯é™ç‰ˆä¹‹å¾Œæœ‰ä¸åŒçš„ç•°å¸¸</li>
<li>é€™å€‹ä¸åŒçš„ç•°å¸¸åªæœ‰åœ¨æ’­æ”¾ VP9 æ ¼å¼çš„å½±ç‰‡æ™‚æœƒç™¼ç”Ÿ</li>
<li>åœ¨ä¸€ç•ªäº‚è©¦ä¹‹å¾Œç™¼ç¾åˆ° kernel é™å› 4.12 å°±æ²’äº‹äº†ï¼</li>
</ul>
<p>åšäº†ä¸€äº›åŠŸèª²ä¹‹å¾Œï¼Œæˆ‘èªç‚ºé€™å€‹ bug æ˜¯ä¾†è‡ªæ–¼ linux kernel ä¸­ DRM/i915 çš„éƒ¨ä»½ï¼Œæ–¼æ˜¯æˆ‘ä¾¿é–‹å§‹å˜—è©¦å¾èŒ«èŒ« commit æµ·æ’ˆå‡ºé‚£å€‹é‡ã€‚</p>
</section>
<section id="æ‰¾å‡ºå•é¡Œä¹‹æ—…" class="level1">
<h1>æ‰¾å‡ºå•é¡Œä¹‹æ—…</h1>
<section id="drm-tip" class="level2">
<h2>drm-tip</h2>
<p>drm-tip æ˜¯è£¡é¢åŒ…å«è‘—ä¸åŒçš„å¹¾å€‹åœ˜éšŠæ‰€ç¶­è­·çš„ drm å¯¦ä½œçš„ linux kernel</p>
<figure>
<img src="https://01.org/linuxgraphics/gfx-docs/maintainer-tools/_images/drm-intel-flow.svg" alt="é€™å€‹ merge flow å¾ˆè¤‡é›œï¼Œæˆ‘ä¹Ÿé‚„æ²’ææ‡‚" /><figcaption>é€™å€‹ merge flow å¾ˆè¤‡é›œï¼Œæˆ‘ä¹Ÿé‚„æ²’ææ‡‚</figcaption>
</figure>
</section>
<section id="åœ¨-archlinux-ä¸Šç·¨è­¯" class="level2">
<h2>åœ¨ ArchLinux ä¸Šç·¨è­¯</h2>
<p>å¹¸å¥½æˆ‘ä¸å¿…äº†è§£ä»–å€‘æ˜¯æ€éº¼ mergeï¼Œåªéœ€è¦ build èµ·ä¾†èƒ½æ¸¬è©¦åŠŸèƒ½æ˜¯å¦æ­£å¸¸å³å¯ã€‚</p>
<ul>
<li>ä½¿ç”¨ AUR ä¸Šé¢çš„ <a href="https://aur.archlinux.org/cgit/aur.git/tree/PKGBUILD?h=linux-drm-tip-git&amp;id=f2f3487589a22ee728472259f4bd79af75bd782b">linux-drm-tip-git</a> é€™å€‹ package ç·¨è­¯æœ€æ–°çš„ç‰ˆæœ¬</li>
<li>é‡åˆ° <code>make prepare</code> è©¢å•åƒæ•¸æ˜¯å› ç‚º <code>config.x86-64</code> çš„ç‰ˆæœ¬ä¸å¤ æ–°
<ul>
<li>æˆ‘ç›´æ¥æ‰¾äº† <a href="https://aur.archlinux.org/packages/linux-mainline/">linux-mainline</a> çš„ä¾†ç”¨</li>
</ul></li>
<li>å…ˆç”¨ <code>makepkg -Asi</code> ç·¨è­¯å®‰è£ä¸€éã€‚</li>
<li>ç„¶å¾Œä½¿ç”¨é€™å€‹ç‰ˆæœ¬çš„ kernel å¾Œç™¼ç¾ã€æ©ã€å•é¡Œä¾èˆŠ</li>
</ul>
</section>
<section id="åŠ å¿«ç·¨è­¯é€Ÿåº¦" class="level2">
<h2>åŠ å¿«ç·¨è­¯é€Ÿåº¦</h2>
<p>æˆ‘ç”¨äº†å…©å€‹å·¥å…·ä¾†åŠ é€Ÿç·¨è­¯é€Ÿåº¦ï¼š</p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/ccache">ccache</a>: å¹« gcc åšå¿«å–ï¼Œæ”¹å–„é‡è¤‡ç·¨è­¯æ‰€éœ€çš„æ™‚é–“</li>
<li><a href="https://wiki.archlinux.org/index.php/Modprobed-db">modprobed-db</a>: æ¸›å°‘æ‰€éœ€ç·¨è­¯çš„æ¨¡çµ„æ•¸</li>
</ul>
</section>
<section id="bisect" class="level2">
<h2>bisect</h2>
<p>è¦å¾è‡³å°‘ 27000 ç­†çš„ commit ä¸­æ‰¾éŒ¯èª¤ï¼Œç•¶ç„¶ä¸æœƒä¸€ç­†ä¸€ç­†å˜—è©¦ã€‚é€™é‚Šä½¿ç”¨çš„ bisect å°±æ˜¯ç”¨ç¶“å…¸çš„æ¼”ç®—æ³•ã€ŒäºŒåˆ†æœå°‹æ³•ã€ä¾†åŠ å¿«å°‹æ‰¾çš„é€Ÿåº¦ã€‚</p>
<section id="æ­¥é©Ÿ" class="level3">
<h3>æ­¥é©Ÿ</h3>
<ul>
<li>ç·¨è­¯å®Œä¹‹å¾Œï¼Œé€² <code>src/drm-tip</code> åŸ·è¡Œ <code>git bisect start</code></li>
<li>ç¢ºèªå•é¡Œé‚„åœ¨ï¼Œæ¨™è¨˜ç‚ºæœ‰å•é¡Œçš„ç‰ˆæœ¬ <code>git bisect bad</code></li>
<li><code>git checkout</code> åˆ°èªç‚ºæ²’å•é¡Œçš„ç‰ˆæœ¬ï¼ˆå› ç‚ºæˆ‘çŸ¥é“ 4.12 æ²’æœ‰å•é¡Œï¼Œæ‰€ä»¥æˆ‘æ‰¾åˆ°å°æ‡‰çš„ commit æ˜¯<code>6f7da29</code>ï¼‰</li>
<li><code>makepkg -esfi</code> ç·¨è­¯ä¸¦å®‰è£æ­¤ç‰ˆæœ¬
<ul>
<li>å› ç‚º <code>git bisect</code> æœƒ checkout åˆ°ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥éœ€è¦ç”¨ <code>-e</code> ä¾†å‘Šè¨´ makepkg ä¸è¦é‡æ–° checkout</li>
</ul></li>
<li><p>é‡é–‹æ©Ÿæª¢æŸ¥å•é¡Œæ˜¯å¦é‚„åœ¨ï¼Œæ²’æœ‰å•é¡Œï¼Œç”¨ <code>git bisect good</code> æ¨™è¨˜</p>
<pre class="shell"><code>&gt; git bisect good
Bisecting: 13952 revisions left to test after this (roughly 14 steps)
[73adb8c5b0ea15e3942ab5781eb3e72d4e028ada] Merge tag &#39;for-4.13/dm-fixes-2&#39; of git://git.kernel.org/pub/scm/linux/kernel/git/device-mapper/linux-dm</code></pre></li>
</ul>
</section>
<section id="é ä¼°é‚„è¦å¹¾æ¬¡æŸ¥è©¢" class="level3">
<h3>é ä¼°é‚„è¦å¹¾æ¬¡æŸ¥è©¢</h3>
<ul>
<li><code>git rev-list drm-tip ^6f7da290413b --count</code> å‘Šè¨´æˆ‘é€™å…©å€‹ä¸­é–“å·®äº† 27906 å€‹ commit</li>
<li>æ‰€ä»¥æˆ‘é æœŸæœ€å¤šé‚„éœ€è¦ 16 æ¬¡çš„ç¯©é¸ (<span class="math inline">\(log_2(27906)+1 \approx 15.77\)</span>)</li>
</ul>
</section>
<section id="ç¹¼çºŒå°‹æ‰¾å•é¡Œ" class="level3">
<h3>ç¹¼çºŒå°‹æ‰¾å•é¡Œ</h3>
<p>é€™é‚Šå°±æ˜¯ä¸æ–·çš„é‡è¤‡ï¼š</p>
<ul>
<li>ç·¨è­¯</li>
<li>æ¸¬è©¦</li>
<li><code>git bisect [good|bad]</code></li>
</ul>
<pre class="half-page"><code>&gt; git bisect bad 73adb8c5b0ea
Bisecting: 6975 revisions left to test after this (roughly 13 steps)
[4f5dfdd29065a0d1d0e61d9744e14d1d852518be] Merge tag &#39;leds_for_4.13&#39; of git://git.kernel.org/pub/scm/linux/kernel/git/j.anaszewski/linux-leds

&gt; git bisect good 4f5dfdd29065
Bisecting: 3487 revisions left to test after this (roughly 12 steps)
[8c03cc85a035ae7a208c28c4382ecfeb6adf79a6] fs/proc/task_mmu.c: remove obsolete comment in show_map_vma()

&gt; git bisect bad 8c03cc85a035
Bisecting: 1723 revisions left to test after this (roughly 11 steps)
[2ceedf97aef41d071d897a6e6aec8c05fb707ec4] Merge tag &#39;dmaengine-4.13-rc1&#39; of git://git.infradead.org/users/vkoul/slave-dma

&gt; git bisect good 2ceedf97aef4
Bisecting: 818 revisions left to test after this (roughly 10 steps)
[04d4fb5fa63876d8e7cf67f2788aecfafc6a28a7] Merge branch &#39;drm-next-4.13&#39; of git://people.freedesktop.org/~agd5f/linux into drm-next

&gt; git bisect good 04d4fb5fa638
Bisecting: 420 revisions left to test after this (roughly 9 steps)
[00fc2c26bc46a64545cdf95a1511461ea9acecb4] drm: Remove unused drm_file parameter to drm_syncobj_replace_fence()

&gt; git bisect bad 00fc2c26bc46
Bisecting: 222 revisions left to test after this (roughly 8 steps)
[eafae133e48c9e5f5537d5c6df34eab912336b9a] Merge tag &#39;drm-msm-next-2017-06-20&#39; of git://people.freedesktop.org/~robclark/linux into drm-next

&gt; git bisect good eafae133e48c
Bisecting: 111 revisions left to test after this (roughly 7 steps)
[fc59921178fd63f1dbe445c2fc86e6ca997a4744] drm/i915/perf: Add more OA configs for BDW, CHV, SKL + BXT

&gt; git bisect good fc59921178fd
Bisecting: 55 revisions left to test after this (roughly 6 steps)
[7dd4f6729f9243bd7046c6f04c107a456bda38eb] drm/i915: Async GPU relocation processing

&gt; git bisect bad 7dd4f6729f92
Bisecting: 34 revisions left to test after this (roughly 5 steps)
[615c16a9d8649b9894592d11bc393e684b11e2ea] drm/i915/gvt: Refine virtual reset function

&gt; git bisect good 615c16a9d864
Bisecting: 17 revisions left to test after this (roughly 4 steps)
[f6262bda462e81e959b80a96dac799bd9df27f73] drm/i915: Don&#39;t enable backlight at setup time.

&gt; git bisect good f6262bda462e
Bisecting: 8 revisions left to test after this (roughly 3 steps)
[4c9c0d09741deab0aac76b83961cfe95b24f3e6f] drm/i915: Fix retrieval of hangcheck stats

&gt; git bisect good 4c9c0d09741d
Bisecting: 4 revisions left to test after this (roughly 2 steps)
[2889caa9232109afc8881f29a2205abeb5709d0c] drm/i915: Eliminate lots of iterations over the execobjects array

&gt; git bisect bad 2889caa92321
Bisecting: 1 revision left to test after this (roughly 1 step)
[507d977ff965682a925ffe479c95136680fcb77b] drm/i915: Pass vma to relocate entry

&gt; git bisect good 507d977ff965
Bisecting: 0 revisions left to test after this (roughly 0 steps)
[071750e550af46b5d3a84ad56c2a108c3e136284] drm/i915: Disable EXEC_OBJECT_ASYNC when doing relocations</code></pre>
</section>
<section id="æ‰¾å‡ºæœ‰å•é¡Œçš„-commit" class="level3">
<h3>æ‰¾å‡ºæœ‰å•é¡Œçš„ commit</h3>
<p>ä¸æ–·é‡è¤‡ä¸Šé¢çš„æ­¥é©Ÿï¼Œæœ€å¾Œæ‰¾å‡ºç¬¬ä¸€å€‹æœ‰å•é¡Œçš„ commit</p>
<pre><code>&gt; git bisect good 071750e550af
2889caa9232109afc8881f29a2205abeb5709d0c is the first bad commit</code></pre>
</section>
</section>
</section>
<section id="å¾Œè¨˜" class="level1">
<h1>å¾Œè¨˜</h1>
<p>é€™å€‹éç¨‹ä¸¦ä¸æ˜¯å¾ˆè¼•é¬†ï¼ˆç·¨è­¯ä¸€æ¬¡è‡³å°‘éœ€è¦ 10minï¼Œé‚„è¦é‡é–‹æ©Ÿæ¸¬è©¦ï¼‰ï¼Œå°‡é€™å€‹æ‰¾åˆ°çš„é€™å€‹ commit å›å ±ä¸Šå»ä¹‹å¾Œï¼Œé–‹ç™¼è€…å¾ˆå¿«çš„å°±èƒ½æ‰¾åˆ°å•é¡Œçš„é—œéµé»ã€‚</p>
<p>æœ€å¾Œå¾—åˆ°çš„çµè«–æ˜¯ï¼Œé€™å€‹å•é¡Œæ‡‰è©²æ˜¯ä¾†è‡ª user space driver æ²’æœ‰å¯¦ä½œæ­£ç¢ºï¼Œæ–¼æ˜¯æˆ‘å›å»æ‰¾äº† intel-vaapi-driver çš„ issue trackerï¼Œæ‰ç™¼ç¾åˆ°åŸä¾†æ—©åœ¨ 3 å€‹æ˜ŸæœŸå‰å°±æœ‰äºº<a href="https://github.com/01org/intel-vaapi-driver/issues/262">å›å ±</a>éï¼Œè€Œä¸”ä¹Ÿå·²ç¶“ä¿®æ­£ä¸¦ merge å› master äº†ã€‚å›§</p>
<p>é›–ç„¶æœ€å¾Œç™¼ç¾ä¸æ˜¯ linux kernel çš„å•é¡Œï¼Œä¸éé€™ä¹Ÿä¾ç„¶æ˜¯å€‹å‹™å¯¦çš„é™¤éŒ¯ç¶“é©—ã€‚</p>
</section>
<section id="åƒè€ƒè³‡æ–™" class="level1">
<h1>åƒè€ƒè³‡æ–™</h1>
<p><strong>drm/i915</strong></p>
<ul>
<li><a href="https://01.org/linuxgraphics/documentation/how-report-bugs">how to report bugs</a></li>
<li><a href="https://01.org/linuxgraphics/gfx-docs/maintainer-tools/drm-intel.html">drm-intel</a></li>
</ul>
<p><strong>git bisect</strong></p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Bisecting_bugs">Bisecting bugs</a></li>
<li><a href="https://project-insanity.org/blog/2013/02/13/how-i-found-a-kernel-regression-using-git-bisect/">How I fixed a kernel regression using git bisect</a></li>
</ul>
</section>]]></description>
    <pubDate>Thu, 05 Oct 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-10-05-bisecting-linux-kernel-bug.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>ç”¨ Python è¨ˆç®—ç¶“ç·¯åº¦å°æ‡‰çš„é„‰é®å¸‚å€</title>
    <link>https://op8867555.github.io/posts/2017-09-16-python-getting-town-from-gps-coord.html</link>
    <description><![CDATA[<section id="tldr" class="level3">
<h3>TL;DR</h3>
<p>é€™ç¯‡æ–‡ç« ç­†è¨˜æœ€è¿‘æœ‹å‹å•çš„ä¸€å€‹å•é¡Œï¼š å¦‚ä½•ä¸é å¤–éƒ¨ API å–å¾—ä¸€å€‹ç¶“ç·¯åº¦åº§æ¨™è½åœ¨å“ªä¸€å€‹é„‰é®å¸‚å€ã€‚</p>
<p>é€™é‚Šæ‡‰ç”¨æ”¿åºœ open data çš„ <a href="https://data.gov.tw/dataset/7441">é„‰é®å¸‚å€ç•Œç·š</a> è³‡æ–™ï¼ŒåŠ ä¸Š python çš„ shapely åšç¯„åœåˆ¤æ–·ã€ç”¨ rtree å»ºç«‹ç´¢å¼•åŠ é€ŸæŸ¥è©¢ã€‚</p>
</section>
<section id="å¯¦ä½œç­†è¨˜" class="level1">
<h1>å¯¦ä½œç­†è¨˜</h1>
<p>æƒ³æ³•å¾ˆå–®ç´”ï¼Œå°±æ˜¯é€éåˆ¤æ–·åº§æ¨™(è¼¸å…¥çš„ç¶“ç·¯åº¦)æœ‰æ²’æœ‰è½åœ¨å¤šé‚Šå½¢(é„‰é®é‚Šç•Œ)çš„ç¯„åœå…§ã€‚</p>
<section id="è³‡æ–™ä¾†æº" class="level2">
<h2>è³‡æ–™ä¾†æº</h2>
<p>æ”¿åºœæœ‰æä¾›<a href="https://data.gov.tw/dataset/7441">é„‰é®å¸‚å€ç•Œç·š</a>è³‡æ–™ï¼Œæ˜¯ä¸€å€‹ <a href="https://en.wikipedia.org/wiki/Shapefile">Shapefile</a>ã€‚ Python è¦è®€å– .shp æª”ä¸é›£ï¼Œæœ‰å¾ˆå¤š library å¯ä»¥åšåˆ°ï¼Œå¯ä»¥åƒè€ƒ<a href="https://gis.stackexchange.com/questions/113799/how-to-read-a-shapefile-in-python">é€™ç¯‡</a>ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> fiona</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">from</span> shapely.geometry <span class="im">import</span> shape, Point</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">collection <span class="op">=</span> fiona.<span class="bu">open</span>(<span class="st">&#39;./TOWN_MOI_1060525.shp&#39;</span>)</a></code></pre></div>
</section>
<section id="æŸ¥è©¢" class="level2">
<h2>æŸ¥è©¢</h2>
<p>é€™é‚Šæˆ‘ä½¿ç”¨çš„æ˜¯ <code>shapely</code> é€™å€‹å¥—ä»¶ä¾†è¨ˆç®—åº§æ¨™æœ‰ç„¡åº§è½æ–¼æŸå€‹å¤šé‚Šå½¢ã€‚ æ‰€ä»¥å…ˆå°‡ .shp å…§çš„ geometry å»ºç«‹æˆ shapely çš„ Polygon ç‰©ä»¶ï¼š</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1">shapes <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">properties <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="cf">for</span> f <span class="kw">in</span> collection:</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">    town_id <span class="op">=</span> <span class="bu">int</span>(f[<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;TOWNCODE&#39;</span>])</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    shapes[town_id] <span class="op">=</span> shape(f[<span class="st">&#39;geometry&#39;</span>])</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    properties[town_id] <span class="op">=</span> f[<span class="st">&#39;properties&#39;</span>]</a></code></pre></div>
<p>é€™æ¨£å°±å¯ä»¥ç”¨ <code class="sourceCode python">polygon.contains(Point(x, y))</code> åˆ¤æ–·ä¸€å€‹é»æœ‰æ²’æœ‰åº§è½æ–¼å…¶ä¸­ã€‚å°é€™æ‰€æœ‰çš„å¤šé‚Šå½¢èµ°è¨ªä¸€éå°±å¯ä»¥çŸ¥é“åº§è½æ–¼å“ªè£¡ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">def</span> search(x, y):</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="cf">return</span> <span class="bu">next</span>((town_id</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                 <span class="cf">for</span> town_id <span class="kw">in</span> shapes</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                 <span class="cf">if</span> shapes[town_id].contains(Point(x, y))), <span class="va">None</span>)</a></code></pre></div>
</section>
<section id="åŠ é€ŸæŸ¥è©¢" class="level2">
<h2>åŠ é€ŸæŸ¥è©¢</h2>
<p>ä¸Šé¢çš„æŸ¥è©¢å¾ˆå–®ç´”åœ°æ¸¬è©¦å…¨å°ç£ 368 å€‹é„‰é®å¸‚çš„å¤šé‚Šå½¢äº†ä¸€éï¼Œå¦‚æœæ˜¯å°é‡çš„è¼¸å…¥è³‡æ–™æ‡‰è©²é‚„ç®—æ˜¯å¯ä»¥æ¥å—ï¼Œä¸éå¦‚æœéœ€è¦æ›´ç´°çš„æ¯”å°ï¼ˆè¨ˆç®—åˆ°æ‘é‡Œï¼‰ã€æˆ–æ˜¯æœ‰å¤§é‡è³‡æ–™è¦è¨ˆç®—çš„è©±ï¼Œé€™æ¨£çš„æ–¹æ³•é‚„æ˜¯ä¸å¤ æœ‰æ•ˆç‡ã€‚</p>
<p>å› ç‚ºåœ¨æŸ¥è©¢ä¸€å€‹å°åŒ—çš„åº§æ¨™æ™‚ï¼Œå…¶å¯¦ä¸ç”¨è€ƒæ…®é›¢ä»–å¤ªé çš„å°ä¸­ã€å°å—â€¦ç­‰å…¶ä»–é„‰é®å¸‚å€ã€‚</p>
<p>åŸºæ–¼é€™æ¨£çš„æƒ³æ³•ï¼Œé€™é‚Šç”¨ R-Tree é€™å€‹<a href="https://en.wikipedia.org/wiki/R-tree">è³‡æ–™çµæ§‹</a>ä¾†å¹«é€™äº›å¤šé‚Šå½¢çš„ bounding boxï¼ˆå¤šé‚Šå½¢çš„æœ€å°å¤–æ¥çŸ©å½¢ï¼‰åšç´¢å¼•ï¼š</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="im">from</span> rtree <span class="im">import</span> index</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">idx <span class="op">=</span> index.Index()</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="cf">for</span> town_id, shape <span class="kw">in</span> shapes.items():</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    idx.insert(town_id, shape.bounds)</a></code></pre></div>
<p>é€™æ¨£å°±å¯ä»¥é€é <code class="sourceCode python">idx.intersection((x, y))</code> ä¾†æ‰¾å‡ºè·Ÿåº§æ¨™æœ‰äº¤é›†çš„ bounding boxã€‚æˆ‘å€‘åªéœ€è¦æª¢æŸ¥åº§æ¨™è½åœ¨å…¶ä¸­çš„å“ªä¸€å€‹çš„å¤šé‚Šå½¢å³å¯ï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">def</span> search(x, y):</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    <span class="cf">return</span> <span class="bu">next</span>((town_id</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                 <span class="cf">for</span> town_id <span class="kw">in</span> idx.intersection((x, y))</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                 <span class="cf">if</span> shapes[town_id].contains(Point(x, y))), <span class="va">None</span>)</a></code></pre></div>
<p>é€™æ¨£æŸ¥è©¢çš„æ™‚é–“å°±å¯ä»¥å¾ <span class="math inline">\(O(N)\)</span> åŠ å¿«åˆ° <span class="math inline">\(O(log_M N + M)\)</span> äº†ã€‚ä»¥é„‰é®å¸‚å€ä¾†èªªï¼Œåœ¨æˆ‘çš„ç­†é›»ä¸Šï¼Œå¾æœ¬ä¾†æ¯æ¬¡å¹³å‡éœ€è¦ 3.95ms æå‡åˆ°æ¯æ¬¡å¹³å‡ 223 Âµsï¼Œè‡³å°‘å¿«äº† 16 å€ã€‚</p>
<figure>
<img src="https://i.imgur.com/MDrOi7i.png" alt="ä»¥ğŸ‡¹ğŸ‡¼ç¸½çµ±åºœä¾†èˆ‰ä¾‹ï¼Œå®ƒè½åœ¨è¬è¯å€è·Ÿä¸­æ­£å€å…©å€‹ bounding boxes è£¡é¢" /><figcaption>ä»¥ğŸ‡¹ğŸ‡¼ç¸½çµ±åºœä¾†èˆ‰ä¾‹ï¼Œå®ƒè½åœ¨è¬è¯å€è·Ÿä¸­æ­£å€å…©å€‹ bounding boxes è£¡é¢</figcaption>
</figure>
</section>
</section>]]></description>
    <pubDate>Sat, 16 Sep 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-09-16-python-getting-town-from-gps-coord.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>

    </channel>
</rss>

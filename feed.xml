<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>Alex Lu's Blog Feed</title>
        <link>https://op8867555.github.io</link>
        <description><![CDATA[Alex Lu's Blog Feed]]></description>
        <atom:link href="https://op8867555.github.io/feed.xml" rel="self"
                   type="application/rss+xml" />
        <lastBuildDate>Fri, 12 Jan 2018 00:00:00 UT</lastBuildDate>
        <item>
    <title>[en] Notes on Thinkpad X1 Carbon 2017 + Arch Linux</title>
    <link>https://op8867555.github.io/posts/2017-06-11-X1C5-notes.html</link>
    <description><![CDATA[<section id="changelogs" class="level3">
<h3>changelogs</h3>
<ul>
<li>2018/01/12 update info.</li>
<li>2017/08/22 update kernel to 4.12; add a WWAN section.</li>
<li>2017/07/22 rewrite the post in English, remove some outdated information.</li>
</ul>
</section>
<section id="quick-summary" class="level1">
<h1>Quick Summary</h1>
<p>Iâ€™m running Arch Linux (kernel 4.14) on a Thinkpad X1 Carbon 5th Gen (X1C5).</p>
<p>Most stuff works out of box,</p>
<ul>
<li>wifi</li>
<li>backlit keyboard</li>
<li>LEDs on keyboard (caps lock/mute/mic mute)</li>
<li>TrackPoint - slow speed but works.</li>
<li>TrackPad - not so precise but works.</li>
<li>Thunderbolt 3 - USB-C to HDMI / USB-C Hub<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote">I wrote a <a href="/posts/2017-07-21-adam-usb-c-dock.html">blog post</a> in Traditional Chinese ğŸ‡¹ğŸ‡¼ about the hub.<br />
<br />
</span></span> works.</li>
<li>Bluetooth - works with a FC30 game controller.</li>
<li>WWAN - works with ModemManager.</li>
<li>mini-Ethernet - works.</li>
</ul>
<p>Things <em>not</em> working,</p>
<ul>
<li>Fingerprint reader</li>
</ul>
<p>I havenâ€™t tried,</p>
<ul>
<li>micro SD reader</li>
<li>hibernation - I donâ€™t setup a swap partition.</li>
</ul>
</section>
<section id="hardware" class="level1">
<h1>Hardware</h1>
<section id="trackpoint" class="level2">
<h2>TrackPoint</h2>
<section id="alps-or-elantech" class="level3">
<h3>ALPS or Elantech?</h3>
<p>X1C5 comes with two versions<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote"><a href="https://patchwork.kernel.org/patch/9768231/" class="uri">https://patchwork.kernel.org/patch/9768231/</a><br />
<br />
</span></span> of TrackPoint: ALPS and Elantech. I confirmed mine has an Elantech one using <a href="http://pcsupport.lenovo.com/tw/zh/products/laptops-and-netbooks/thinkpad-x-series-laptops/thinkpad-x1-carbon-type-20hr-20hq/downloads/ds122148">TrackPointDetect.exe</a>.</p>
<pre><code>TouchPad-Flash Utility
2017-06-08 20:42:27
Command Line: &quot;C:\Users\alexlu\Desktop\FW_Updater_1.0.0.9\TrackPointDetect.exe&quot;
OS: 64-bit
Pst Vendor : Elan
[ERROR]: This TrackPoint is Elan (ID:03)</code></pre>
</section>
<section id="cursor-speed-trackpoint-cap" class="level3">
<h3>Cursor Speed &amp; TrackPoint Cap</h3>
<p>I took a plastic adapter<span><label for="sn-3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="sidenote"><img src="https://i.imgur.com/qyS29cDl.jpg" title="fig:" alt="The plastic adapter from previous Thinkpad" /><br />
<br />
</span></span> from my previous laptop - a Thinkpad E130 and trimmed a Soft Rim Cap to fit â€œSuper Low Profileâ€. The cursor speed and acceleration gets much better.</p>
<figure>
<img src="https://i.imgur.com/cxoY1AOl.jpg" alt="IMHO, a soft rim is much better than a soft dome." /><figcaption>IMHO, a soft rim is <em>much better</em> than a soft dome.</figcaption>
</figure>
</section>
</section>
<section id="trackpad" class="level2">
<h2>TrackPad</h2>
<p>It works with libinput and pressure-based palm detection are functional. But it is still unresponsive to small movements for current release. <span><label for="sn-4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="sidenote"><a href="https://bugs.freedesktop.org/show_bug.cgi?id=98839" class="uri">https://bugs.freedesktop.org/show_bug.cgi?id=98839</a><br />
<br />
</span></span></p>
<p><span><label for="sn-5" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="marginnote"> There is a different device according to <a href="https://www.reddit.com/r/thinkpad/comments/6wimb8/doing_some_research_on_x1c5_touchpad_issues/">this thread</a>.<br />
<br />
</span></span></p>
<p><code>dmesg</code> output:</p>
<pre><code>rmi4_smbus 0-002c: registering SMbus-connected sensor
rmi4_f01 rmi4-00.fn01: found RMI device, manufacturer: Synaptics, product: TM3289-002, fw id: 2492434</code></pre>
</section>
<section id="fingerprint-reader" class="level2">
<h2>Fingerprint Reader</h2>
<p>X1C5 have a Validity Sensor 138a:0097. There is no driver for it.</p>
<p>There is an open source reverse engineered driver working in progress<span><label for="sn-6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-6" class="margin-toggle"/><span class="sidenote"><a href="https://github.com/nmikhailov/Validity90" class="uri">https://github.com/nmikhailov/Validity90</a><br />
<br />
</span></span><span><label for="sn-7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-7" class="margin-toggle"/><span class="sidenote"><a href="https://bugs.freedesktop.org/show_bug.cgi?id=94536" class="uri">https://bugs.freedesktop.org/show_bug.cgi?id=94536</a><br />
<br />
</span></span>.</p>
</section>
<section id="wwan" class="level2">
<h2>WWAN</h2>
<p>X1C5 (WWAN) comes with a Sierra EM7455 LTE Modem (1199:9079).</p>
<p>It works out of box using latest ModemManager.</p>
</section>
</section>
<section id="software" class="level1">
<h1>Software</h1>
<p>Iâ€™m using i3-gaps without a desktop environment.</p>
<section id="hardware-video-acceleration" class="level2">
<h2>Hardware Video Acceleration</h2>
<p>It is possible to use the integrated graphic card to decode/encode videos, and this helps power-saving a lot.</p>
<p><span><label for="sn-8" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-8" class="margin-toggle"/><span class="marginnote"> See this <a href="https://wiki.archlinux.org/index.php/Hardware_video_acceleration">article</a> on ArchWiki for more info.<br />
<br />
</span></span></p>
<p>There are two spec/implement/API: VAAPI (by Intel) and VDPAU (by Nvidia). Since most software supports VAAPI, I just need to install <code>libva-intel-driver</code> pacakge.</p>
</section>
<section id="libva-intel-driver" class="level2">
<h2>libva-intel-driver</h2>
<p>Current release version has a bug<span><label for="sn-9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-9" class="margin-toggle"/><span class="sidenote"><a href="https://github.com/01org/intel-vaapi-driver/issues/297" class="uri">https://github.com/01org/intel-vaapi-driver/issues/297</a><br />
<br />
</span></span> when decoding VP9 videos, <code>libva-intel-driver-git</code> package should fixes that.</p>
</section>
<section id="chromium-vaapi" class="level2">
<h2>chromium-vaapi</h2>
<p>There is a VAAPI implementation for Chromium OS, and there is also a patch<span><label for="sn-10" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-10" class="margin-toggle"/><span class="sidenote"><a href="https://chromium-review.googlesource.com/c/chromium/src/+/532294" class="uri">https://chromium-review.googlesource.com/c/chromium/src/+/532294</a><br />
<br />
</span></span> to enable that on Linux. The <code>chromium-vaapi-bin</code> package on AUR provides prebuilt binary, or you can build <code>chromium-vaapi</code> by yourself (It takes about 6 hrs first time, you can use ccache to speed up if you want to build it more than one time).</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><a href="https://gist.github.com/gdamjan/141bb0def5f80257fae2b233ec16f3c2">gdamjanâ€™s Note</a></li>
<li><a href="http://fredrik.wendt.se/2017/04/26/lenovo-thinkpad-x1-carbon-5th-generation/">Fredrikâ€™s Note</a></li>
<li><a href="https://forums.lenovo.com/t5/forums/v3_1/forumtopicpage/board-id/tp02_en/thread-id/75464/page/29">discussion about TrackPad</a></li>
</ul>
</section>
<section id="outdated" class="level1">
<h1>Outdated</h1>
<p>These issues/tricks/workarounds are mostly outdated(linux kernel â‰¤ 4.12). Maybe I should just remove this section somedayâ€¦</p>
<section id="trackpoint-1" class="level2">
<h2>TrackPoint</h2>
<section id="issues" class="level3">
<h3>Issues</h3>
<ul>
<li><p>Recognized as a â€œPS/2 Generic Mouseâ€<br />
â‡’ No palm-detection during trackpoint use</p></li>
<li><p>Since kernel driver doesnâ€™t support the new trackpoint, both of sensitivity and speed arenâ€™t adjustable.<br />
â‡’ The default speed/sensitivity is too slow to use.</p></li>
</ul>
</section>
<section id="mark-it-as-a-pointing-stick" class="level3">
<h3>Mark it as a pointing stick</h3>
<p>I found I can making libinput treat the â€œPS/2 Generic Mouseâ€ as a trackpoint using a custom udev hwdb entry.</p>
<p><em>Note: this should not be used anymore once trackpoint gets kernel driver supports</em></p>
<pre><code>evdev:name:PS/2 Generic Mouse:dmi:*svnLENOVO*:pvrThinkPadX1Carbon5th*
  ID_INPUT_POINTINGSTICK=1</code></pre>
</section>
<section id="better-trackpoint-acceleration" class="level3">
<h3>Better TrackPoint Acceleration</h3>
<p>There is a <a href="https://bugs.freedesktop.org/show_bug.cgi?id=91369#c48">patch</a> which solves speed issue.</p>
<p>I get my trackpoint much usable by setting up:</p>
<ul>
<li><code>LIBINPUT_ATTR_TRACKPOINT_RANGE=10</code> in hwdb</li>
<li><code>xinput set-prop &quot;PS/2 Generic Mouse&quot; &quot;libinput Accel Speed&quot; -0.25</code> in my .xinitrc</li>
</ul>
</section>
</section>
<section id="trackpad-1" class="level2">
<h2>TrackPad</h2>
<p>The trackpad is <ins>able to</ins> use rmi4 over smbus for now(4.12).</p>
<p>Turn it on by creating a <code>psmouse.conf</code> in <code>/etc/modprobe.d/</code></p>
<pre><code>options psmouse synaptics_intertouch=1</code></pre>
<section id="palm-detection" class="level3">
<h3>Palm Detection</h3>
<ul>
<li>pressure-based palm-detection works great (libinput â‰¥ 1.8)</li>
<li>palm-detection during trackpoint use requires <a href="#mark-it-as-a-pointing-stick">mark it as a pointing stick</a>.</li>
</ul>
</section>
</section>
<section id="new-hotkeys" class="level2">
<h2>New Hotkeys</h2>
<p>Before linux-4.12, You needs <a href="https://patchwork.kernel.org/patch/9596129/">these</a> <a href="https://patchwork.kernel.org/patch/9596131/">patches</a> to get these buttons works.</p>
</section>
</section>]]></description>
    <pubDate>Fri, 12 Jan 2018 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-06-11-X1C5-notes.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>æ©Ÿå™¨å¦‚ä½•è¨ˆç®—å¾®åˆ†/åå¾®åˆ†ï¼ˆä¸Šï¼‰</title>
    <link>https://op8867555.github.io/posts/2017-12-17-autodiff.html</link>
    <description><![CDATA[<section>
<p>æåˆ°è¿‘å¹´ä¾†ç†±é–€çš„é¡ç¥ç¶“ç¶²è·¯æ¨¡å‹ï¼Œåå‚³å°(back propagation)æ˜¯ä¸€å€‹ç›¸ç•¶é‡è¦çš„éç¨‹ï¼Œå…¶ä¸­æ‡‰ç”¨çš„å°±æ˜¯è¨ˆç®—æ¢¯åº¦ï¼ˆgradientï¼Œå°±æ˜¯æ¯å€‹åƒæ•¸çš„åå¾®åˆ†ï¼‰ä¿®æ­£ç¥ç¶“åƒæ•¸ä¾†é”åˆ°ã€Œå­¸ç¿’ã€çš„æ•ˆæœï¼Œé¡ç¥ç¶“ç¶²è·¯çš„çµæ§‹è¶Šä¾†è¶Šè¤‡é›œï¼Œä½¿å¾—äººå·¥æ¨å°æ¢¯åº¦å…¬å¼è¶Šä¾†è¶Šä¸å¯è¡Œï¼Œå¦‚ä½•æ‡‰ç”¨é›»è…¦è¨ˆç®—å¾®åˆ†è®Šæˆäº†ä¸€å€‹é‡è¦çš„å•é¡Œã€‚</p>
</section>
<div class="fullwidth">
<figure>
<img src="https://i.imgur.com/R5QzZY4.png" alt="é€™å¼µåœ–ç°¡å–®åœ°è§£é‡‹äº†è¨ˆç®—å¾®åˆ†çš„å¹¾ç¨®ä½œæ³•ã€‚æ‘˜è‡ªâ€œAutomatic Differentiation of Algorithms for Machine Learningâ€" /><figcaption>é€™å¼µåœ–ç°¡å–®åœ°è§£é‡‹äº†è¨ˆç®—å¾®åˆ†çš„å¹¾ç¨®ä½œæ³•ã€‚æ‘˜è‡ªâ€œAutomatic Differentiation of Algorithms for Machine Learningâ€</figcaption>
</figure>
</div>
<section id="numerical-differential" class="level1">
<h1>Numerical Differential</h1>
<p><span><label for="sn-1" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="marginnote"> <img src="https://upload.wikimedia.org/wikipedia/commons/1/18/Derivative.svg" /> æ•¸å€¼å¾®åˆ†ï¼Œ By Olivier Cleynen (Own work) [CC0], via Wikimedia Commons<br />
<br />
</span></span></p>
<p>æ•¸å€¼å¾®åˆ†å°±æ˜¯ç”¨ <span class="math inline">\(\frac{f(x + h) - f(x)}{h}\)</span> è·Ÿä¸€å€‹å¾ˆå°çš„ <span class="math inline">\(h\)</span> ä¾†<strong>è¿‘ä¼¼</strong> <span class="math inline">\(\lim_{h \rightarrow 0}\frac{f(x + h) - f(x)}{h}\)</span>ï¼Œå¯¦ä½œä¸Šä¹Ÿåªæ˜¯è¨ˆç®—ç”¨ä¸åŒçš„åƒæ•¸ä¾†è¨ˆç®—å‡½æ•¸ <span class="math inline">\(f\)</span> çš„å·®ç•°ï¼Œä½†æ˜¯ <span class="math inline">\(f\)</span> çš„è¨ˆç®—æˆæœ¬å¯èƒ½ä¸ä½ï¼Œè€Œä¸”å¾ˆå®¹æ˜“é‡åˆ°æµ®é»æ•¸è¨ˆç®—çš„ round-off error è·Ÿ truncating errorï¼Œæ‰€ä»¥å¯¦å‹™ä¸Šä¸¦ä¸å¯¦ç”¨ã€‚</p>
<section id="å¯¦ä½œ" class="level2">
<h2>å¯¦ä½œ</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">from</span> math <span class="im">import</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">def</span> diff(f, x, epilson<span class="op">=</span><span class="fl">0.00001</span>):</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="cf">return</span> (f(x<span class="op">+</span>epilson) <span class="op">-</span> f(x))<span class="op">/</span>epilson</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">diff(sin, pi) <span class="co"># -0.9999999999898844</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">def</span> f(x, y):</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="cf">return</span> sin(x) <span class="op">+</span> x <span class="op">*</span> y</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co"># è¨ˆç®—åå¾®åˆ†å°±æ˜¯æŠŠä¸é—œå¿ƒçš„åƒæ•¸è¦–ç‚ºå¸¸æ•¸</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="im">from</span> functools <span class="im">import</span> partial</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">diff(partial(f, y<span class="op">=</span><span class="dv">2</span>), <span class="dv">3</span>) <span class="co"># 1.0100067978413563 (df(2,3)dx)</span></a></code></pre></div>
</section>
</section>
<section id="symbolic-differential" class="level1">
<h1>Symbolic Differential</h1>
<p>ç¬¦è™Ÿå¾®åˆ†æ˜¯ç¬¦è™Ÿè¨ˆç®— (Symbolic Computing) çš„ä¸€å€‹ç¶“å…¸ä¾‹å­ï¼šä¸å»è¨ˆç®—æ•¸å€¼ï¼Œè€Œæ˜¯ <em>è·Ÿäººé¡ä¸€æ¨£</em> ç›´æ¥è™•ç†é€™äº›ç¬¦è™Ÿã€‚<span><label for="sn-2" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="marginnote"> æˆ‘æœ€æ—©æ˜¯åœ¨ SICP ä¸€æ›¸çœ‹è¦‹é€™å€‹ä½œæ³•ï¼Œå¯ä»¥å¿å—å¾ˆå¤šæ‹¬è™Ÿçš„è®€è€…å¯ä»¥å»çœ‹ä¸€ä¸‹ <a href="https://mitpress.mit.edu/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3.2">Â§2.3.2</a> çš„ä»‹ç´¹ã€‚<br />
<br />
</span></span> åœ¨ä¿®ç¿’å¾®ç©åˆ†èª²ç¨‹æ™‚ï¼Œä¸€å®šæœƒæåˆ°å¦‚ä½•åˆ©ç”¨ <a href="https://en.wikipedia.org/wiki/Differentiation_rules">Differentiation rules</a> ä¾†æ±‚å‡ºå°æ•¸ï¼Œåƒæ˜¯:</p>
<ul>
<li><span class="math inline">\((a \cdot f)&#39; = af&#39;\)</span></li>
<li><span class="math inline">\((f + g)&#39; = f&#39; + g&#39;\)</span></li>
<li><span class="math inline">\((f(x) \cdot g(x))&#39; = f&#39;(x)g(x) + f(x)g&#39;(x)\)</span></li>
<li><span class="math inline">\((f(g(x)))&#39; = f&#39;(g(x)) g&#39;(x)\)</span></li>
</ul>
<p>è€Œ Symbolic Differential å°±æ˜¯æ¡ç”¨è·Ÿäººé¡ä¸€æ¨£çš„æ–¹æ³•ï¼Œå°è‘— expression tree ä¸æ–·çš„åš pattern matching è·Ÿ rewriteã€‚é€™å€‹æ–¹æ³•å¾ˆå¥½å¯¦ä½œï¼Œåªéœ€è¦ç…§è‘— Differential rules æ”¹å¯«ä¾¿æ˜¯ï¼Œè€Œä¸”å¯ä»¥å¾—åˆ°<strong>çœŸæ­£çš„</strong><span><label for="sn-3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="sidenote">Exact Derivativeï¼Œä¹Ÿå°±æ˜¯è·Ÿæ‰‹å‹•æ¨å°çš„çµæœä¸€è‡´ï¼ŒNumerical Differential å› ç‚ºæµ®é»æ•¸çš„ç‰¹æ€§ï¼Œæœƒç”¢ç”Ÿèª¤å·®è€Œç„¡æ³•ç®—å‡ºçœŸæ­£çš„å°æ•¸/åå°æ•¸<br />
<br />
</span></span>å°æ•¸/åå°æ•¸ã€‚</p>
<p>ä½†æ˜¯é€™å€‹æ–¹æ³•æœ€å¤§çš„å•é¡Œæ˜¯åœ¨æ”¹å¯«çš„éç¨‹ä¸­ï¼Œæœƒå‡ºç¾å¾ˆå¤šå†—æ–¼çš„å¼å­ï¼š <span class="math inline">\(x \times 1\)</span>, <span class="math inline">\(x + 0\)</span> ä¹‹é¡çš„ï¼Œå› æ­¤å¾ˆå®¹æ˜“ç”¢ç”Ÿå‡ºå·¨å¤§çš„ï¼ˆæ²’æ•ˆç‡ï¼‰çš„çµæœã€‚<span><label for="sn-4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="sidenote">â€œAutomatic Differentiation in Machine Learning: a Surveyâ€ ä¸€æ–‡ä¸­èˆ‰ä¾‹åˆ°ï¼š <span class="math display">\[f(x) = 64x(1 - x)(1 - 2x)^2(1 - 8x + 8x^2)^2\]</span> åœ¨æ²’æœ‰åŒ–ç°¡çš„æƒ…æ³åšç¬¦è™Ÿå¾®åˆ†æœƒå¾—åˆ° <span class="math display">\[\begin{gathered}
  128x(1 - x)(-8 + 16x)(1 - 2x)^2(1 - 8x+8x^2) \\
  + 64(1-x)(1-2x)^2 (1-8x+ 8x^2)^2\\
  - 64x(1-2x)^2 (1-8x+8x^2)^2 \\
  - 256x(1 - x)(1 - 2x)(1 - 8x + 8x^2)^2
  \end{gathered} \]</span> é€™æ¢å¾ˆè¤‡é›œçš„å¼å­ï¼Œä½†æ˜¯ç¶“éåŒ–ç°¡å‰‡åªå‰©ä¸‹ <span class="math display">\[\begin{gathered}
  64(1 - 42x + 504x^2 - 2640x^3  \\
  + 7040x^4 -9984x^5 + 7168x^6 -2048x^7)
  \end{gathered}\]</span>ï¼Œè€Œéš¨è‘—åŸå¼<span class="math inline">\(f\)</span>çš„è¤‡é›œåº¦ä¸Šå‡ï¼Œæ²’åšå¥½ç°¡åŒ–çš„ç¬¦è™Ÿå¾®åˆ†æœƒè†¨è„¹éå¸¸å¿«ã€‚<br />
<br />
</span></span></p>
<p>ä»¥ Python ä¾†èªªï¼ŒSymPy å°±å¯¦ä½œäº†ç¬¦è™Ÿç©åˆ†ï¼Œå¯ä»¥çœ‹åˆ° <code>diff</code> æœƒç”¢å‡ºä¸€å€‹æ–°çš„é‹ç®—å¼ã€‚</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="im">from</span> sympy <span class="im">import</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">x <span class="op">=</span> var(<span class="st">&#39;x&#39;</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">expr <span class="op">=</span> diff(sin(x)) <span class="co"># cos(x)</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">expr.evalf(subs<span class="op">=</span>{<span class="st">&#39;x&#39;</span>: pi}) <span class="co"># -1.000000000000</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">expr2 <span class="op">=</span> diff(sin(x)<span class="op">+</span> x <span class="op">*</span> y, x)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">expr2.evalf(subs<span class="op">=</span>{<span class="st">&#39;x&#39;</span>: <span class="dv">3</span>, <span class="st">&#39;y&#39;</span>: <span class="dv">2</span>}) <span class="co"># 1.0100075033995546</span></a></code></pre></div>
<!--

å·¦åœ–ç‚º$f(x, y) = sin(x) + x*y$çš„ç¤ºæ„åœ–ï¼Œå³åœ–ç‚ºä»¥ç¬¦è™Ÿè¨ˆç®—$\frac{df}{dx}$çš„ç¤ºæ„åœ–ï¼š


~~~~
        f(x, y)    |         dfdx
          +-+      |         +-+
          |+|      |         |+|
          +-+      |         +-+
         /  \      |        /  \
        /    \     |       /    \
    +---+     +-+  |   +---+     +-+
    |sin|     |Ã—|  |   |cos|     |0|
    +---+     +-+  |   +---+     +-+
      |       /|   |     |
      | _____/ |   |     |
      |/       |   |     |
     +-+      +-+  |    +-+
     |x|      |y|  |    |x|
     +-+      +-+  |    +-+
~~~~~
-->
</section>
<section id="forward-mode-automatic-differential" class="level1">
<h1>Forward-Mode Automatic Differential</h1>
<p>è‡ªå‹•å¾®åˆ†ï¼ˆADï¼‰çš„åç¨±å–å¾—å¾ˆå®¹æ˜“è®“äººèª¤è§£ï¼Œå…¶å¯¦å°±æ˜¯æ‡‰ç”¨ chain rule è·Ÿä¸€äº›èªè¨€ç‰¹æ€§æˆ–æ˜¯åŸå§‹ç¢¼è½‰æ›å·¥å…·ï¼Œä¾†é”æˆä¸ç”¨æ‰‹å¯«å°æ•¸çš„ç¨‹å¼ï¼Œè€Œå¯ä»¥åœ¨è¨ˆç®—å‡½æ•¸çš„åŒæ™‚ï¼ˆä¹Ÿå°±æ˜¯ overhead ä¸å¤§ï¼‰å¾—å‡º<strong>çœŸæ­£çš„</strong>å°æ•¸/åå°æ•¸ã€‚</p>
<p>è‡ªå‹•å¾®åˆ†æ ¹æ“šè¨ˆç®—çš„é †åºï¼Œå¯ä»¥åˆ†ç‚º Forward Mode è·Ÿ Reverse Modeï¼Œé€™æ¬¡å…ˆä»‹ç´¹æ¯”è¼ƒç°¡å–®çš„ Forward Modeã€‚</p>
<p><span><label for="sn-5" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="marginnote"> Forward Mode AD å°‡ä¸€å€‹å‡½æ•¸ <span class="math inline">\(y = f(... , x, ...) = (w_m \circ w_{m-1} ... \circ w_1)(..., x, ...)\)</span> å° <span class="math inline">\(x\)</span> çš„å¾®åˆ†ï¼Œæ‹†è§£æˆ <span class="math display">\[
  \begin{aligned}
  \frac {\partial y}{\partial x} =&amp;\frac {\partial y}{\partial w_{m-1}}{\frac {\partial w_{m-1}}{\partial x}} \\
  =&amp;\frac {\partial y}{\partial w_{m-1}}\left({\frac {\partial w_{m-1}}{\partial w_{m-2}}}{\frac {\partial w_{m-2}}{\partial x}}\right) \\
  =&amp;\frac {\partial y}{\partial w_{m-1}}\left({\frac {\partial w_{m-1}}{\partial w_{m-2}}}\left({\frac {\partial w_{m-2}}{\partial w_{m-3}}}{\frac {\partial w_{m-3}}{\partial x}}\right)\right) \\
  =&amp;{\frac {\partial y}{\partial w_{m-1}}} \left( \frac {\partial w_{m-1}}{\partial w_{m-2}} \cdots
  \left(\frac {\partial w_{2}}{\partial w_{1}}  \frac {\partial w_{1}}{\partial x} \right)\right)\\
  \end{aligned}
  \]</span> ç„¶å¾Œå¾ <span class="math inline">\(\frac{\partial x}{\partial x} = 1\)</span> é–‹å§‹ï¼Œ ç”± <span class="math inline">\(\frac{\partial w_1}{\partial x}\)</span> é–‹å§‹è¨ˆç®—åˆ° <span class="math inline">\(\frac{\partial w_m}{x}\)</span>ï¼ˆç”±å…§è€Œå¤–ï¼‰ã€‚<br />
<br />
</span></span></p>
<p>é€™é‚Šç¹¼çºŒä½¿ç”¨ä¸Šé¢çš„ <span class="math inline">\(Y = f(x, y) = sin(x) + x Ã— y\)</span> çš„ä¾‹å­ï¼Œ</p>
<p>æˆ‘å€‘å¯ä»¥æŠŠ <span class="math inline">\(Y\)</span> æ‹†è§£æˆä¸‹åœ–ï¼ˆå·¦ï¼‰</p>
<p><span class="math display">\[
\begin{array}{rl|rl}
  Y &amp; =  w_5       &amp; \dot{Y} &amp; = \dot{w_5} \\
w_5 &amp; =  w_3 + w_4 &amp; \dot{w_5} &amp; = \dot{w_3} + \dot{w_4} \\
w_4 &amp; =  w_1 Ã— w_2 &amp; \dot{w_4} &amp; = w_2 Ã— \dot{w_1} + w_1 Ã— \dot{w_2}\\
w_3 &amp; =  sin(w_1)  &amp; \dot{w_3} &amp; = cos(w_1) \\
w_2 &amp; =  y         &amp; \dot{w_2} &amp; = 0\\
w_1 &amp; =  x         &amp; \dot{w_1} &amp; = 1\\
\end{array}
\]</span></p>
<p>ç„¶å¾Œæˆ‘å€‘å°±å¯ä»¥å¾ <span class="math inline">\(\frac{\partial x}{\partial x} = 1, \frac{\partial y}{\partial x} = 0\)</span> é–‹å§‹ï¼Œæ±‚å‡º <span class="math inline">\(\frac{\partial w_i}{\partial x} \big \vert_{i = 1 \cdots 5}\)</span>ï¼Œæœ€å¾Œæ±‚å‡º<span class="math inline">\(\frac{\partial Y}{\partial x}\)</span> ï¼ˆå¦‚ä¸Šåœ–ï¼ˆå³ï¼‰ï¼Œé€™é‚Šç”¨ <span class="math inline">\(\dot{X}\)</span> ä¾†è¡¨ç¤º <span class="math inline">\(\frac{\partial X}{\partial x}\)</span>ï¼‰ã€‚</p>
<p>å¾è¨ˆç®—é †åºä¸Šï¼ŒForward-Mode AD è·ŸåŸå…ˆå‡½æ•¸æ˜¯ä¸€æ¨£çš„ï¼Œæ‰€ä»¥è¢«ç¨±ç‚º Forward Modeã€‚</p>
<section id="å¯¦ä½œ-1" class="level2">
<h2>å¯¦ä½œ</h2>
<p>ä¸€å€‹å¸¸è¦‹çš„å¯¦ä½œæ–¹æ³•æ˜¯å®šç¾©ä¸€å€‹æ–°çš„è³‡æ–™çµæ§‹ Dual Numberï¼Œè·Ÿåˆ©ç”¨ operator overloading ä¾†å¯¦ä½œå…¶ç®—è¡“ç³»çµ±ã€‚ä¸‹é¢ä½¿ç”¨ Python èˆ‰ä¾‹<span><label for="sn-6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-6" class="margin-toggle"/><span class="sidenote">è¼ƒå®Œæ•´çš„ Dual Number å®šç¾©å¯ä»¥åœ¨ <a href="https://en.wikipedia.org/wiki/Automatic_differentiation#Automatic_differentiation_using_dual_numbers">Wikipedia</a> æ‰¾åˆ°ã€‚å¦‚åŒæ–‡ä¸­å¯«åˆ°ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ <span class="math inline">\(g(\langle u,u&#39; \rangle , \langle v,v&#39; \rangle )  = \langle g(u,v) , g_u(u,v) u&#39; + g_v(u,v) v&#39; \rangle\)</span> ä¾†å®šç¾©é€™äº› primitive functions(<span class="math inline">\(sin, cos, \cdots\)</span>)ã€‚<br />
<br />
</span></span><span><label for="sn-7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-7" class="margin-toggle"/><span class="sidenote">ç‚ºäº†å¯ä»¥å¯«å‡ºåƒæ˜¯ <code class="sourceCode python"><span class="dv">4</span> <span class="op">*</span> Dual(<span class="dv">1</span>, <span class="dv">1</span>)</code> é€™æ¨£æ··åˆè‘— <code>float</code> è·Ÿ <code>Dual</code> çš„ç¨‹å¼ï¼Œå¯ä»¥åƒè€ƒ <a href="https://docs.python.org/3/reference/datamodel.html#emulating-numeric-types">Python Reference Â§3.3.7</a> ä½¿ç”¨ <code>__radd__</code> ç³»åˆ—çš„ method ä¾†å¯¦ä½œã€‚<br />
<br />
</span></span>ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="im">from</span> collections <span class="im">import</span> namedtuple</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="im">import</span> math</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw">class</span> Dual(namedtuple(<span class="st">&quot;Dual&quot;</span>, [<span class="st">&quot;x&quot;</span>, <span class="st">&quot;dx&quot;</span>])):</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="co">&#39;&#39;&#39;dx è¿½è¹¤ x çš„è®ŠåŒ–å°ç•¶ä¸‹è¼¸å‡ºçš„å½±éŸ¿&#39;&#39;&#39;</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="kw">def</span> <span class="fu">__add__</span>(<span class="va">self</span>, other):</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">        <span class="cf">return</span> Dual(<span class="va">self</span>.x <span class="op">+</span> other.x, <span class="va">self</span>.dx <span class="op">+</span> other.dx)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="kw">def</span> <span class="fu">__mul__</span>(<span class="va">self</span>, other):</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">        <span class="cf">return</span> Dual(<span class="va">self</span>.x <span class="op">*</span> other.x, other.x <span class="op">*</span> <span class="va">self</span>.dx <span class="op">+</span> <span class="va">self</span>.x <span class="op">*</span> other.dx)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="co"># ä¸‹ç•¥</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="kw">def</span> sin(dual):</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    <span class="co"># inline chain rule here</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="cf">return</span> Dual(math.sin(dual.x), dual.dx <span class="op">*</span> math.cos(dual.x))</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co"># é€™é‚Šçœç•¥å…¶ä»–å‡½æ•¸</span></a></code></pre></div>
<p>èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥é€éæ§åˆ¶<code>Dual(x, dx)</code>çš„<code>dx</code>ä¾†åˆ†åˆ¥è¨ˆç®— <span class="math inline">\(\frac{\partial f}{\partial x}\)</span> è·Ÿ <span class="math inline">\(\frac{\partial f}{\partial y}\)</span></p>
<p><span><label for="sn-8" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-8" class="margin-toggle"/><span class="marginnote"> <a href="https://upload.wikimedia.org/wikipedia/commons/a/a4/ForwardAccumulationAutomaticDifferentiation.png"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/ForwardAccumulationAutomaticDifferentiation.png/512px-ForwardAccumulationAutomaticDifferentiation.png" /></a> é€™æ˜¯ Wikipedia ä¸Šé¢å° <span class="math inline">\(Y = f(x,y) = sin(x) + x Ã— y\)</span> åš forward-mode AD çš„ç¤ºæ„åœ–ã€‚<br />
By Berland at English Wikipedia [Public domain], via Wikimedia Commons<br />
<br />
</span></span></p>
<p><span class="math display">\[f(x,y) = sin(x) + x*y\]</span></p>
<p>ï¼ˆ<code class="sourceCode python">Dual(x, <span class="dv">1</span>)</code> å°æ‡‰åˆ° <span class="math inline">\(\frac{dx}{dx} = 1\)</span>ï¼›<code class="sourceCode python">Dual(c, <span class="dv">0</span>)</code> å°æ‡‰åˆ° <span class="math inline">\(\frac{dc}{dx} = 0\)</span>ï¼‰</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># è¦è¨ˆç®—åå°æ•¸çš„å‡½æ•¸å¯ä»¥ç”¨æœ¬ä¾†çš„å¯«æ³•ï¼Œè€Œä¸ç”¨è‡ªå¹¹ï¼Œæœ‰æ²’æœ‰æ„Ÿè¦ºåˆ°ã€Œè‡ªå‹•ã€ï¼Ÿ</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">def</span> f(x, y):</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="cf">return</span> sin(x) <span class="op">+</span> x<span class="op">*</span>y</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">f(Dual(<span class="dv">3</span>, <span class="dv">1</span>), Dual(<span class="dv">2</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co"># Dual(x=6.141120008059867, dx=1.0100075033995546)</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">f(Dual(<span class="dv">3</span>, <span class="dv">0</span>), Dual(<span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co"># Dual(x=6.141120008059867, dx=3.0)</span></a></code></pre></div>
<p>é€™æ˜¯æ€éº¼è¾¦åˆ°çš„ï¼Ÿæˆ‘å€‘å¯ä»¥ç”¨é¡ä¼¼ Equational Reasoning<span><label for="sn-9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-9" class="margin-toggle"/><span class="sidenote">Equational Reasoning å°±åƒæ•¸å­¸è­‰æ˜ä¸€æ¨£ï¼Œæ¯”è¼ƒå¸¸ç”¨åœ¨ Pure Functional çš„ç¨‹å¼èªè¨€ä¸Šï¼Œä¸éæ—¢ç„¶é€™å€‹ä¾‹å­ä¹Ÿå¹¾ä¹æ˜¯ Pure Functional çš„ï¼Œåœ¨é€™é‚Šå°±ä½¿ç”¨é€™å€‹æŠ€å·§ä¾†èªªæ˜ã€‚<br />
<br />
</span></span> çš„æ–¹å¼ä¾†å±•é–‹ï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1">(  f(Dual(<span class="dv">3</span>, <span class="dv">1</span>), Dual(<span class="dv">2</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="op">==</span> sin(Dual(<span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span> Dual(<span class="dv">3</span>, <span class="dv">1</span>) <span class="op">*</span> Dual(<span class="dv">2</span>,<span class="dv">0</span>)                        <span class="co"># definition of f</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="op">==</span> Dual(math.sin(<span class="dv">3</span>), <span class="dv">1</span> <span class="op">*</span> math.cos(<span class="dv">3</span>)) <span class="op">+</span> Dual(<span class="dv">3</span>, <span class="dv">1</span>) <span class="op">*</span> Dual(<span class="dv">2</span>,<span class="dv">0</span>)     <span class="co"># definition of sin</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="op">==</span> Dual(math.sin(<span class="dv">3</span>), <span class="dv">1</span> <span class="op">*</span> math.cos(<span class="dv">3</span>)) <span class="op">+</span> Dual(<span class="dv">3</span> <span class="op">*</span> <span class="dv">2</span>, <span class="dv">2</span> <span class="op">*</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> <span class="dv">0</span>) <span class="co"># definition of __mul__</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="op">==</span> Dual(math.sin(<span class="dv">3</span>) <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> <span class="dv">2</span>, <span class="dv">1</span> <span class="op">*</span> math.cos(<span class="dv">3</span>) <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> <span class="dv">0</span>)      <span class="co"># definition of __add__</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="op">==</span> Dual(x<span class="op">=</span><span class="fl">6.141120008059867</span>, dx<span class="op">=</span><span class="fl">1.0100075033995546</span>)  )</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co"># returns True since this is a valid python expression.</span></a></code></pre></div>
<p>é †å¸¶ä¸€æï¼Œæˆ‘å€‘ä¸éœ€è¦é¡å¤–å¯¦ä½œ Chain Ruleï¼Œå› ç‚ºå®ƒå·²ç¶“åŒ…å«åœ¨ Dual Number çš„ç®—è¡“ç³»çµ±å…§äº†ã€‚</p>
<p><span><label for="sn-10" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-10" class="margin-toggle"/><span class="marginnote"> å¯ä»¥çœ‹åˆ°ç¬¬ 3 è¡Œçš„ <code>dx</code> æ­£å¥½ç­‰æ–¼æ‡‰ç”¨ Chain Rule æ±‚å‡ºçš„ <span class="math inline">\(\frac{\partial sin(sin(x))}{\partial x} = cos(x) Ã— cos(sin(x))\)</span>ã€‚<br />
é€™æ˜¯å› ç‚ºåœ¨ <code>sin(dual)</code> çš„å®šç¾©ä¸­ <code class="sourceCode python">Dual(math.sin(dual.x), dual.dx <span class="op">*</span> math.cos(dual.x))</code> è£¡é¢å°±å·²ç¶“ <em>inline</em> chain rule äº†<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python numberLines"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" data-line-number="1">(  sin(sin(Dual(<span class="dv">1</span>, <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="op">==</span> sin(Dual(math.sin(<span class="dv">1</span>), <span class="dv">1</span> <span class="op">*</span> math.cos(<span class="dv">1</span>)))                          <span class="co"># definition of sin</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="op">==</span> Dual(math.sin(math.sin(<span class="dv">1</span>)), math.cos(<span class="dv">1</span>) <span class="op">*</span> math.cos(math.sin(<span class="dv">1</span>))) <span class="co"># definition of sin</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="op">==</span> Dual(x<span class="op">=</span><span class="fl">0.7456241416655579</span>, dx<span class="op">=</span><span class="fl">0.36003948908962097</span>) )</a></code></pre></div>
<!--

å·¦åœ–ç‚º$f = sin(x) + x * y$çš„ç¤ºæ„åœ–ï¼Œå³é‚Šç‚ºä»¥ Dual Number å¯¦ä½œçš„ç¤ºæ„åœ–ï¼š

~~~~
        f(x, y)    |       f(x, y); dfdx                      f(3,2); dfdx
          +-+      |          +---+---+                       +-----+-----+
          |+|      |          | + | + |                       |6.14 | 1.01|
          +-+      |          +---+---+                       +-----+-----+
         /  \      |          /       \                        /       \
        /    \     |         /         \                      /         \
    +---+     +-+  |  +------+------+  +--+----------+   +----+-----+   +--+--+
    |sin|     |Ã—|  |  |sin(a)|cos(a)|  |Ã— | a*db+b*db|   |0.14|-0.98|   | 6| 2|
    +---+     +-+  |  +------+------+  +--+----------+   +----+-----+   +--+--+
      |       /|   |        |           / |                   |          / |
      | _____/ |   |        |  ________/  |                   |  _______/  |
      |/       |   |        | /           |                   | /          |
     +-+      +-+  |     +--+--+       +--+--+             +--+--+      +--+--+
     |x|      |y|  |     |x | 1|       |y | 0|             |3 | 1|      |2 | 0|
     +-+      +-+  |     +--+--+       +--+--+             +--+--+      +--+--+
~~~~

-->
<p>é€™å€‹æ–¹æ³•çš„å•é¡Œæ˜¯æ¯ä¸€å€‹åƒæ•¸<span class="math inline">\(x_i\)</span>éƒ½å¿…é ˆç®—éä¸€æ¬¡ï¼Œé¡ç¥ç¶“çš„æ¢¯åº¦ä¾†èªªéœ€è¦<span class="math inline">\(O(n)\)</span>çš„æ™‚é–“æ‰èƒ½ç®—å®Œï¼ˆ<span class="math inline">\(n\)</span>æ˜¯åƒæ•¸çš„å€‹æ•¸ï¼‰ï¼Œä¸¦ä¸æ˜¯å¾ˆé©åˆé¡ç¥ç¶“ç¶²è·¯è¨ˆç®—æ¢¯åº¦ï¼ˆå› ç‚º<span class="math inline">\(n\)</span>é€šå¸¸éƒ½ä¸å°ï¼‰ã€‚</p>
</section>
</section>
<section id="å°çµ" class="level1">
<h1>å°çµ</h1>
<p>æœ¬æ–‡ä»‹ç´¹äº†</p>
<ul>
<li>Numerical Differentialï¼Œç”¨è¿‘ä¼¼çš„æ–¹æ³•è¨ˆç®—ï¼Œå…¶å„ªé»æ˜¯å¯¦ä½œæœ€ç°¡å–®ï¼Œç¼ºé»æ˜¯è¨ˆç®—èª¤å·®å¤§åˆ°ä¸å¤ å¯¦ç”¨</li>
<li>Symbolic Differentialï¼Œå…¶å¯¦å°±æ˜¯æŠŠäººé¡è¨ˆç®—å¾®åˆ†çš„éç¨‹ç”¨é›»è…¦å¯¦ä½œï¼Œå¯ä»¥å¾—åˆ°æ­£ç¢ºçš„æ•¸å€¼ï¼Œä½†æ˜¯æœƒé‡åˆ°ç®—å¼è†¨è„¹çš„å•é¡Œ</li>
<li>Forward-Mode Automatic Differentialï¼Œæ‡‰ç”¨äº† chain ruleï¼Œåœ¨è¨ˆç®—çš„éç¨‹ä¹Ÿå¯ä»¥ç°¡å–®çš„ç®—å‡ºæ­£ç¢ºçš„åå°æ•¸ï¼Œä½†æ˜¯ä¸é©åˆè¨ˆç®—æ¢¯åº¦ã€‚</li>
</ul>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« æœƒä»‹ç´¹ Reverse-Mode Automatic Differentialï¼Œæ˜¯ Forward-Mode ç›¸åæ–¹å‘çš„ç‰ˆæœ¬ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ back propagation çš„ general ç‰ˆæœ¬ã€‚</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Automatic_differentiation">Automatic differentiation on Wikipedia</a></li>
<li><a href="https://idontgetoutmuch.wordpress.com/2013/10/13/backpropogation-is-just-steepest-descent-with-automatic-differentiation-2">Backpropogation is Just Steepest Descent with Automatic Differentiation</a></li>
<li><a href="https://arxiv.org/pdf/1502.05767.pdf">Automatic Differentiation in Machine Learning: a Survey</a></li>
<li><a href="https://arxiv.org/pdf/1404.7456.pdf">Automatic Differentiation of Algorithms for Machine Learning</a></li>
</ul>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<section id="example-logistic-regression" class="level2">
<h2>Example: Logistic Regression</h2>
<p>é€™é‚Šç”¨æŒ‘æˆ°è€…è™Ÿçš„Oå‹ç’°å¤±æ•ˆè³‡æ–™<span><label for="sn-11" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-11" class="margin-toggle"/><span class="marginnote"> é¸é€™ä»½è³‡æ–™æ˜¯å› ç‚ºæˆ‘æœ€è¿‘åœ¨è®€ â€œProbabilistic Programming &amp; Bayesian Methods for Hackersâ€ å‰›å¥½ä»‹ç´¹åˆ°é€™ä¸€ä»½<a href="https://raw.githubusercontent.com/CamDavidsonPilon/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers/master/Chapter2_MorePyMC/data/challenger_data.csv">è³‡æ–™é›†</a>ã€‚<br />
<br />
</span></span>ä½œç‚ºç¯„ä¾‹ï¼Œä»¥ä¸Šè¿°çš„ Forward-Mode AD<span><label for="sn-12" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-12" class="margin-toggle"/><span class="marginnote"> <strong>æ³¨æ„:</strong> é€™é‚Šçš„ <code>forwardad</code> å·²ç¶“æœ‰å¯¦ä½œ <code>__radd__</code>, <code>exp</code>, <code>log</code>â€¦ç­‰æ»¿è¶³ä¸‹é¢ç¨‹å¼æ‰€éœ€çš„æœ€å°éœ€æ±‚ã€‚<br />
<br />
</span></span> å¯¦ä½œ Gradient Descent ä¾†é€²è¡Œ Logistic Regressionã€‚</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="im">from</span> forwardad <span class="im">import</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="im">from</span> io <span class="im">import</span> StringIO</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">data <span class="op">=</span> StringIO(<span class="st">&#39;Date,Temperature,Damage Incident</span><span class="ch">\n</span><span class="st">04/12/1981,66,0.0</span><span class="ch">\n</span><span class="st">11/12/1981,70,1.0</span><span class="ch">\n</span><span class="st">3/22/82,69,0.0</span><span class="ch">\n</span><span class="st">6/27/82,80,</span><span class="ch">\n</span><span class="st">01/11/1982,68,0.0</span><span class="ch">\n</span><span class="st">04/04/1983,67,0.0</span><span class="ch">\n</span><span class="st">6/18/83,72,0.0</span><span class="ch">\n</span><span class="st">8/30/83,73,0.0</span><span class="ch">\n</span><span class="st">11/28/83,70,0.0</span><span class="ch">\n</span><span class="st">02/03/1984,57,1.0</span><span class="ch">\n</span><span class="st">04/06/1984,63,1.0</span><span class="ch">\n</span><span class="st">8/30/84,70,1.0</span><span class="ch">\n</span><span class="st">10/05/1984,78,0.0</span><span class="ch">\n</span><span class="st">11/08/1984,67,0.0</span><span class="ch">\n</span><span class="st">1/24/85,53,1.0</span><span class="ch">\n</span><span class="st">04/12/1985,67,0.0</span><span class="ch">\n</span><span class="st">4/29/85,75,0.0</span><span class="ch">\n</span><span class="st">6/17/85,70,0.0</span><span class="ch">\n</span><span class="st">7/29/85,81,0.0</span><span class="ch">\n</span><span class="st">8/27/85,76,0.0</span><span class="ch">\n</span><span class="st">10/03/1985,79,0.0</span><span class="ch">\n</span><span class="st">10/30/85,75,1.0</span><span class="ch">\n</span><span class="st">11/26/85,76,0.0</span><span class="ch">\n</span><span class="st">01/12/1986,58,1.0</span><span class="ch">\n</span><span class="st">1/28/86,31,1.0</span><span class="ch">\n</span><span class="st">&#39;</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">df <span class="op">=</span> pd.read_csv(data).dropna()</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">X <span class="op">=</span> df[<span class="st">&#39;Temperature&#39;</span>].tolist()</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">Y <span class="op">=</span> df[<span class="st">&#39;Damage Incident&#39;</span>].tolist()</a></code></pre></div>
<p>é€™é‚Šä½¿ç”¨ logistic function åšæ¨¡å‹ï¼Œbinary cross-entropy ä½œç‚º loss functionã€‚</p>
<p><span class="math display">\[
\begin{gathered}
f(x) = \frac{1}{1+ exp(\beta x + \alpha)} \\
Cost(y, \hat y) = -\frac{1}{N}\sum_{i=1}^N \bigg[ y_i \log(\hat{y}_i)+(1-y_i) \log(1-\hat{y}_i) \bigg]
\end{gathered}
\]</span> <span><label for="sn-13" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-13" class="margin-toggle"/><span class="marginnote"> é€™é‚Šå¯ä»¥çœ‹åˆ°ï¼Œå¯«å‡ºä¾†çš„ç¨‹å¼å¹¾ä¹æ²’æœ‰ç‚ºäº†è¨ˆç®—å¾®åˆ†è€Œæ”¹è®Šï¼Œè€Œæ˜¯ç…§è‘—æœ¬ä¾†çš„å®šç¾©åœ¨å¯«ã€‚<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">def</span> f(alpha, beta, x):</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">    <span class="cf">return</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp(beta <span class="op">*</span> x <span class="op">+</span> alpha))</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw">def</span> cross_entroy(Y, Y_):</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    loss <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="cf">for</span> y, y_ <span class="kw">in</span> <span class="bu">zip</span>(Y, Y_):</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">        loss <span class="op">-=</span> y <span class="op">*</span> log(y_) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> y) <span class="op">*</span> log(<span class="dv">1</span> <span class="op">-</span> y_)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    <span class="cf">return</span> loss <span class="op">/</span> <span class="bu">len</span>(Y)</a></code></pre></div>
<p>æœ€å¾Œä½¿ç”¨ Gradient Descent ä¾†æ‰¾å‡º <span class="math inline">\(\alpha, \beta\)</span>ã€‚</p>
<p><span><label for="sn-14" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-14" class="margin-toggle"/><span class="marginnote"> <code>alpha</code>, <code>beta</code>, <code>lr</code>, <code>n_epoch</code> é€™äº›åƒæ•¸éƒ½æ˜¯å¯ä»¥è¨­å®šçš„ã€‚<br />
<br />
</span></span></p>
<p><span><label for="sn-15" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-15" class="margin-toggle"/><span class="marginnote"> å—é™æ–¼ Forward-Mode AD å…ˆå¤©ä¸Šçš„é™åˆ¶ï¼Œ<span class="math inline">\(\alpha\)</span> è·Ÿ <span class="math inline">\(\beta\)</span> çš„å¾®åˆ†éœ€è¦åˆ†é–‹è¨ˆç®—ã€‚<br />
<br />
</span></span></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python example"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" data-line-number="1">alpha <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">beta  <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">lr <span class="op">=</span> <span class="fl">0.005</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">n_epoch <span class="op">=</span> <span class="dv">1000</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co"># ç‚ºäº†é¿å… log(0) ï¼Œé€™é‚Šå…ˆç½®æ›æˆ 0 â‰ˆ 1e-18</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">Y <span class="op">=</span> [<span class="fl">1e-18</span> <span class="cf">if</span> x <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> x <span class="cf">for</span> x <span class="kw">in</span> Y]</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(n_epoch):</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    Y_alpha <span class="op">=</span> [f(Dual(alpha, <span class="dv">1</span>), beta, x) <span class="cf">for</span> x <span class="kw">in</span> X]</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    Y_beta  <span class="op">=</span> [f(alpha, Dual(beta, <span class="dv">1</span>), x) <span class="cf">for</span> x <span class="kw">in</span> X]</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    loss_alpha <span class="op">=</span> cross_entroy(Y, Y_alpha)</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">    loss_beta  <span class="op">=</span> cross_entroy(Y, Y_beta)</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">    <span class="cf">if</span> epoch <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">        <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="sc">{</span>epoch<span class="sc">: 5d}</span><span class="ss"> loss </span><span class="sc">{</span>loss_alpha<span class="sc">.x}</span><span class="ss"> alpha </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss"> beta </span><span class="sc">{</span>beta<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">    alpha <span class="op">-=</span> lr <span class="op">*</span> loss_alpha.dx</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">    beta  <span class="op">-=</span> lr <span class="op">*</span> loss_beta.dx</a></code></pre></div>
<p>é€™é‚Šæ˜¯ä¸Šé¢ç¨‹å¼åŸ·è¡Œçš„çµæœï¼ˆé‡æ–°æ’ç‰ˆéï¼‰ï¼Œå¯ä»¥çœ‹åˆ° Learning Rate è¨­å®šçš„æœ‰é»å¤ªå¤§äº†ã€‚æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥è©¦è‘—è‡ªå·±å¯¦ä½œçœ‹çœ‹ã€‚</p>
<pre><code>    0 loss 0.693147180559945  alpha  0                   beta  0
  100 loss 0.966931426916483  alpha -0.0201008838271800  beta  0.0465418617995232
  200 loss 1.114664696718874  alpha -0.0417346760460772  beta -0.0170795861942109
  300 loss 3.558155059566457  alpha -0.0595466871292758  beta  0.1800165252346373
  400 loss 0.961973323155755  alpha -0.0821799396148940  beta  0.0472951650365717
  500 loss 1.110644944663376  alpha -0.1037522632990092  beta -0.0161308641984885
  600 loss 3.555985812065263  alpha -0.1215047609258659  beta  0.1809462252622945
  700 loss 0.957097575658038  alpha -0.1440822016889158  beta  0.0480494092224557
  800 loss 1.106712443731962  alpha -0.1655931706446121  beta -0.0151865701942648
  900 loss 3.553772437842705  alpha -0.1832862200585766  beta  0.1818707335807102</code></pre>
</section>
</section>]]></description>
    <pubDate>Tue, 09 Jan 2018 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-12-17-autodiff.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>æ›´æ› blog ä¸»é¡Œä»¥è¿æ¥ 2018 å¹´</title>
    <link>https://op8867555.github.io/posts/2018-01-05-new-style.html</link>
    <description><![CDATA[<section>
<p>éäº† 2017ï¼Œæˆ‘æ±ºå®šæ›æ‰ä¹‹å‰ç”¨ Google çš„ <a href="https://getmdl.io/">Material Design Lite</a> æ‰‹åˆ»çš„ cssï¼Œæ”¹ç”¨äº† <a href="https://github.com/edwardtufte/tufte-css">Tufte CSS</a> <span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote">æ­£ç¢ºä¾†èªªæ˜¯å®ƒçš„ pandoc ç‰ˆ fork â€œ<a href="https://github.com/jez/tufte-pandoc-css">tufte-pandoc-css</a>â€<br />
<br />
</span></span> é€™å¥—ä»¥ Edward Tufte çš„æ›¸ç±åŠæ‰‹ç¨¿<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote">æˆ‘æ²’çœ‹éï¼Œä½†æ˜¯å°±æ˜¯æ¨£åˆ©ç”¨å…©æ¬„è¨­è¨ˆï¼ŒæŠŠ foot note æ”¹ä½œ side note çš„é¢¨æ ¼ã€‚<br />
<br />
</span></span>çš„é¢¨æ ¼ç‚ºåŸºç¤çš„ä¸»é¡Œã€‚</p>
<p>é€™é‚Šç‰¹åœ°æˆªäº†å…©è€…çš„æˆªåœ–ä»¥ä½œç‚ºç´€å¿µï¼ˆä¸éå…¶å¯¦<code>git checkout</code>ä¸€ä¸‹ä¹Ÿè¡Œï¼‰</p>
<p><span><label for="sn-3" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="marginnote"> ä¹‹å‰çš„ä¸»é¡Œèµ° Material Design çš„å¡ç‰‡é¢¨æ ¼ï¼Œä»¥ç„¡è¥¯ç·šçš„é»‘é«”ç‚ºä¸»ã€‚ <a href="https://i.imgur.com/TQjq0Ju.png"><img src="https://i.imgur.com/TQjq0Ju.png" /></a><br />
<br />
</span></span></p>
<p><a href="https://i.imgur.com/e5mGJpO.png"><img src="https://i.imgur.com/e5mGJpO.png" /></a></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘é‚„åšäº†ï¼š</p>
<ul>
<li>æ”¹ç”¨ <a href="https://khan.github.io/KaTeX/"><span class="math inline">\(\KaTeX\)</span></a> é€™å€‹å‰ç«¯æ¸²æŸ“å¼•æ“ä¾†å‘ˆç¾ LaTeX çš„é‹ç®—å¼ï¼Œç›¸è¼ƒæ–¼ä¹‹å‰ pandoc çš„åŸºæœ¬æ¬¾å¯¦ä½œæ”¯æ´æ›´å¤šèªæ³•ï¼Œè€Œä¸”æ¸²æŸ“çµæœä¹Ÿå¥½çœ‹äº†ä¸å°‘ã€‚</li>
<li>ä½¿ç”¨ pandoc çš„ <code>eastAsianLineBreakFilter</code> ä¾†æ”¹é€²ä¸­æ–‡æ–·è¡Œçš„å‘ˆç¾ã€‚</li>
</ul>
</section>]]></description>
    <pubDate>Fri, 05 Jan 2018 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2018-01-05-new-style.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>ç­†è¨˜ï¼šå¹¾å€‹ CLI å¯¦ç”¨å·¥å…·: ag, fzf, fd, ripgrep</title>
    <link>https://op8867555.github.io/posts/2017-11-27-cli-tools-ag-rg-fzf-fd.html</link>
    <description><![CDATA[<p>ç­†è¨˜æœ€è¿‘ç”¨çš„å¹¾å€‹ CLI å·¥å…·ã€‚</p>
<section id="the-silver-searcher" class="level1">
<h1>The Silver Searcher</h1>
<p><a href="https://github.com/ggreer/the_silver_searcher">The Silver Searcher</a> æ˜¯ä¸€å€‹é¡ä¼¼ ack çš„æœå°‹å·¥å…·ï¼Œä¹Ÿå°±æ˜¯æ‰¾å‡ºå‡ºç¾æŸå­—ä¸²çš„æ‰€æœ‰æª”æ¡ˆã€‚</p>
<ul>
<li>é£›å¤©å¿«</li>
<li>é è¨­æ’é™¤ <code>.gitignore</code> <code>.hgignore</code> è£¡çš„ pattern</li>
<li>å…¶ä»–ä¸æƒ³è¦çš„ pattern å¯ä»¥å¯«åœ¨ <code>.ignore</code></li>
<li>ç”¨ c å¯¦ä½œ</li>
<li>ç›´åˆ° <span class="citation" data-cites="caasih">@caasih</span> æåˆ°ä¹‹å‰æˆ‘éƒ½æ²’ç™¼ç¾åŸ·è¡Œæª”åç¨± <code>ag</code> æ˜¯æ°´éŠ€çš„å…ƒç´ ç¬¦è™Ÿ</li>
</ul>
</section>
<section id="ripgrep" class="level1">
<h1>ripgrep</h1>
<p><a href="https://github.com/BurntSushi/ripgrep">Ripgrep</a> è·Ÿå‰è¿°çš„ The Silver Searcher åŠŸèƒ½å·®ä¸å¤š</p>
<ul>
<li>ä½†æ˜¯æ¯”é£›å¤©å¿«é‚„å¿«</li>
<li>å°æ–¼ ignore æª”æ¡ˆçš„å¯¦ä½œæ›´æ­£ç¢ºï¼Œag æœƒå¤šåä¸€äº›ä¸æ‡‰è©²å‡ºç¾çš„çµæœ</li>
<li>regexp çš„åŠŸèƒ½æ¯”è¼ƒå°‘ï¼ˆæ¯”æ–¹èªªæˆ‘å¾ä¾†æ²’ç”¨éçš„ lookaround è·Ÿ backreference å°±æ²’æœ‰å¯¦ä½œï¼‰</li>
<li>ç”¨ rust å¯¦ä½œ</li>
</ul>
</section>
<section id="fd" class="level1">
<h1>fd</h1>
<p><a href="https://github.com/sharkdp/fd">fd</a> æ˜¯ä¸€å€‹é¡ä¼¼ find çš„æª”æ¡ˆæœå°‹å·¥å…·</p>
<ul>
<li>ä¹Ÿæœƒé è¨­æ’é™¤ <code>.gitignore</code></li>
<li>é è¨­æ’é™¤éš±è—æª”æ¡ˆ</li>
<li>ä¹Ÿæ˜¯é£›å¤©å¿«</li>
<li>ä¹Ÿæ˜¯ rust å¯¦ä½œ</li>
</ul>
<section id="ç¯„ä¾‹" class="level2">
<h2>ç¯„ä¾‹</h2>
<ul>
<li><p>ç”¨ regexp æœå°‹</p>
<pre><code>fd &#39;[0-9]\.jpg$&#39;</code></pre></li>
<li><p>æœå°‹éš±è—æª”æ¡ˆè·Ÿè¢« ignore çš„æª”æ¡ˆ</p>
<pre><code>fd -H -I &#39;[0-9]\.jpg$&#39;</code></pre></li>
<li><p>æœå°‹ç‰¹å®šå‰¯æª”å</p>
<pre><code>fd -e jpg</code></pre></li>
<li><p>å°æœå°‹çµæœä¸‹æŒ‡ä»¤<strong>å¹³è¡ŒåŸ·è¡Œ</strong></p>
<pre><code>fd -e jpg -x convert {} {.}.png</code></pre>
<table>
<thead>
<tr class="header">
<th>variable</th>
<th style="text-align: left;">example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{}</td>
<td style="text-align: left;">documents/images/party.jpg</td>
</tr>
<tr class="even">
<td>{.}</td>
<td style="text-align: left;">documents/images/party</td>
</tr>
<tr class="odd">
<td>{/}</td>
<td style="text-align: left;">party.jpg</td>
</tr>
<tr class="even">
<td>{//}</td>
<td style="text-align: left;">documents/images</td>
</tr>
<tr class="odd">
<td>{/.}</td>
<td style="text-align: left;">party</td>
</tr>
</tbody>
</table></li>
</ul>
</section>
</section>
<section id="fzf" class="level1">
<h1>fzf</h1>
<p><a href="https://github.com/junegunn/fzf">fzf</a> æ˜¯ä¸€å€‹ fuzzy finderï¼Œå°±æ˜¯ cmd+T æˆ–æ˜¯ ctrl+p æˆ–æ˜¯ä»»ä½•ä¸€å€‹ æ–‡å­—ç·¨è¼¯å™¨/IDE è£¡é¢ä¸ç”¨æ‰“å…¨åå°±å¯ä»¥æ‰¾æª”æ¡ˆçš„é‚£å€‹åŠŸèƒ½</p>
<ul>
<li>ç”¨ go å¯«çš„</li>
<li><p>é è¨­ç”¨ find ï¼Œæ‰€ä»¥å¾ˆæ…¢ï¼Œç”¨ç’°å¢ƒè®Šæ•¸å¯ä»¥æ›ç”¨ fd</p>
<p>export FZF_DEFAULT_COMMAND=â€˜fd â€“type f â€“follow â€“exclude .gitâ€™</p></li>
<li><p>ctrl+r ä¾†æœå°‹æ­·å²</p>
<blockquote class="imgur-embed-pub" lang="en" data-id="IwjCK2l">
<a href="//imgur.com/IwjCK2l">View post on imgur.com</a>
</blockquote>
<script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script></li>
<li><p><code>**&lt;tab&gt;</code> å¯ä»¥é¸å–å¤šå€‹æª”æ¡ˆ</p>
<blockquote class="imgur-embed-pub" lang="en" data-id="ocxqb0C">
<a href="//imgur.com/ocxqb0C">View post on imgur.com</a>
</blockquote>
<script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script></li>
<li><p>ctrl+t ä¾†æœå°‹æª”æ¡ˆ</p>
<blockquote class="imgur-embed-pub" lang="en" data-id="SfiGWjD">
<a href="//imgur.com/SfiGWjD">View post on imgur.com</a>
</blockquote>
<script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script></li>
</ul>
</section>]]></description>
    <pubDate>Mon, 27 Nov 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-11-27-cli-tools-ag-rg-fzf-fd.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>[EN] Use your UNIX toolbox with pandas</title>
    <link>https://op8867555.github.io/posts/2017-10-13-use-your-unix-toolbox-with-pandas.html</link>
    <description><![CDATA[<p>I do analysis on log / csv / json files with a Python + Pandas + Jupyter Notebook stack at work. These files are so large that I usually need to do some pre-processing before loading them into memory.</p>
<p>UNIX tools are powerful to stream processing files: concatenation, filtering, transformingâ€¦, but it is annoying to â€œcontext-switchâ€ between Jupyter Notebook and shell. Also, Itâ€™s generate immediate files that need to remove later manually, quite annoying.</p>
<p>After some stackoverflow-ing, I found a solution<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote"><a href="https://stackoverflow.com/questions/13651117/pandas-filter-lines-on-load-in-read-csv/13653490#13653490">pandas: filter lines on load in read_csv</a><br />
<br />
</span></span> says you can read files in chunks:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1">df <span class="op">=</span> pd.concat(process(chunk_df) <span class="co"># do processing in python</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">               <span class="cf">for</span> chunk_df <span class="kw">in</span> pd.read_csv(<span class="st">&#39;bigdata.csv&#39;</span>, chunksize<span class="op">=</span><span class="dv">10000</span>))</a></code></pre></div>
<p>But there is a big overhead to create/process immediate data-frames.</p>
<p>Another solution<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote"><a href="https://stackoverflow.com/questions/39864304/how-to-use-subprocess-and-cat-to-read-in-data-line-by-line/39864368#39864368">How to use subprocess and â€˜catâ€™ to read in data line by line?</a><br />
<br />
</span></span> says you can use <code>subprocess</code> with PIPE, a clever idea. So I end up with this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="im">from</span> subprocess <span class="im">import</span> Popen, PIPE</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="cf">with</span> Popen(<span class="st">&#39;cat bigdata.csv | grep WHAT_I_CARE_ABOUT | some_transformations&#39;</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">           shell<span class="op">=</span><span class="va">True</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">           stdout<span class="op">=</span>PIPE) <span class="im">as</span> process:</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    df <span class="op">=</span> pd.read_csv(process.stdout)</a></code></pre></div>
<p>With this trick, I can now do some bash-fu with pandas in Jupyter-Notebook easily.</p>
<p><strong>Reading multiples files</strong></p>
<pre class="shell"><code>cat stats/2017/*/*.csv</code></pre>
<p><strong>JSON query with jq</strong></p>
<pre class="shell"><code>cat data.json | jq &#39;{.loc = .loc}&#39;</code></pre>
<p><strong>filter lines with awk or grep</strong></p>
<pre class="shell"><code>zcat data.csv.gz | grep &#39;SOME_TAG&#39; | awk &#39;$1 == 2017&#39;</code></pre>
<p><strong>pipe over files in .tar</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="fu">tar</span> -xOf bigdatas.tar.gz --wildcards <span class="st">&quot;*.data.csv&quot;</span></a></code></pre></div>]]></description>
    <pubDate>Fri, 13 Oct 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-10-13-use-your-unix-toolbox-with-pandas.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>æ‡‰ç”¨ git bisect æ‰¾å‡º linux kernel ä¸­å‡ºç¾å•é¡Œçš„ commit</title>
    <link>https://op8867555.github.io/posts/2017-10-05-bisecting-linux-kernel-bug.html</link>
    <description><![CDATA[<section id="tldr" class="level3">
<h3>TL;DR</h3>
<p>é€™ç¯‡æ–‡ç« ç­†è¨˜æˆ‘ä½¿ç”¨ git bisect ä¾†æ‰¾å‡º linux kernel (drm/i915) ä¸­çš„å°è‡´è¡Œç‚ºç•°å¸¸çš„æ˜¯å“ªä¸€å€‹ commit çš„éç¨‹ã€‚</p>
</section>
<section id="èµ·å› " class="level1">
<h1>èµ·å› </h1>
<p>æˆ‘çš„ç­†é›»ä¸Šè£çš„æ˜¯ Arch Linuxï¼ŒChromium åœ¨ linux ä¸Šæ˜¯<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=463440">ä¸æœƒæœ‰ç¡¬é«”åŠ é€ŸåŠŸèƒ½</a>çš„ï¼Œç‚ºäº†æ¸›å°‘ CPU è³‡æºçš„æµªè²»ï¼Œä¹Ÿç‚ºäº†å¢åŠ çºŒèˆªåŠ›ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¸€å€‹éå®˜æ–¹ç‰ˆæœ¬çš„ <a href="https://aur.archlinux.org/packages/chromium-vaapi/">chromium-vaapi</a>ã€‚</p>
<p>æœ€è¿‘åšå®Œç³»çµ±æ›´æ–°ä¹‹å¾Œç™¼ç¾ç¡¬é«”åŠ é€Ÿçš„åŠŸèƒ½å‡ºäº†äº›ç•°å¸¸ï¼Œåœ¨è·Ÿ AUR package çš„ä½¿ç”¨è€…è¨è«–å¾Œå¾—çŸ¥ï¼š</p>
<ul>
<li>mesa çš„ç‰ˆæœ¬æœƒå½±éŸ¿ï¼Œä½†æ˜¯é™ç‰ˆä¹‹å¾Œæœ‰ä¸åŒçš„ç•°å¸¸</li>
<li>é€™å€‹ä¸åŒçš„ç•°å¸¸åªæœ‰åœ¨æ’­æ”¾ VP9 æ ¼å¼çš„å½±ç‰‡æ™‚æœƒç™¼ç”Ÿ</li>
<li>åœ¨ä¸€ç•ªäº‚è©¦ä¹‹å¾Œç™¼ç¾åˆ° kernel é™å› 4.12 å°±æ²’äº‹äº†ï¼</li>
</ul>
<p>åšäº†ä¸€äº›åŠŸèª²ä¹‹å¾Œï¼Œæˆ‘èªç‚ºé€™å€‹ bug æ˜¯ä¾†è‡ªæ–¼ linux kernel ä¸­ DRM/i915 çš„éƒ¨ä»½ï¼Œæ–¼æ˜¯æˆ‘ä¾¿é–‹å§‹å˜—è©¦å¾èŒ«èŒ« commit æµ·æ’ˆå‡ºé‚£å€‹é‡ã€‚</p>
</section>
<section id="æ‰¾å‡ºå•é¡Œä¹‹æ—…" class="level1">
<h1>æ‰¾å‡ºå•é¡Œä¹‹æ—…</h1>
<section id="drm-tip" class="level2">
<h2>drm-tip</h2>
<p>drm-tip æ˜¯è£¡é¢åŒ…å«è‘—ä¸åŒçš„å¹¾å€‹åœ˜éšŠæ‰€ç¶­è­·çš„ drm å¯¦ä½œçš„ linux kernel</p>
<figure>
<img src="https://01.org/linuxgraphics/gfx-docs/maintainer-tools/_images/drm-intel-flow.svg" alt="é€™å€‹ merge flow å¾ˆè¤‡é›œï¼Œæˆ‘ä¹Ÿé‚„æ²’ææ‡‚" /><figcaption>é€™å€‹ merge flow å¾ˆè¤‡é›œï¼Œæˆ‘ä¹Ÿé‚„æ²’ææ‡‚</figcaption>
</figure>
</section>
<section id="åœ¨-archlinux-ä¸Šç·¨è­¯" class="level2">
<h2>åœ¨ ArchLinux ä¸Šç·¨è­¯</h2>
<p>å¹¸å¥½æˆ‘ä¸å¿…äº†è§£ä»–å€‘æ˜¯æ€éº¼ mergeï¼Œåªéœ€è¦ build èµ·ä¾†èƒ½æ¸¬è©¦åŠŸèƒ½æ˜¯å¦æ­£å¸¸å³å¯ã€‚</p>
<ul>
<li>ä½¿ç”¨ AUR ä¸Šé¢çš„ <a href="https://aur.archlinux.org/cgit/aur.git/tree/PKGBUILD?h=linux-drm-tip-git&amp;id=f2f3487589a22ee728472259f4bd79af75bd782b">linux-drm-tip-git</a> é€™å€‹ package ç·¨è­¯æœ€æ–°çš„ç‰ˆæœ¬</li>
<li>é‡åˆ° <code>make prepare</code> è©¢å•åƒæ•¸æ˜¯å› ç‚º <code>config.x86-64</code> çš„ç‰ˆæœ¬ä¸å¤ æ–°
<ul>
<li>æˆ‘ç›´æ¥æ‰¾äº† <a href="https://aur.archlinux.org/packages/linux-mainline/">linux-mainline</a> çš„ä¾†ç”¨</li>
</ul></li>
<li>å…ˆç”¨ <code>makepkg -Asi</code> ç·¨è­¯å®‰è£ä¸€éã€‚</li>
<li>ç„¶å¾Œä½¿ç”¨é€™å€‹ç‰ˆæœ¬çš„ kernel å¾Œç™¼ç¾ã€æ©ã€å•é¡Œä¾èˆŠ</li>
</ul>
</section>
<section id="åŠ å¿«ç·¨è­¯é€Ÿåº¦" class="level2">
<h2>åŠ å¿«ç·¨è­¯é€Ÿåº¦</h2>
<p>æˆ‘ç”¨äº†å…©å€‹å·¥å…·ä¾†åŠ é€Ÿç·¨è­¯é€Ÿåº¦ï¼š</p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/ccache">ccache</a>: å¹« gcc åšå¿«å–ï¼Œæ”¹å–„é‡è¤‡ç·¨è­¯æ‰€éœ€çš„æ™‚é–“</li>
<li><a href="https://wiki.archlinux.org/index.php/Modprobed-db">modprobed-db</a>: æ¸›å°‘æ‰€éœ€ç·¨è­¯çš„æ¨¡çµ„æ•¸</li>
</ul>
</section>
<section id="bisect" class="level2">
<h2>bisect</h2>
<p>è¦å¾è‡³å°‘ 27000 ç­†çš„ commit ä¸­æ‰¾éŒ¯èª¤ï¼Œç•¶ç„¶ä¸æœƒä¸€ç­†ä¸€ç­†å˜—è©¦ã€‚é€™é‚Šä½¿ç”¨çš„ bisect å°±æ˜¯ç”¨ç¶“å…¸çš„æ¼”ç®—æ³•ã€ŒäºŒåˆ†æœå°‹æ³•ã€ä¾†åŠ å¿«å°‹æ‰¾çš„é€Ÿåº¦ã€‚</p>
<section id="æ­¥é©Ÿ" class="level3">
<h3>æ­¥é©Ÿ</h3>
<ul>
<li>ç·¨è­¯å®Œä¹‹å¾Œï¼Œé€² <code>src/drm-tip</code> åŸ·è¡Œ <code>git bisect start</code></li>
<li>ç¢ºèªå•é¡Œé‚„åœ¨ï¼Œæ¨™è¨˜ç‚ºæœ‰å•é¡Œçš„ç‰ˆæœ¬ <code>git bisect bad</code></li>
<li><code>git checkout</code> åˆ°èªç‚ºæ²’å•é¡Œçš„ç‰ˆæœ¬ï¼ˆå› ç‚ºæˆ‘çŸ¥é“ 4.12 æ²’æœ‰å•é¡Œï¼Œæ‰€ä»¥æˆ‘æ‰¾åˆ°å°æ‡‰çš„ commit æ˜¯<code>6f7da29</code>ï¼‰</li>
<li><code>makepkg -esfi</code> ç·¨è­¯ä¸¦å®‰è£æ­¤ç‰ˆæœ¬
<ul>
<li>å› ç‚º <code>git bisect</code> æœƒ checkout åˆ°ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥éœ€è¦ç”¨ <code>-e</code> ä¾†å‘Šè¨´ makepkg ä¸è¦é‡æ–° checkout</li>
</ul></li>
<li><p>é‡é–‹æ©Ÿæª¢æŸ¥å•é¡Œæ˜¯å¦é‚„åœ¨ï¼Œæ²’æœ‰å•é¡Œï¼Œç”¨ <code>git bisect good</code> æ¨™è¨˜</p>
<pre class="shell"><code>&gt; git bisect good
Bisecting: 13952 revisions left to test after this (roughly 14 steps)
[73adb8c5b0ea15e3942ab5781eb3e72d4e028ada] Merge tag &#39;for-4.13/dm-fixes-2&#39; of git://git.kernel.org/pub/scm/linux/kernel/git/device-mapper/linux-dm</code></pre></li>
</ul>
</section>
<section id="é ä¼°é‚„è¦å¹¾æ¬¡æŸ¥è©¢" class="level3">
<h3>é ä¼°é‚„è¦å¹¾æ¬¡æŸ¥è©¢</h3>
<ul>
<li><code>git rev-list drm-tip ^6f7da290413b --count</code> å‘Šè¨´æˆ‘é€™å…©å€‹ä¸­é–“å·®äº† 27906 å€‹ commit</li>
<li>æ‰€ä»¥æˆ‘é æœŸæœ€å¤šé‚„éœ€è¦ 16 æ¬¡çš„ç¯©é¸ (<span class="math inline">\(log_2(27906)+1 \approx 15.77\)</span>)</li>
</ul>
</section>
<section id="ç¹¼çºŒå°‹æ‰¾å•é¡Œ" class="level3">
<h3>ç¹¼çºŒå°‹æ‰¾å•é¡Œ</h3>
<p>é€™é‚Šå°±æ˜¯ä¸æ–·çš„é‡è¤‡ï¼š</p>
<ul>
<li>ç·¨è­¯</li>
<li>æ¸¬è©¦</li>
<li><code>git bisect [good|bad]</code></li>
</ul>
<pre class="half-page"><code>&gt; git bisect bad 73adb8c5b0ea
Bisecting: 6975 revisions left to test after this (roughly 13 steps)
[4f5dfdd29065a0d1d0e61d9744e14d1d852518be] Merge tag &#39;leds_for_4.13&#39; of git://git.kernel.org/pub/scm/linux/kernel/git/j.anaszewski/linux-leds

&gt; git bisect good 4f5dfdd29065
Bisecting: 3487 revisions left to test after this (roughly 12 steps)
[8c03cc85a035ae7a208c28c4382ecfeb6adf79a6] fs/proc/task_mmu.c: remove obsolete comment in show_map_vma()

&gt; git bisect bad 8c03cc85a035
Bisecting: 1723 revisions left to test after this (roughly 11 steps)
[2ceedf97aef41d071d897a6e6aec8c05fb707ec4] Merge tag &#39;dmaengine-4.13-rc1&#39; of git://git.infradead.org/users/vkoul/slave-dma

&gt; git bisect good 2ceedf97aef4
Bisecting: 818 revisions left to test after this (roughly 10 steps)
[04d4fb5fa63876d8e7cf67f2788aecfafc6a28a7] Merge branch &#39;drm-next-4.13&#39; of git://people.freedesktop.org/~agd5f/linux into drm-next

&gt; git bisect good 04d4fb5fa638
Bisecting: 420 revisions left to test after this (roughly 9 steps)
[00fc2c26bc46a64545cdf95a1511461ea9acecb4] drm: Remove unused drm_file parameter to drm_syncobj_replace_fence()

&gt; git bisect bad 00fc2c26bc46
Bisecting: 222 revisions left to test after this (roughly 8 steps)
[eafae133e48c9e5f5537d5c6df34eab912336b9a] Merge tag &#39;drm-msm-next-2017-06-20&#39; of git://people.freedesktop.org/~robclark/linux into drm-next

&gt; git bisect good eafae133e48c
Bisecting: 111 revisions left to test after this (roughly 7 steps)
[fc59921178fd63f1dbe445c2fc86e6ca997a4744] drm/i915/perf: Add more OA configs for BDW, CHV, SKL + BXT

&gt; git bisect good fc59921178fd
Bisecting: 55 revisions left to test after this (roughly 6 steps)
[7dd4f6729f9243bd7046c6f04c107a456bda38eb] drm/i915: Async GPU relocation processing

&gt; git bisect bad 7dd4f6729f92
Bisecting: 34 revisions left to test after this (roughly 5 steps)
[615c16a9d8649b9894592d11bc393e684b11e2ea] drm/i915/gvt: Refine virtual reset function

&gt; git bisect good 615c16a9d864
Bisecting: 17 revisions left to test after this (roughly 4 steps)
[f6262bda462e81e959b80a96dac799bd9df27f73] drm/i915: Don&#39;t enable backlight at setup time.

&gt; git bisect good f6262bda462e
Bisecting: 8 revisions left to test after this (roughly 3 steps)
[4c9c0d09741deab0aac76b83961cfe95b24f3e6f] drm/i915: Fix retrieval of hangcheck stats

&gt; git bisect good 4c9c0d09741d
Bisecting: 4 revisions left to test after this (roughly 2 steps)
[2889caa9232109afc8881f29a2205abeb5709d0c] drm/i915: Eliminate lots of iterations over the execobjects array

&gt; git bisect bad 2889caa92321
Bisecting: 1 revision left to test after this (roughly 1 step)
[507d977ff965682a925ffe479c95136680fcb77b] drm/i915: Pass vma to relocate entry

&gt; git bisect good 507d977ff965
Bisecting: 0 revisions left to test after this (roughly 0 steps)
[071750e550af46b5d3a84ad56c2a108c3e136284] drm/i915: Disable EXEC_OBJECT_ASYNC when doing relocations</code></pre>
</section>
<section id="æ‰¾å‡ºæœ‰å•é¡Œçš„-commit" class="level3">
<h3>æ‰¾å‡ºæœ‰å•é¡Œçš„ commit</h3>
<p>ä¸æ–·é‡è¤‡ä¸Šé¢çš„æ­¥é©Ÿï¼Œæœ€å¾Œæ‰¾å‡ºç¬¬ä¸€å€‹æœ‰å•é¡Œçš„ commit</p>
<pre><code>&gt; git bisect good 071750e550af
2889caa9232109afc8881f29a2205abeb5709d0c is the first bad commit</code></pre>
</section>
</section>
</section>
<section id="å¾Œè¨˜" class="level1">
<h1>å¾Œè¨˜</h1>
<p>é€™å€‹éç¨‹ä¸¦ä¸æ˜¯å¾ˆè¼•é¬†ï¼ˆç·¨è­¯ä¸€æ¬¡è‡³å°‘éœ€è¦ 10minï¼Œé‚„è¦é‡é–‹æ©Ÿæ¸¬è©¦ï¼‰ï¼Œå°‡é€™å€‹æ‰¾åˆ°çš„é€™å€‹ commit å›å ±ä¸Šå»ä¹‹å¾Œï¼Œé–‹ç™¼è€…å¾ˆå¿«çš„å°±èƒ½æ‰¾åˆ°å•é¡Œçš„é—œéµé»ã€‚</p>
<p>æœ€å¾Œå¾—åˆ°çš„çµè«–æ˜¯ï¼Œé€™å€‹å•é¡Œæ‡‰è©²æ˜¯ä¾†è‡ª user space driver æ²’æœ‰å¯¦ä½œæ­£ç¢ºï¼Œæ–¼æ˜¯æˆ‘å›å»æ‰¾äº† intel-vaapi-driver çš„ issue trackerï¼Œæ‰ç™¼ç¾åˆ°åŸä¾†æ—©åœ¨ 3 å€‹æ˜ŸæœŸå‰å°±æœ‰äºº<a href="https://github.com/01org/intel-vaapi-driver/issues/262">å›å ±</a>éï¼Œè€Œä¸”ä¹Ÿå·²ç¶“ä¿®æ­£ä¸¦ merge å› master äº†ã€‚å›§</p>
<p>é›–ç„¶æœ€å¾Œç™¼ç¾ä¸æ˜¯ linux kernel çš„å•é¡Œï¼Œä¸éé€™ä¹Ÿä¾ç„¶æ˜¯å€‹å‹™å¯¦çš„é™¤éŒ¯ç¶“é©—ã€‚</p>
</section>
<section id="åƒè€ƒè³‡æ–™" class="level1">
<h1>åƒè€ƒè³‡æ–™</h1>
<p><strong>drm/i915</strong></p>
<ul>
<li><a href="https://01.org/linuxgraphics/documentation/how-report-bugs">how to report bugs</a></li>
<li><a href="https://01.org/linuxgraphics/gfx-docs/maintainer-tools/drm-intel.html">drm-intel</a></li>
</ul>
<p><strong>git bisect</strong></p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Bisecting_bugs">Bisecting bugs</a></li>
<li><a href="https://project-insanity.org/blog/2013/02/13/how-i-found-a-kernel-regression-using-git-bisect/">How I fixed a kernel regression using git bisect</a></li>
</ul>
</section>]]></description>
    <pubDate>Thu, 05 Oct 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-10-05-bisecting-linux-kernel-bug.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>ç”¨ Python è¨ˆç®—ç¶“ç·¯åº¦å°æ‡‰çš„é„‰é®å¸‚å€</title>
    <link>https://op8867555.github.io/posts/2017-09-16-python-getting-town-from-gps-coord.html</link>
    <description><![CDATA[<section id="tldr" class="level3">
<h3>TL;DR</h3>
<p>é€™ç¯‡æ–‡ç« ç­†è¨˜æœ€è¿‘æœ‹å‹å•çš„ä¸€å€‹å•é¡Œï¼š å¦‚ä½•ä¸é å¤–éƒ¨ API å–å¾—ä¸€å€‹ç¶“ç·¯åº¦åº§æ¨™è½åœ¨å“ªä¸€å€‹é„‰é®å¸‚å€ã€‚</p>
<p>é€™é‚Šæ‡‰ç”¨æ”¿åºœ open data çš„ <a href="https://data.gov.tw/dataset/7441">é„‰é®å¸‚å€ç•Œç·š</a> è³‡æ–™ï¼ŒåŠ ä¸Š python çš„ shapely åšç¯„åœåˆ¤æ–·ã€ç”¨ rtree å»ºç«‹ç´¢å¼•åŠ é€ŸæŸ¥è©¢ã€‚</p>
</section>
<section id="å¯¦ä½œç­†è¨˜" class="level1">
<h1>å¯¦ä½œç­†è¨˜</h1>
<p>æƒ³æ³•å¾ˆå–®ç´”ï¼Œå°±æ˜¯é€éåˆ¤æ–·åº§æ¨™(è¼¸å…¥çš„ç¶“ç·¯åº¦)æœ‰æ²’æœ‰è½åœ¨å¤šé‚Šå½¢(é„‰é®é‚Šç•Œ)çš„ç¯„åœå…§ã€‚</p>
<section id="è³‡æ–™ä¾†æº" class="level2">
<h2>è³‡æ–™ä¾†æº</h2>
<p>æ”¿åºœæœ‰æä¾›<a href="https://data.gov.tw/dataset/7441">é„‰é®å¸‚å€ç•Œç·š</a>è³‡æ–™ï¼Œæ˜¯ä¸€å€‹ <a href="https://en.wikipedia.org/wiki/Shapefile">Shapefile</a>ã€‚ Python è¦è®€å– .shp æª”ä¸é›£ï¼Œæœ‰å¾ˆå¤š library å¯ä»¥åšåˆ°ï¼Œå¯ä»¥åƒè€ƒ<a href="https://gis.stackexchange.com/questions/113799/how-to-read-a-shapefile-in-python">é€™ç¯‡</a>ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> fiona</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">from</span> shapely.geometry <span class="im">import</span> shape, Point</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">collection <span class="op">=</span> fiona.<span class="bu">open</span>(<span class="st">&#39;./TOWN_MOI_1060525.shp&#39;</span>)</a></code></pre></div>
</section>
<section id="æŸ¥è©¢" class="level2">
<h2>æŸ¥è©¢</h2>
<p>é€™é‚Šæˆ‘ä½¿ç”¨çš„æ˜¯ <code>shapely</code> é€™å€‹å¥—ä»¶ä¾†è¨ˆç®—åº§æ¨™æœ‰ç„¡åº§è½æ–¼æŸå€‹å¤šé‚Šå½¢ã€‚ æ‰€ä»¥å…ˆå°‡ .shp å…§çš„ geometry å»ºç«‹æˆ shapely çš„ Polygon ç‰©ä»¶ï¼š</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1">shapes <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">properties <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="cf">for</span> f <span class="kw">in</span> collection:</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">    town_id <span class="op">=</span> <span class="bu">int</span>(f[<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;TOWNCODE&#39;</span>])</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    shapes[town_id] <span class="op">=</span> shape(f[<span class="st">&#39;geometry&#39;</span>])</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    properties[town_id] <span class="op">=</span> f[<span class="st">&#39;properties&#39;</span>]</a></code></pre></div>
<p>é€™æ¨£å°±å¯ä»¥ç”¨ <code class="sourceCode python">polygon.contains(Point(x, y))</code> åˆ¤æ–·ä¸€å€‹é»æœ‰æ²’æœ‰åº§è½æ–¼å…¶ä¸­ã€‚å°é€™æ‰€æœ‰çš„å¤šé‚Šå½¢èµ°è¨ªä¸€éå°±å¯ä»¥çŸ¥é“åº§è½æ–¼å“ªè£¡ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">def</span> search(x, y):</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="cf">return</span> <span class="bu">next</span>((town_id</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                 <span class="cf">for</span> town_id <span class="kw">in</span> shapes</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                 <span class="cf">if</span> shapes[town_id].contains(Point(x, y))), <span class="va">None</span>)</a></code></pre></div>
</section>
<section id="åŠ é€ŸæŸ¥è©¢" class="level2">
<h2>åŠ é€ŸæŸ¥è©¢</h2>
<p>ä¸Šé¢çš„æŸ¥è©¢å¾ˆå–®ç´”åœ°æ¸¬è©¦å…¨å°ç£ 368 å€‹é„‰é®å¸‚çš„å¤šé‚Šå½¢äº†ä¸€éï¼Œå¦‚æœæ˜¯å°é‡çš„è¼¸å…¥è³‡æ–™æ‡‰è©²é‚„ç®—æ˜¯å¯ä»¥æ¥å—ï¼Œä¸éå¦‚æœéœ€è¦æ›´ç´°çš„æ¯”å°ï¼ˆè¨ˆç®—åˆ°æ‘é‡Œï¼‰ã€æˆ–æ˜¯æœ‰å¤§é‡è³‡æ–™è¦è¨ˆç®—çš„è©±ï¼Œé€™æ¨£çš„æ–¹æ³•é‚„æ˜¯ä¸å¤ æœ‰æ•ˆç‡ã€‚</p>
<p>å› ç‚ºåœ¨æŸ¥è©¢ä¸€å€‹å°åŒ—çš„åº§æ¨™æ™‚ï¼Œå…¶å¯¦ä¸ç”¨è€ƒæ…®é›¢ä»–å¤ªé çš„å°ä¸­ã€å°å—â€¦ç­‰å…¶ä»–é„‰é®å¸‚å€ã€‚</p>
<p>åŸºæ–¼é€™æ¨£çš„æƒ³æ³•ï¼Œé€™é‚Šç”¨ R-Tree é€™å€‹<a href="https://en.wikipedia.org/wiki/R-tree">è³‡æ–™çµæ§‹</a>ä¾†å¹«é€™äº›å¤šé‚Šå½¢çš„ bounding boxï¼ˆå¤šé‚Šå½¢çš„æœ€å°å¤–æ¥çŸ©å½¢ï¼‰åšç´¢å¼•ï¼š</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="im">from</span> rtree <span class="im">import</span> index</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">idx <span class="op">=</span> index.Index()</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="cf">for</span> town_id, shape <span class="kw">in</span> shapes.items():</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    idx.insert(town_id, shape.bounds)</a></code></pre></div>
<p>é€™æ¨£å°±å¯ä»¥é€é <code class="sourceCode python">idx.intersection((x, y))</code> ä¾†æ‰¾å‡ºè·Ÿåº§æ¨™æœ‰äº¤é›†çš„ bounding boxã€‚æˆ‘å€‘åªéœ€è¦æª¢æŸ¥åº§æ¨™è½åœ¨å…¶ä¸­çš„å“ªä¸€å€‹çš„å¤šé‚Šå½¢å³å¯ï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">def</span> search(x, y):</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    <span class="cf">return</span> <span class="bu">next</span>((town_id</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                 <span class="cf">for</span> town_id <span class="kw">in</span> idx.intersection((x, y))</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                 <span class="cf">if</span> shapes[town_id].contains(Point(x, y))), <span class="va">None</span>)</a></code></pre></div>
<p>é€™æ¨£æŸ¥è©¢çš„æ™‚é–“å°±å¯ä»¥å¾ <span class="math inline">\(O(N)\)</span> åŠ å¿«åˆ° <span class="math inline">\(O(log_M N + M)\)</span> äº†ã€‚ä»¥é„‰é®å¸‚å€ä¾†èªªï¼Œåœ¨æˆ‘çš„ç­†é›»ä¸Šï¼Œå¾æœ¬ä¾†æ¯æ¬¡å¹³å‡éœ€è¦ 3.95ms æå‡åˆ°æ¯æ¬¡å¹³å‡ 223 Âµsï¼Œè‡³å°‘å¿«äº† 16 å€ã€‚</p>
<figure>
<img src="https://i.imgur.com/MDrOi7i.png" alt="ä»¥ğŸ‡¹ğŸ‡¼ç¸½çµ±åºœä¾†èˆ‰ä¾‹ï¼Œå®ƒè½åœ¨è¬è¯å€è·Ÿä¸­æ­£å€å…©å€‹ bounding boxes è£¡é¢" /><figcaption>ä»¥ğŸ‡¹ğŸ‡¼ç¸½çµ±åºœä¾†èˆ‰ä¾‹ï¼Œå®ƒè½åœ¨è¬è¯å€è·Ÿä¸­æ­£å€å…©å€‹ bounding boxes è£¡é¢</figcaption>
</figure>
</section>
</section>]]></description>
    <pubDate>Sat, 16 Sep 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-09-16-python-getting-town-from-gps-coord.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>æ‰‹å‹•ç·¨è­¯ vs ç·¨è­¯å¥½çš„ tensorflow</title>
    <link>https://op8867555.github.io/posts/2017-09-09-tensorflow-prebuilt-vs-built-from-source.html</link>
    <description><![CDATA[<p>äº‚çœ‹æ–‡ç« æ™‚ç™¼ç¾åˆ° tensorflow prebuilt ç‰ˆè·Ÿè‡ªå·± build æ•ˆèƒ½æœ‰è½å·®ï¼ˆç¾åœ¨æƒ³æƒ³é€™ä¹Ÿæ˜¯ç†æ‰€ç•¶ç„¶çš„äº‹ï¼‰ï¼Œæ–¼æ˜¯å°±ä¾†è‡ªå·±ç·¨ç·¨çœ‹åˆ°åº•å·®å¤šå°‘äº†ã€‚</p>
<section id="å¯¦é©—" class="level1">
<h1>å¯¦é©—</h1>
<section id="ä½¿ç”¨çš„æ©Ÿå™¨" class="level2">
<h2>ä½¿ç”¨çš„æ©Ÿå™¨</h2>
<p>Thinkpad X1 Carbon 2017ï¼Œå®ƒçš„ CPU æ˜¯ Intel çš„ i7-7500Uï¼ˆå°ï¼Œé€™é¡†çµ•å°ä¸é©åˆæ‹¿ä¾†ç®—é€™å€‹ï¼‰</p>
</section>
<section id="ä½¿ç”¨çš„ä¸åŒç‰ˆæœ¬" class="level2">
<h2>ä½¿ç”¨çš„ä¸åŒç‰ˆæœ¬</h2>
<ul>
<li><p><a href="https://pypi.python.org/pypi/tensorflow">PyPI ä¸Šçš„ç‰ˆæœ¬</a>ï¼Œæ²’æœ‰æ©Ÿå™¨ç›¸é—œçš„æœ€ä½³åŒ–ã€‚</p></li>
<li><p><a href="https://software.intel.com/en-us/articles/tensorflow-optimizations-on-modern-intel-architecture">intel æä¾›çš„ç‰ˆæœ¬</a> ä½¿ç”¨ intel çš„ Math Kernel libraryï¼Œä½†æ˜¯æ²’æœ‰æ©Ÿå™¨ç›¸é—œçš„æœ€ä½³åŒ–<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote">æ²’æœ‰åšæ©Ÿå™¨ç›¸é—œçš„æœ€ä½³åŒ–æ™‚æœƒæœ‰æé†’<br />
<br />
</span></span>ã€‚</p></li>
<li><p>è‡ªå·± build ï¼Œç”¨çš„æ˜¯ tensorflow å®˜æ–¹ github repo çš„ <a href="https://github.com/tensorflow/tensorflow/tree/32ffc5a81eee8c39bbe71536212a773b1ffd4eb2">32ffc5a81</a></p>
<ul>
<li><code>./configure</code> éƒ½ç”¨é è¨­å€¼ (<code>-march=native</code> é–‹å•Ÿç•¶ä¸‹æ©Ÿå™¨æ¶æ§‹çš„æœ€ä½³åŒ–ï¼‰</li>
<li><code>--config=mkl</code> åŒ intel ç‰ˆæœ¬</li>
</ul></li>
</ul>
</section>
<section id="ä½¿ç”¨çš„æ¸¬è©¦æ¡ˆä¾‹" class="level2">
<h2>ä½¿ç”¨çš„æ¸¬è©¦æ¡ˆä¾‹</h2>
<p>ä½¿ç”¨äº† keras çš„å¹¾å€‹ <a href="https://github.com/fchollet/keras/tree/master/examples">example</a> ä¾†æ¸¬è©¦<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote">å•æˆ‘ç‚ºä»€éº¼è¦ç”¨ keras è€Œä¸ç”¨ tensorflow å°±å¥½ï¼Ÿå› ç‚ºæˆ‘é‚„æƒ³æ¸¬ theano å•Šâ€¦<br />
<br />
</span></span>ï¼Œåˆ†åˆ¥æ˜¯ï¼š</p>
<ul>
<li>mnist-mlp</li>
<li>mnist-cnn</li>
<li>cifar10-cnn</li>
</ul>
</section>
<section id="æ¸¬è©¦çµæœ" class="level2">
<h2>æ¸¬è©¦çµæœ</h2>
<table>
<caption>å¯¦é©—çµæœï¼ˆæ•¸å€¼æ˜¯æ¯æ¬¡ epoch æ‰€èŠ±çš„æ™‚é–“ï¼Œè¶Šå°è¶Šå¥½ï¼‰</caption>
<thead>
<tr class="header">
<th style="text-align: left;">testcase</th>
<th style="text-align: right;">pip</th>
<th style="text-align: right;">intel</th>
<th style="text-align: right;">built</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mnist-mlp</td>
<td style="text-align: right;">9.5s</td>
<td style="text-align: right;">10.5s</td>
<td style="text-align: right;">10.5s</td>
</tr>
<tr class="even">
<td style="text-align: left;">mnist-cnn</td>
<td style="text-align: right;">175.5s</td>
<td style="text-align: right;">63s</td>
<td style="text-align: right;">60s</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cifar10-cnn[^1]</td>
<td style="text-align: right;">275s</td>
<td style="text-align: right;">200s</td>
<td style="text-align: right;">200s</td>
</tr>
</tbody>
</table>
<p><span><label for="sn-3" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="marginnote"> [^1] å› ç‚ºæœ‰ 200 å€‹ epoch è¦è·‘ï¼Œå¯¦åœ¨è¦èŠ±å¾ˆå¤šæ™‚é–“ï¼Œæ‰€ä»¥é€™é‚Šå°±éƒ½åªå–å¤§æ¦‚ 3~4 å€‹ epoch çš„æ™‚é–“ä¾†ç®—<br />
<br />
</span></span></p>
</section>
<section id="çµè«–" class="level2">
<h2>çµè«–</h2>
<ul>
<li>å¦‚æœæ˜¯çœŸå¿ƒæƒ³è¦ç”¨ Intel çš„ CPU è·‘ tensorflow â€¦
<ul>
<li>â€¦ä¹Ÿé¡˜æ„è‡ªå·±èŠ±æ™‚é–“ç·¨è­¯ï¼Œé‚£<strong>æ‰‹å‹•ç·¨è­¯</strong>æ˜¯ï¼ˆåŸ·è¡Œæ™‚ï¼‰æœ€å¿«çš„é¸é …</li>
<li>â€¦å»ä¸æƒ³è‡ªå·±ç·¨ï¼Œä½†å¯ä»¥æ¥å—ä¸æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œé‚£ç›´æ¥ä½¿ç”¨<a href="https://software.intel.com/en-us/articles/tensorflow-optimizations-on-modern-intel-architecture"><strong>intel æä¾›çš„ç‰ˆæœ¬</strong></a></li>
</ul></li>
<li>å¦‚æœæ²’é‚£éº¼çœŸå¿ƒæƒ³ç”¨ï¼Œåªæ˜¯å…ˆç”¨ CPU ç©ç©çœ‹ï¼Œé‚£<a href="https://pypi.python.org/pypi/tensorflow"><strong>ç›´æ¥ç”¨ pip è£</strong></a>æ˜¯æœ€ç°¡æ˜“çš„é¸é …ã€‚</li>
<li><em>çœŸå¿ƒæƒ³è·‘ tensorflow é‚„æ˜¯å»å¼„å€‹æœ‰ GPU çš„ç’°å¢ƒå§â€¦</em>
<ul>
<li>ç”¨äº† GTX 1060 6GB çš„æ¡Œé›»è·‘ cifar10-cnn ï¼Œä¸€å€‹ epoch åªè¦ 25s</li>
</ul></li>
</ul>
</section>
</section>]]></description>
    <pubDate>Sat, 09 Sep 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-09-09-tensorflow-prebuilt-vs-built-from-source.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>ç­†è¨˜ï¼š DS216j å®‰è£ shadowsocks server</title>
    <link>https://op8867555.github.io/posts/2017-08-27-ds216j-shadowsocks.html</link>
    <description><![CDATA[<p>æœ€è¿‘è¦ªæˆšå¼„äº†å° Synology DS216j æƒ³æ‹¿ä¾†æ¶ shadowsocks çš„ serverï¼Œé€™ç¯‡æ–‡ç« ç­†è¨˜æˆ‘æ¶é€™å€‹ server æ‰€èµ°çš„è·¯ã€‚</p>
<section id="changelogs" class="level3">
<h3>changelogs</h3>
<ul>
<li>2017-10-12 ç´€éŒ„ä¸€ä¸‹ï¼Œç¾åœ¨ä¸Šæ¸¸æœ‰ç·¨å¥½çš„ package èƒ½ç”¨äº†</li>
</ul>
</section>
<section id="æŠ˜é¨°éç¨‹" class="level1">
<h1>æŠ˜é¨°éç¨‹</h1>
<p>æåˆ°åœ¨ NAS ä¸Šæ¶ shadowsocksï¼Œå¯ä»¥æŸ¥åˆ°å¾ˆå¤šç”¨ docker çš„è§£æ±ºæ–¹æ³•ï¼Œä¸éç¶²è·¯ä¸Šçš„å¹¾ç¯‡æ–‡ç« éƒ½èªªé€™å°æ©Ÿå™¨ä¸èƒ½ç”¨ dockerï¼Œæ‰€ä»¥æˆ‘ç›´æ¥å¾€ binary çš„æ–¹æ³•å‰é€²ã€‚</p>
<p>ä¸€é–‹å§‹çœ‹åˆ°çš„æ˜¯é€™ç¯‡ <a href="http://jexbat.com/2016/NAS-Shadowsocks/">Synology DS216Play å®‰è£… ShadowSocks</a>ï¼Œå¾é€™ç¯‡æ–‡ç« ä¸­å¾—å‡ºï¼š</p>
<ul>
<li>åŸä¾†æœ‰ package manager å¯ä»¥ç”¨</li>
<li>shadowsocks æœ‰ç”¨ python è·Ÿ libev çš„å¯¦ä½œå¯ä»¥é¸</li>
</ul>
<section id="å®‰è£package-manager" class="level2">
<h2>å®‰è£package manager</h2>
<p>æœè‘—å®‰è£ package manager çš„æ–¹å‘å‰é€²å¾Œæ‰¾åˆ°äº†é€™ç¯‡<a href="https://ky0n.xyz/synology-ds216j-optware-ipkg-init/">Synology DS216j Optware IPKG ä»‹ç´¹</a>ã€‚<br />
çœ‹äº†çœ‹ç™¼ç¾é€™æ˜¯ç¯‡ç¿»è­¯æ–‡ï¼Œè€ŒåŸæ–‡æœ‰äº†æ›´æ–°çš„<a href="http://jasmin.sakura.ne.jp/blog/0245">ç‰ˆæœ¬ğŸ‡¯ğŸ‡µ</a>ï¼Œç™¼ç¾åˆ°æœ‰ <a href="https://github.com/Entware-ng/Entware-ng/">entware-ng</a> é€™å€‹æ¯” ipkg æ›´æ–°çš„ package manager èƒ½ç”¨ï¼Œè€Œä¸”å·²ç¶“æœ‰ shadowsocks çš„<a href="http://pkg.entware.net/binaries/armv7/Packages.html">å¥—ä»¶èƒ½ç”¨</a>ã€‚</p>
</section>
<section id="å®‰è£-entware-ng" class="level2">
<h2>å®‰è£ entware-ng</h2>
<p>å®‰è£çš„éç¨‹ä¸é›£ï¼Œå¤§è‡´ä¸Šå°±æ˜¯é–‹å¥½SSHã€ç…§è‘—<a href="https://github.com/Entware-ng/Entware-ng/wiki/Install-on-Synology-NAS">å…¶ wiki ä¸Šå¯«çš„æ­¥é©Ÿ</a>å°±è¡Œã€‚</p>
<p>ç­†è¨˜ä¸€ä¸‹æ­¥é©Ÿï¼š</p>
<ul>
<li><p>å»ºç«‹ä¸€å€‹å¥—ä»¶ç®¡ç†ç”¨çš„ç›®éŒ„ï¼Œå› ç‚ºéŸŒé«”æ›´æ–°æœƒæ¸… /opt ï¼Œæ‰€ä»¥è¦åœ¨å¤–é¢å»ºä¸¦ symlink å›å»ï¼š</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="fu">mkdir</span> -p /volume1/@entware-ng/opt</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="fu">rm</span> -rf /opt</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="fu">ln</span> -sf /volume1/@entware-ng/opt /opt</a></code></pre></div></li>
<li><p>å®‰è£ entware</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="fu">wget</span> -O - http://pkg.entware.net/binaries/armv7/installer/entware_install.sh <span class="kw">|</span> <span class="ex">/bin/sh</span></a></code></pre></div></li>
<li><p>è¨­å®šå•Ÿå‹•è…³æœ¬ï¼ˆé‡é–‹æ©Ÿæ™‚æŠŠ entware è£çš„æœå‹™ä¹Ÿå¸¶èµ·ä¾†ï¼‰<br />
ç·¨è¼¯ /usr/local/etc/rc.d/entware-startup.sh ï¼ˆæ•™å­¸ä¸Šæ²’æœ‰ï¼Œä½†æ˜¯æˆ‘æœ‰é †ä¾¿åš <code>chmod +x</code>ï¼‰</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">#!/bin/sh</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">case</span> <span class="va">$1</span><span class="kw"> in</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    start<span class="kw">)</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="fu">mkdir</span> -p /opt</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="fu">mount</span> -o bind /volume1/@entware-ng/opt /opt</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="ex">/opt/etc/init.d/rc.unslung</span> start</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="kw">;;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    stop<span class="kw">)</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="kw">;;</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="kw">esac</span></a></code></pre></div></li>
<li><p>åœ¨ç™»å…¥æ™‚è‡ªå‹•æŠŠ <code>/opt/bin</code> <code>/opt/sbin</code>åŠ åˆ° <code>PATH</code> è£¡é¢ï¼šåœ¨ /etc/profile å…§åŠ ä¸Šä¸€è¡Œ</p>
<pre><code>. /opt/etc/profile</code></pre></li>
</ul>
<p>è£å®Œä¹‹å¾Œå°±æ˜¯é–‹å¿ƒåœ°ä¾†è£ shadowsocks</p>
<pre><code>opkg update
opkg install shadowsocks-libev</code></pre>
<p><del>ä½†æ˜¯è£å®Œå»ç™¼ç¾æ²’æœ‰ <code>ss-server</code> é€™å€‹åŸ·è¡Œæª”ï¼åŸå› ä¼¼ä¹æ˜¯å› ç‚º entware-ng æ²’æœ‰è·Ÿä¸Šæµçš„ openwrt åŒæ­¥ <span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote"><a href="https://github.com/Entware-ng/entware-packages/commit/e3793bbbde8b907842f84731bfec292ccb069114" class="uri">https://github.com/Entware-ng/entware-packages/commit/e3793bbbde8b907842f84731bfec292ccb069114</a><br />
<br />
</span></span>ï¼Œè€Œä¸çŸ¥ç‚ºä½•çš„æ˜æ˜å°±æœ‰æ–°çš„ Makefile ï¼Œé™¤äº† mipsel ä»¥å¤–å»æ²’æœ‰æ–°çš„ binary package èƒ½ç”¨ã€‚</del></p>
<section id="æ›´æ–°" class="level3">
<h3>2017/10/12 æ›´æ–°</h3>
<p>å‰ä¸€é™£å­ entware æœ‰è·Ÿä¸Šæ¸¸åŒæ­¥éï¼Œæ‰€ä»¥ç›´æ¥å®‰è£ <code>shadowsocks-libev-ss-server</code> è·Ÿ <code>shadowsocks-libev-config</code> å°±è¡Œäº†</p>
<pre><code>opkg install shadowsocks-libev-config
opkg install shadowsocks-libev-ss-server</code></pre>
</section>
</section>
<section id="æ‰‹å‹•ç·¨è­¯" class="level2">
<h2>æ‰‹å‹•ç·¨è­¯</h2>
<p>æ²’è¾¦æ³•ï¼Œåªå¥½ä¾†è‡ªå·±ç·¨ã€‚å¹¸å¥½ entware çš„ wiki é ä¸Šä¹Ÿæœ‰<a href="https://github.com/Entware-ng/Entware-ng/wiki/Compile-packages-from-sources">æ•™å­¸</a>ï¼Œä¹Ÿæ˜¯ç…§è‘—åšå°±å¥½ã€‚</p>
<p>Entware-ng ç”¨çš„æ˜¯ OpenWrt Buildrootï¼Œæ‰€ä»¥éœ€è¦å…ˆè£å¥½<a href="http://wiki.openwrt.org/doc/howto/buildroot.exigence#install_procedure_on_linux">å®ƒä¾è³´çš„å¥—ä»¶</a>ã€‚</p>
<p>ç‚ºäº†ä¸æŠŠä¸»åŠ›æ©Ÿçš„ Arch Linux çµ¦æé«’äº†ï¼Œæˆ‘æ±ºå®šç”¨æ‰¾ docker çš„æ–¹å¼ä¾†è§£æ±ºã€‚<br />
ç¶²è·¯ä¸Šå¯ä»¥æ‰¾åˆ°ä¸€å€‹ç”¨ arch ç‚ºåº•çš„ Dockerfile(<a href="https://github.com/jannispinter/arch-openwrt-buildroot">arch-docker-buildroot</a>)ï¼Œä½†æ˜¯å¯¦éš›ç·¨è­¯æ™‚æœƒå‡ºå…ˆä¸€äº›ç‰ˆæœ¬ä¸Šçš„ä¸ç›¸å®¹å•é¡Œï¼Œæ‰€ä»¥æˆ‘é‚„æ˜¯ä¹–ä¹–çš„ç”¨ ubuntu çš„ image ä¾†åšã€‚</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">FROM</span> ubuntu</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">RUN</span> apt-get update</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">RUN</span> DEBIAN_FRONTEND=noninteractive apt-get install -y build-essential subversion libncurses5-dev zlib1g-dev gawk gcc-multilib flex git-core gettext libssl-dev unzip python-dev python file wget sudo</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># ç·¨è­¯æ™‚éœ€è¦é root å¸³è™Ÿ</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="kw">RUN</span> useradd -m openwrt &amp;&amp;\</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">echo <span class="st">&#39;openwrt ALL=NOPASSWD: ALL&#39;</span> &gt; /etc/sudoers.d/openwrt</a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="kw">USER</span> openwrt</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="kw">WORKDIR</span> /home/openwrt</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="kw">CMD</span> [<span class="st">&quot;/bin/bash&quot;</span>]</a></code></pre></div>
<p>docker ç’°å¢ƒæº–å‚™å¥½ã€é€²å…¥å…¶ shell ä¹‹å¾Œ<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="sidenote">æˆ‘ç”¨ä¸åŒçš„é¡è‰²ä¾†å€åˆ¥ docker ç’°å¢ƒå…§çš„æ“ä½œ<br />
<br />
</span></span></p>
<ul>
<li><p>æº–å‚™ entware è·Ÿæ›´æ–°å…¶ package feedsï¼š</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash example"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="fu">git</span> clone https://github.com/Entware-ng/Entware-ng.git</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="bu">cd</span> Entware-ng</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="fu">make</span> package/symlinks</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="fu">cp</span> configs/armv7.config .config</a></code></pre></div></li>
<li><p>å®‰è£ç·¨è­¯éœ€è¦ tools/toolchainï¼Œé€™ä¸€æ­¥é©Ÿéœ€è¦å¾ˆé•·ä¸€æ®µæ™‚é–“ï¼Œæˆ‘å°±è·‘å»æ‰“ Splatoon çš„ Salmon Run äº†ã€‚</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash example"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="fu">make</span> -j4 tools/install</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="fu">make</span> -j4 toolchain/install</a></code></pre></div></li>
<li><p><strong>ç¢ºèª .config è£¡é¢æœ‰å•Ÿç”¨ <code>shadowsocks-libev</code> è·Ÿ <code>shadowsocks-libev-ss-server</code> å…©å€‹å¥—ä»¶</strong>ï¼Œæˆ‘åœ¨ç·¨çš„æ™‚å€™æ²’ç¢ºèªåˆ°é€™é»ï¼ŒèŠ±äº†å¥½ä¸€æ®µæ™‚é–“ç ”ç©¶ç‚ºä»€éº¼ç·¨å®Œæ²’æœ‰ binary æª”ã€‚</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash example"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="fu">make</span> menuconfig <span class="co"># é¸å¥½ shadowsocks ï¼ˆNetwork çš„ Web Servers/Proxies åº•ä¸‹ï¼‰</span></a></code></pre></div>
<p>æˆ–æ˜¯ç›´æ¥åœ¨ .config åŠ ä¸Š</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash example"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="ex">CONFIG_PACKAGE_shadowsocks-libev-config</span>=m</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="ex">CONFIG_PACKAGE_shadowsocks-libev-ss-server</span>=m</a></code></pre></div></li>
<li><p>ç„¶å¾Œç·¨è­¯éœ€è¦çš„å¥—ä»¶</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash example"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="fu">make</span> -j4 package/shadowsocks-libev/compile</a></code></pre></div></li>
</ul>
<p>ç·¨è­¯å®Œä¹‹å¾Œæœƒåœ¨ bin ä¸‹é¢æ‰¾åˆ°å°æ‡‰çš„ .ipkg æª”ï¼Œæ¥è‘—å°±æ˜¯å‚³åˆ° NAS ä¸Š</p>
<ul>
<li><p>ç”¨ opkg å®‰è£ï¼š</p>
<pre><code>opkg install shadowsocks-libev-config_3.0.6-2_armv7soft.ipk
opkg install shadowsocks-libev-ss-server_3.0.6-2_armv7soft.ipk</code></pre></li>
<li><p>è¨­å®šå¥½ <code>/opt/etc/shadowsocks.json</code> è·Ÿ <code>/opt/etc/init.d/S22shadowsocks</code>ï¼š</p>
<pre><code>sed -ir &#39;s/PROCS=ss-local/PROCS=ss-server/&#39; /opt/etc/init.d/S22shadowsocks</code></pre></li>
<li><p>ç¢ºèª shadowsocks-libev å¯ä»¥å•Ÿå‹•</p>
<pre><code>/opt/etc/init.d/S22shadowsocks start</code></pre></li>
</ul>
<p>è¨­å®šå¥½ router çš„ NATï¼Œç„¶å¾Œç”¨æ‰‹æ©Ÿä¹‹é¡çš„æ¸¬è©¦æœƒå‹•ä¹‹å¾Œï¼Œæ”¶å·¥ã€‚</p>
</section>
</section>]]></description>
    <pubDate>Sun, 27 Aug 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-08-27-ds216j-shadowsocks.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>
<item>
    <title>ç”¨ VEGA è³‡æ–™è¦–è¦ºåŒ–</title>
    <link>https://op8867555.github.io/posts/2017-08-11-vega.html</link>
    <description><![CDATA[<section id="tldr" class="level3">
<h3>tl;dr</h3>
<p><a href="https://vega.github.io/vega/">Vega</a> æ˜¯ä¸€å€‹ç¨®æè¿°äº’å‹•è¦–è¦ºåŒ–çš„æ–‡æ³•(JSON è¦æ ¼)ï¼Œç›¸å°æ–¼ä½éšçš„ <a href="https://d3js.org/">d3.js</a>ï¼Œæä¾›äº†ä¸€å€‹ä¸ç”¨ç¢°å¤ªå¤š JavaScript å°±èƒ½ç·¨å¯«åœ–è¡¨çš„é«˜éšå®£å‘Šå¼èªæ³•ã€‚é€™ç¯‡æ–‡ç« ç°¡è¿° <a href="https://vega.github.io/vega/">Vega</a> çš„æ¦‚å¿µï¼Œç„¶å¾Œä»¥ COSCUP 2017 çš„è­°ç¨‹è¡¨ç‚ºé¡Œå¯«äº†ä¸€å€‹ tutorialï¼ˆ<a href="https://vega.github.io/editor/#/gist/vega/op8867555/5af6189b957373bf0ff9969c8e3d426a">å®Œæˆå“</a>ï¼‰ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœåªæœ‰ç°¡å–®çš„è³‡æ–™ï¼ˆcsv, jsonâ€¦ç­‰ï¼‰ï¼Œåˆåªéœ€è¦åŸºæœ¬çš„å¹¾ç¨®åœ–ï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨ <a href="https://vega.github.io/vega-lite/">vega-lite</a> é€™å€‹æ¯” vega é‚„è¦é«˜éšçš„èªè¨€ä¾†åšã€‚</p>
</section>
<section id="vega" class="level1">
<h1>VEGA</h1>
<blockquote>
<p>Vega is a visualization grammar, a declarative language for creating, saving, and sharing interactive visualization designs. With Vega, you can describe the visual appearance and interactive behavior of a visualization in a JSON format, and generate web-based views using Canvas or SVG.</p>
</blockquote>
<p><a href="https://vega.github.io/vega/">Vega</a> æ˜¯ Washington Interactive Data Lab çš„å¦ä¸€å€‹å°ˆæ¡ˆ(å°±æ˜¯é‚£å€‹åš <a href="https://d3js.org/">d3.js</a> çš„ IDL)ï¼Œæå‡ºäº†ä¸€å€‹ JSON æ ¼å¼çš„æ–‡æ³•ï¼Œç”¨ä¾†æè¿°äº’å‹•å¼çš„è¦–è¦ºåŒ–åœ–è¡¨ï¼Œä¹Ÿä¸€ä½µçµ¦äº† JavaScript çš„ Runtime å¯¦ä½œã€‚(èƒŒå¾Œå¾ˆç†æ‰€ç•¶ç„¶çš„ç”¨äº† <a href="https://d3js.org/">d3.js</a> ä½œç‚º backend)</p>
<section id="ç‚ºä»€éº¼ä¸ç”¨-d3-å°±å¥½" class="level2">
<h2>ç‚ºä»€éº¼ä¸ç”¨ d3 å°±å¥½</h2>
<p>é›–ç„¶ä¸å¤ªä¸€æ¨£ï¼Œä½†æ˜¯å¯ä»¥å…ˆçœ‹çœ‹å…©è€…å¯¦ä½œ bar chart çš„æ–¹å¼ï¼š <a href="https://bl.ocks.org/mbostock/3885304">d3</a>, <a href="https://vega.github.io/vega/examples/bar-chart/">vega</a>ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°å¹¾é»ï¼š</p>
<ul>
<li>vega çš„å¯«æ³•å°‘äº†å¾ˆå¤šä¾†è‡ª js èªæ³•çš„é›œè¨Šï¼Œ<br />
ä¹Ÿä¸ç”¨è®“è®Šæ•¸åç¨±ä½”æ‰å¤§è…¦å¯è²´çš„è¨˜æ†¶ç©ºé–“<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote"><a href="https://www.kernel.org/doc/html/v4.10/process/coding-style.html#functions" class="uri">https://www.kernel.org/doc/html/v4.10/process/coding-style.html#functions</a><br />
<br />
</span></span></li>
<li>vega ç”¨äº†ä¸€å€‹ json æ•˜è¿°ä¾†æè¿°è¦–è¦ºåŒ–ï¼Œ<br />
ä½†æ˜¯ d3.js çš„ç‰ˆæœ¬éœ€è¦å¾ html/svg/canvas ç­‰ä½éšçš„å¯¦ä½œç´°ç¯€é–‹å§‹è€ƒæ…®</li>
<li>æ¯”èµ· js ï¼Œ JSON æ ¼å¼æ›´å¥½è‡ªå‹•ç”Ÿæˆï¼Œä¹Ÿå°±æ˜¯æ›´å¥½ä¸²æ¥åœ¨å…¶ä»–æ‡‰ç”¨</li>
</ul>
<p>Vega åœ˜éšŠ<a href="https://github.com/vega/vega/wiki/Vega-and-D3">æœ‰è¬›æ˜</a> Vega çš„ç›®çš„ä¸¦ä¸æ˜¯è¦å–ä»£ d3.js ï¼Œè€Œæ˜¯åœ¨ d3.js çš„åŸºç¤ä¸Šï¼Œå»ºç«‹æ›´é«˜å±¤åº¦çš„è¦–è¦ºåŒ–ã€‚</p>
</section>
<section id="é•·ä»€éº¼æ¨£å­" class="level2">
<h2>é•·ä»€éº¼æ¨£å­</h2>
<p>å®˜ç¶²çµ¦çš„ä¸€å€‹ bar chart çš„ç¯„ä¾‹é•·çš„åƒ<a href="https://vega.github.io/vega/examples/bar-chart/">é€™æ¨£</a>ï¼Œå¯ä»¥ç™¼ç¾å¹¾ä¹çœ‹ä¸åˆ°ç¨‹å¼ç¢¼ã€‚</p>
<p>ä¸‹é¢é€™å€‹æ˜¯å¾ <a href="https://vega.github.io/vega/docs/specification/">specification</a> æŠ„ä¾†çš„åŸºæœ¬æ¬¾ outline</p>
<ul>
<li>ä¸ŠåŠéƒ¨æ˜¯é™¤äº† <code>$schema</code> ä¹‹å¤–ï¼Œæ˜¯ä¸€äº›é—œæ–¼æ•´å¼µåœ–çš„ top-level è¨­å®š</li>
<li>ä¸‹åŠéƒ¨ <code class="sourceCode javascript">[]</code> åˆ†åˆ¥é‚„éœ€è¦å¡«å…¥é©ç•¶çš„å…§å®¹ã€‚</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="dt">&quot;$schema&quot;</span><span class="fu">:</span> <span class="st">&quot;https://vega.github.io/schema/vega/v3.0.json&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;A specification outline example.&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="dt">&quot;width&quot;</span><span class="fu">:</span> <span class="dv">500</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  <span class="dt">&quot;height&quot;</span><span class="fu">:</span> <span class="dv">200</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="dt">&quot;padding&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="dt">&quot;autosize&quot;</span><span class="fu">:</span> <span class="st">&quot;pad&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  <span class="dt">&quot;signals&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  <span class="dt">&quot;data&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">  <span class="dt">&quot;scales&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  <span class="dt">&quot;projections&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">  <span class="dt">&quot;axes&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  <span class="dt">&quot;legends&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  <span class="dt">&quot;marks&quot;</span><span class="fu">:</span> <span class="ot">[]</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="fu">}</span></a></code></pre></div>
<ul>
<li><code>signals</code> æä¾›ä¸€å€‹ reactive çš„æ–¹æ³•ä¾†åšäº’å‹•äº‹ä»¶ï¼š æ»‘é¼ ç§»å‹•ã€å…§å»ºçš„æŒ‰éˆ•ã€ç¯„åœé¸æ“‡å™¨ä¹‹é¡çš„</li>
<li><code>data</code> ç”¨ä¾†è¼‰å…¥ã€parseã€è½‰æ›ï¼Œä¸€äº›ç°¡å–®çš„è³‡æ–™è™•ç† (filter, aggregation ä¹‹é¡çš„éƒ½å¯ä»¥åœ¨é€™è£¡åšæ‰)ã€‚</li>
<li><code>scales</code> ç”¨ä¾†æ˜ å°„è³‡æ–™çš„ domain è·Ÿ è¼¸å‡ºçš„ range (XY åº§æ¨™/ é¡è‰²ç­‰)ã€‚</li>
<li><code>projections</code> ç”¨ä¾†å°‡ç¶“ç·¯åº¦æŠ•å½±åˆ°åº§æ¨™å¹³é¢ã€‚</li>
<li><code>axes</code> å¯ä»¥æŒ‡å®šåœ–çš„çš„åº§æ¨™è»¸çš„ä½ç½®ã€åˆ»åº¦ã€‚</li>
<li><code>legends</code> æ˜¯åœ–çš„åœ–ä¾‹ã€‚</li>
<li><code>marks</code> ç”¨ä¾†ç•«å‡ºæŠ˜ç·šã€é¢ç©ã€çŸ©å½¢â€¦ç­‰æ‰€æœ‰è¡¨ç¾è³‡æ–™çš„éƒ¨ä»½ï¼Œæ˜¯æ•´å¼µåœ–æ ¸å¿ƒçš„éƒ¨ä»½ã€‚</li>
</ul>
<p>ç•«åœ–æ‰€éœ€è¦çš„å…ƒç´  VEGA åœ˜éšŠéƒ½é©ç•¶çš„è¨­è¨ˆäº†å‡ºä¾†ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä½¿ç”¨è€…ä¾ç…§éœ€æ±‚å¡«ç©ºäº†ã€‚</p>
</section>
<section id="å¦‚ä½•é–‹å§‹" class="level2">
<h2>å¦‚ä½•é–‹å§‹</h2>
<p>å¦‚æœæƒ³è¦é–‹å§‹ä½¿ç”¨ï¼Œå¯ä»¥å…ˆçœ‹å®˜æ–¹ç¶²ç«™ä¸Šçš„å…©å€‹ tutorials å¯«çš„ç°¡å–®å¥½æ‡‚ï¼ˆç•¶ç„¶é‚„æ˜¯éœ€è¦çœ‹ documentation å°±æ˜¯äº†ï¼‰</p>
<ul>
<li><a href="https://vega.github.io/vega/tutorials/bar-chart/">Letâ€™s Make A Bar Chart</a> ä»‹ç´¹äº†æœ€åŸºæœ¬çš„å¹¾å€‹å…ƒç´ : data, scale, axes, marks, signals</li>
<li><a href="https://vega.github.io/vega/tutorials/airports/">Mapping Airport Connections</a> é€²ä¸€æ­¥æ‡‰ç”¨äº† data transform, projections, signals</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå®˜æ–¹ç¶²ç«™ä¸Šä¹Ÿæœ‰ä¸€å€‹ç·šä¸Šçš„ WYSIWYG ç·¨è¼¯å™¨ï¼š <a href="https://vega.github.io/editor">Vega Editor</a>ï¼Œè£¡é¢æœ‰å¾ˆå¤šç¯„ä¾‹å¯ä»¥ <del>å¡—å¡—æ”¹æ”¹</del> åƒè€ƒã€‚</p>
<p>å‰©ä¸‹çš„å°±æ˜¯è®€<a href="https://vega.github.io/vega/docs/">æ–‡ä»¶</a>å•¦ã€‚</p>
</section>
</section>
<section id="tutorial" class="level1">
<h1>tutorial</h1>
<p>å› ç‚ºé€™æ¬¡ COSCUP 2017 å®˜ç¶²æœ€æ—©æ²’æœ‰é‡‹å‡ºæ™‚é–“ç·šå½¢å¼çš„è­°ç¨‹è¡¨ï¼Œä½†æ˜¯æœ‰çµ¦è¶³è‡ªå¹¹éœ€è¦çš„è³‡æ–™ï¼Œ å°±ç™¼ç¾<a href="https://docs.google.com/spreadsheets/d/1gVQtWEqOZLsDtk1j-_TrPqq_nWN5VcTtWLpme3yl3Zc/edit#gid=98295178">å¤§å®¶éƒ½è‡ªå¹¹äº†ä¸€ä»½</a>ï¼Œæ–¼æ˜¯æˆ‘å°±ç”¨ vega ä¹Ÿå…œäº†ä¸€å€‹ç°¡å–®çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±é †ä¾¿ä»¥æ­¤ç‚ºåŸå½¢ï¼Œå¯«äº†é€™ç¯‡ tutorialã€‚</p>
<p><em>é€™ç¯‡ tutorial æœƒç°¡è¿°æ€éº¼å¾é›¶é–‹å§‹åˆ°åšå‡ºä¸€å€‹é€™æ¨£è­°ç¨‹è¡¨</em></p>
<p><img src="http://i.imgur.com/HUAwF8k.png" class="half-page center" /></p>
<section id="æº–å‚™" class="level2">
<h2>æº–å‚™</h2>
<p>æ‰“é–‹ <a href="https://vega.github.io/editor">Vega Editor</a>ï¼Œå°±å¯ä»¥é–‹å§‹äº†ã€‚</p>
</section>
<section id="top-level" class="level2">
<h2>top-level</h2>
<p>é¦–å…ˆè¦å…ˆæœ‰å€‹æœ€ç°¡å–®çš„é››å‹ï¼Œå®£å‘Š schema ç‰ˆæœ¬ã€åœ–çš„å¤§å°ç­‰</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">// vg.json</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="st">&quot;$schema&quot;</span><span class="op">:</span> <span class="st">&quot;https://vega.github.io/schema/vega/v3.0.json&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="st">&quot;width&quot;</span><span class="op">:</span> <span class="dv">480</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="st">&quot;height&quot;</span><span class="op">:</span> <span class="dv">1600</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="st">&quot;padding&quot;</span><span class="op">:</span> <span class="dv">50</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="op">}</span></a></code></pre></div>
</section>
<section id="data" class="level2">
<h2>Data</h2>
<p>é€™æ¬¡çš„è³‡æ–™æ˜¯ COSCUP 2017 å®˜ç¶²æ‰€ä½¿ç”¨çš„ <a href="https://coscup.org/2017-assets/json/submissions.json">submissions.json</a>ï¼Œæ˜¯ä¸€å€‹ array of records ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">// submissions.json</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">[</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">// æˆ‘éš¨ä¾¿ç¯€éŒ„äº†ä¸€å€‹è­°ç¨‹ï¼Œå…©å¤©æ‰€æœ‰çš„è­°ç¨‹éƒ½åœ¨é€™å€‹ array è£¡é¢</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="op">{</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="st">&quot;room&quot;</span><span class="op">:</span> <span class="st">&quot;202&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="st">&quot;community&quot;</span><span class="op">:</span> <span class="st">&quot;Chinese ä¸­æ–‡&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="st">&quot;subject&quot;</span><span class="op">:</span> <span class="st">&quot;Unicode ä¸æ˜¯å¹´å¹´æ›´æ–°å—ï¼Œ2017 æ€éº¼é‚„åœ¨ç¼ºå­—ï¼Ÿ&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="st">&quot;summary&quot;</span><span class="op">:</span> <span class="st">&quot;ç¶­åŸºæ–‡åº«æ˜¯ç¶­åŸºåª’é«”åŸºé‡‘æœƒæ‰€å±¬è¨ˆç•«ä¸­æœ‰é—œåŸå§‹æ–‡ç»å…¸è—çš„ç¶²ç«™ï¼Œè€Œä¸­æ–‡çš„ç¶­åŸºæ–‡åº«å› æ­¤é‡åˆ°å…¶ä»–ç¶­åŸºè¨ˆç•«ä¸æ›¾é‡åˆ°çš„å•é¡Œâ€“æš´é‡çš„å¤ç±ç¼ºå­—ã€‚å°ç£çš„ç¶­åŸºåˆ†æœƒåœ¨ç¶“æ‰‹å³å®ˆç¦®åœ‹è‡ºå° ç…§æ´»ç”¨è¾­å…¸çš„ç¾ä»£æ•¸ä½åŒ–ä¹‹è¨ˆç•«ä¸­ï¼Œä¹Ÿé‡åˆ°äº†åš´é‡çš„ç¼ºå­—å•é¡Œï¼Œå¥½åœ¨ç¾åœ¨é–‹æºå‹•æ…‹çµ„å­—æŠ€è¡“å·²ç¶“ç™¼å±•æˆç†Ÿï¼Œå¯ä»¥æ•´åˆåˆ°ç¶­åŸºç¶²ç«™è£¡ï¼Œæœ¬è­°é¡Œå°‡åˆ†äº«è©²å°ˆæ¡ˆé‹ç”¨æ­¤æ–°å¼ç¼ºå­—è™•ç†æŠ€è¡“çš„é»æ»´ã€ç›®å‰ç“¶é ¸ã€æœªä¾†çš„å±•æœ›ã€‚&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="st">&quot;start&quot;</span><span class="op">:</span> <span class="st">&quot;2017-08-05T16:20:00+08:00&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="st">&quot;end&quot;</span><span class="op">:</span> <span class="st">&quot;2017-08-05T17:00:00+08:00&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    <span class="st">&quot;original_speakerpic&quot;</span><span class="op">:</span> <span class="st">&quot;http://imgur.com/q0j6fda&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    <span class="st">&quot;lang&quot;</span><span class="op">:</span> <span class="st">&quot;ZH&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    <span class="st">&quot;speaker&quot;</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;å¼µæ­£ä¸€&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15">      <span class="st">&quot;avatar&quot;</span><span class="op">:</span> <span class="st">&quot;https://coscup.org/2017-assets/images/program/202-2017-08-05T1515.jpg&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">      <span class="st">&quot;bio&quot;</span><span class="op">:</span> <span class="st">&quot;ç¶­åŸºå”æœƒç†äº‹ï¼Œç¶­åŸºå³å®ˆç¦®å°èªè¾­å…¸ç¾ä»£æ•¸ä½åŒ–è¨ˆç•« PMï¼Œå‹•æ…‹çµ„å­—æŠ€è¡“é–‹ç™¼é•·æœŸåƒèˆ‡è€…&quot;</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">  <span class="op">},</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">// é‚„æœ‰æ›´å¤š...</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20">]</a></code></pre></div>
<p>Vega æ”¯æ´è®€å– array of records çš„è³‡æ–™ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥å°‡ä»–è®€é€²ä¾†ï¼Œç„¶å¾Œé †ä¾¿å°æ™‚é–“æ¬„ä½åš parse ï¼š</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">// vg.json</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="op">{</span> <span class="co">// å‰ç•¥</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="st">&quot;data&quot;</span><span class="op">:</span>[</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    <span class="op">{</span> <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;table&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">       <span class="st">&quot;url&quot;</span><span class="op">:</span> <span class="st">&quot;https://coscup.org/2017-assets/json/submissions.json&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">       <span class="st">&quot;format&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;type&quot;</span><span class="op">:</span><span class="st">&quot;json&quot;</span><span class="op">,</span> <span class="st">&quot;parse&quot;</span><span class="op">:{</span><span class="st">&quot;start&quot;</span><span class="op">:</span><span class="st">&quot;date&quot;</span><span class="op">,</span> <span class="st">&quot;end&quot;</span><span class="op">:</span> <span class="st">&quot;date&quot;</span><span class="op">}}</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  ]</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="op">}</span></a></code></pre></div>
<p>å¦‚æœç”¨çš„æ˜¯ Vega Editor çš„è©±ï¼Œå¯ä»¥æ‰“é–‹ developer console (chrome çš„è©±æŒ‰ <key>Ctrl</key> + <key>Shift</key> + <key>J</key>) åŸ·è¡Œï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="va">VEGA_DEBUG</span>.<span class="va">view</span>.<span class="at">data</span>(<span class="st">&#39;table&#39;</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">// (141) [Object, Object, Object, Object, Object, Object, Object, Object, Object, Object, â€¦]</span></a></code></pre></div>
<p>å¯ä»¥è§€å¯Ÿåˆ°è³‡æ–™æœ‰æ­£ç¢ºè¼‰å…¥ã€‚</p>
</section>
<section id="scale-axes" class="level2">
<h2>Scale, Axes</h2>
<p>è¼‰å…¥è³‡æ–™ä¹‹å¾Œã€æŠŠåœ–ç•«å‡ºä¾†ä¹‹å‰ï¼Œéœ€è¦å…ˆå°‡è³‡æ–™çš„ç¯„åœæ˜ å°„åœ–çš„X/Yåº§æ¨™ï¼š</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">// vg.json çš„ç‰‡æ®µ</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="st">&quot;scales&quot;</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;xscale&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">      <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;band&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">      <span class="st">&quot;domain&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;data&quot;</span><span class="op">:</span> <span class="st">&quot;table&quot;</span><span class="op">,</span> <span class="st">&quot;field&quot;</span><span class="op">:</span> <span class="st">&quot;room&quot;</span><span class="op">,</span> <span class="st">&quot;sort&quot;</span><span class="op">:</span> <span class="kw">true</span><span class="op">},</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">      <span class="st">&quot;range&quot;</span><span class="op">:</span> <span class="st">&quot;width&quot;</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    <span class="op">},</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">    <span class="op">{</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;yscale&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">      <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;time&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12">      <span class="st">&quot;domain&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;data&quot;</span><span class="op">:</span> <span class="st">&quot;table&quot;</span><span class="op">,</span> <span class="st">&quot;fields&quot;</span><span class="op">:</span> [<span class="st">&quot;start&quot;</span><span class="op">,</span> <span class="st">&quot;end&quot;</span>]<span class="op">},</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13">      <span class="st">&quot;range&quot;</span><span class="op">:</span> <span class="st">&quot;height&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14">      <span class="st">&quot;reverse&quot;</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16">  ]</a></code></pre></div>
<p>æ¯å€‹ scale éƒ½è¦æœ‰å°æ‡‰çš„åå­— <code>name</code> è·Ÿé¡å‹ <code>type</code> ï¼Œé€™é‚Šæˆ‘åˆ†åˆ¥å®šç¾©äº†ï¼š</p>
<p><code>xscale</code></p>
<ul>
<li><code>band</code> å¯ä»¥åšå‡º categorical åˆ†æ®µçš„æ•ˆæœ(æƒ³åƒä¸€ä¸‹ bar chartï¼Œçœ‹ä¸€ä¸‹<a href="https://vega.github.io/vega/docs/scales/#band">é€™å¼µåœ–</a>)</li>
<li><code>sort</code> å¥½è®“å ´åœ°ä¾ç…§é †åºé¡¯ç¤º</li>
<li><code>range</code> è¨­å®šæˆ <code>width</code> æŒ‡çš„æ˜¯ top-level çš„è¨­å®š</li>
</ul>
<p><code>yscale</code></p>
<ul>
<li><code>time</code> å‘Šè¨´ vega æˆ‘ç”¨çš„è³‡æ–™æ˜¯å€‹æ™‚é–“</li>
<li><code>fields</code> æŒ‡å®š <code>domain</code> çš„æœ€å°æœ€å¤§å€¼ä¾†è‡ªå“ªå€‹æ¬„ä½</li>
<li><code>reverse</code> ç”¨ä¾†åè½‰è»¸çš„å¤§å°ï¼Œè®“å…ˆç™¼ç”Ÿçš„æœ‰æ¯”è¼ƒé«˜çš„å€¼ï¼Œé¡¯ç¤ºåœ¨åœ–çš„ä¸Šæ–¹</li>
</ul>
<p>æˆ‘å€‘å¯ä»¥ç•«å¹¾å€‹åº§æ¨™è»¸ï¼ˆä½¿ç”¨å‰é¢å®šç¾©çš„scaleï¼‰ä¾†è§€å¯Ÿï¼š</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">// vg.json çš„ç‰‡æ®µ</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="st">&quot;axes&quot;</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    <span class="op">{</span> <span class="st">&quot;orient&quot;</span><span class="op">:</span> <span class="st">&quot;top&quot;</span><span class="op">,</span> <span class="st">&quot;scale&quot;</span><span class="op">:</span> <span class="st">&quot;xscale&quot;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="op">{</span> <span class="st">&quot;orient&quot;</span><span class="op">:</span> <span class="st">&quot;bottom&quot;</span><span class="op">,</span> <span class="st">&quot;scale&quot;</span><span class="op">:</span> <span class="st">&quot;xscale&quot;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="op">{</span> <span class="st">&quot;orient&quot;</span><span class="op">:</span> <span class="st">&quot;left&quot;</span><span class="op">,</span> <span class="st">&quot;scale&quot;</span><span class="op">:</span> <span class="st">&quot;yscale&quot;</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">  ]</a></code></pre></div>
</section>
<section id="marks" class="level2">
<h2>Marks</h2>
<p>æˆ‘å¸Œæœ›å°‡æ¯å€‹è­°ç¨‹ç”¨æ–¹å¡Šçš„æ–¹å¼ç•«å‡ºä¾†ï¼Œåšå‡ºæ™‚é–“è¡¨çš„çš„æ•ˆæœã€‚</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">// vg.json çš„ç‰‡æ®µ</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="st">&quot;marks&quot;</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    <span class="op">{</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">      <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;rect&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">      <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;data&quot;</span><span class="op">:</span><span class="st">&quot;table&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">      <span class="st">&quot;encode&quot;</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">        <span class="st">&quot;update&quot;</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">          <span class="st">&quot;xc&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;scale&quot;</span><span class="op">:</span> <span class="st">&quot;xscale&quot;</span><span class="op">,</span> <span class="st">&quot;field&quot;</span><span class="op">:</span> <span class="st">&quot;room&quot;</span><span class="op">,</span> <span class="st">&quot;band&quot;</span><span class="op">:</span><span class="fl">0.5</span><span class="op">},</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">          <span class="st">&quot;width&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;scale&quot;</span><span class="op">:</span> <span class="st">&quot;xscale&quot;</span><span class="op">,</span> <span class="st">&quot;band&quot;</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">},</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">          <span class="st">&quot;y&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;scale&quot;</span><span class="op">:</span> <span class="st">&quot;yscale&quot;</span><span class="op">,</span> <span class="st">&quot;field&quot;</span><span class="op">:</span> <span class="st">&quot;start&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">          <span class="st">&quot;y2&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;scale&quot;</span><span class="op">:</span> <span class="st">&quot;yscale&quot;</span><span class="op">,</span> <span class="st">&quot;field&quot;</span><span class="op">:</span> <span class="st">&quot;end&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12">        <span class="op">}</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">      <span class="op">}</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14">    <span class="op">}</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">  ]</a></code></pre></div>
<ul>
<li>æ¯å€‹ mark éƒ½è¦æœ‰å°æ‡‰çš„ <code>type</code>ï¼Œé€™é‚Šé¸ç”¨æ–¹å¡Š(<code>rect</code>)</li>
<li>ç”¨ <code>from</code> ä¾†æŒ‡å®šè³‡æ–™ä¾†æº</li>
</ul>
<p><code>encode</code> çš„éƒ¨ä»½ç”¨ä¾†æŒ‡å®šç•«åœ–æ™‚çš„åƒæ•¸ï¼Œå»ºè­°å…ˆçœ‹ä¸€ä¸‹<a href="https://vega.github.io/vega/docs/marks/">æ–‡ä»¶</a> è·Ÿ <a href="https://bost.ocks.org/mike/join/">Thinking with Joins</a></p>
<ul>
<li><code>xc</code> ç”¨ä¾†æŒ‡å®š æ•´å€‹æ–¹å¡Šçš„ä¸­å¿ƒåº§æ¨™ï¼Œ<code>band</code> æ˜¯ç‚ºäº†èª¿æ•´æ–¹å¡Šçš„ä½ç½®ï¼Œå‘å³ç§»å‹•åŠå€‹ band</li>
<li><code>width</code> ç”¨åŠå€‹ <code>band</code></li>
<li><code>y</code>, <code>y2</code> æŒ‡å®šæ–¹å¡Šçš„ä¸Šç•Œè·Ÿä¸‹ç•Œï¼Œæ„Ÿè¬ scale ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥æŒ‡å®š <code>start</code> è·Ÿ <code>end</code> é€™å…©å€‹æ™‚é–“æ¬„ä½</li>
</ul>
<p>çœ‹èµ·ä¾†ä¸ç³Ÿï¼Œä¸éä¸Šé»é¡è‰²æ‡‰è©²æœƒå¥½çœ‹é»ã€‚æˆ‘ç”¨è­°ç¨‹å±¬æ–¼çš„ç¤¾ç¾¤(<code>community</code>) ä¾†ä¸Šè‰²ã€‚</p>
<ul>
<li>å…ˆå»ºç«‹ä¸€å€‹ scale å¾ç¤¾ç¾¤é¡å‹æ˜ å°„åˆ°é¡è‰²</li>
<li>åœ¨ marks è£¡é¢ä½¿ç”¨é€™å€‹ scale</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">// vg.json çš„ç‰‡æ®µï¼Œscale åº•ä¸‹</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    <span class="op">{</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;color&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">      <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;ordinal&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">      <span class="st">&quot;domain&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;data&quot;</span><span class="op">:</span> <span class="st">&quot;table&quot;</span><span class="op">,</span> <span class="st">&quot;field&quot;</span><span class="op">:</span> <span class="st">&quot;community&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">      <span class="st">&quot;range&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;scheme&quot;</span><span class="op">:</span> <span class="st">&quot;category20&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="op">}</span></a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">// vg.json çš„ç‰‡æ®µï¼Œmarks[0][&quot;encode&quot;] åº•ä¸‹</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    <span class="st">&quot;enter&quot;</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">      <span class="st">&quot;fill&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;scale&quot;</span><span class="op">:</span> <span class="st">&quot;color&quot;</span><span class="op">,</span> <span class="st">&quot;field&quot;</span><span class="op">:</span> <span class="st">&quot;community&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">    <span class="op">}</span></a></code></pre></div>
<p>å¦å¤–ï¼Œå¯ä»¥ç”¨ <code>tooltip</code> å±¬æ€§ä¾†é¡¯ç¤ºè­°ç¨‹çš„ä¸»é¡Œï¼š</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">// vg.json çš„ç‰‡æ®µï¼Œmarks[0][&quot;encode&quot;][&quot;enter&quot;] è£¡é¢</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="st">&quot;tooltip&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;field&quot;</span><span class="op">:</span> <span class="st">&quot;subject&quot;</span><span class="op">}</span></a></code></pre></div>
</section>
<section id="transform" class="level2">
<h2>Transform</h2>
<p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€å¤©è­°ç¨‹çµæŸåˆ°ç¬¬äºŒå¤©è­°ç¨‹çµæŸæœ‰ä¸€å¤§æ®µç©ºé–’ï¼Œå¯ä»¥ç”¨ transform çš„ filter ä¾†é¸æ“‡åªç”¨å“ªä¸€éƒ¨åˆ†çš„è³‡æ–™ã€‚</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">// vg.json çš„ç‰‡æ®µï¼Œdata åº•ä¸‹</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">&quot;transform&quot;</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;filter&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">    <span class="st">&quot;expr&quot;</span><span class="op">:</span> <span class="st">&quot;datum.start &gt;= datetime(2017, 8-1, 5) &amp;&amp; datum.end &lt; datetime(2017, 8-1, 5+1)&quot;</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">]</a></code></pre></div>
<p><code>expr</code> åƒä¸€å€‹ vega ç²¾ç°¡éçš„ javascript subsetï¼Œç”¨ä¾†çµ¦ <code>filter</code> æ±ºå®šä¿ç•™èˆ‡å¦ã€‚</p>
</section>
<section id="signals" class="level2">
<h2>Signals</h2>
<p>æˆ‘ä¸æœƒæ°¸é åªæƒ³çœ‹å…¶ä¸­ä¸€å¤©ï¼Œä¹Ÿä¸å¸Œæœ›è¦çœ‹éš”å¤©çš„è­°ç¨‹é‚„è¦åšä¿®æ”¹é€™ä»½ vega jsonã€‚å¥½åœ¨ vega æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„ signalï¼Œæˆ‘é€™é‚Šé¸ç”¨äº†ä»–ç¾æˆçš„ radio inputï¼šæœƒåœ¨åœ–ä¸Šé¢åŠ ä¸Šä¸€å€‹äº’å‹•çš„ radio buttonï¼Œç„¶å¾Œç¶å®šæˆä¸€å€‹ signalã€‚</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">// vg.json çš„ç‰‡æ®µ</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">&quot;signals&quot;</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    <span class="op">{</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;day&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">      <span class="st">&quot;value&quot;</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">      <span class="st">&quot;bind&quot;</span><span class="op">:</span> <span class="op">{</span><span class="st">&quot;input&quot;</span><span class="op">:</span> <span class="st">&quot;radio&quot;</span><span class="op">,</span> <span class="st">&quot;options&quot;</span><span class="op">:</span> [<span class="dv">5</span><span class="op">,</span> <span class="dv">6</span>]<span class="op">}</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">]</a></code></pre></div>
<p>ç¶å®šéçš„ signal å¯ä»¥ä½œç‚º <code>expr</code> å…§çš„è®Šæ•¸ä½¿ç”¨</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co">// vg.json çš„ç‰‡æ®µï¼Œä¿®æ”¹ data[&quot;transform&quot;][0][&quot;expr&quot;]</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">&quot;expr&quot;</span><span class="op">:</span> <span class="st">&quot;datum.start &gt;= datetime(2017, 8-1, day) &amp;&amp; datum.end &lt; datetime(2017, 8-1, day)&quot;</span></a></code></pre></div>
</section>
<section id="å®Œæˆ" class="level2">
<h2>å®Œæˆ</h2>
<p>ä¸€å€‹ç°¡å–®çš„<a href="https://vega.github.io/editor/#/gist/vega/op8867555/5af6189b957373bf0ff9969c8e3d426a">è­°ç¨‹æ™‚é–“è¡¨</a>å°±å®Œæˆå•¦ï¼ç•¶ç„¶é‚„æœ‰å¾ˆå¤šå¯ä»¥å¢åŠ /æ”¹é€²çš„åœ°æ–¹ï¼Œåƒæ˜¯ï¼š</p>
<ul>
<li>é¡¯ç¤ºæ›´å¤šæƒ…å ±ï¼šè¬›è€…ã€è­°ç¨‹æ‘˜è¦â€¦</li>
<li>è®“åœ–æ›´æ¼‚äº®ï¼šèª¿æ•´æ»‘é¼  hover æ™‚çš„ style â€¦</li>
<li>åŠ ä¸Š Scale Break ï¼Œç›´æ¥çœå»åˆ‡æ›å…©å¤©çš„å‹•ä½œ</li>
<li>æƒ³è¾¦æ³•æ”¯æ´è¡Œå‹•ç€è¦½å™¨ï¼Œæ‰‹æ©Ÿç‰ˆçš„ chrome å°±ä¸æ”¯æ´é¡¯ç¤º tooltip</li>
<li>â€¦</li>
</ul>
</section>
</section>
<section id="ç¸½çµ" class="level1">
<h1>ç¸½çµ</h1>
<p>æˆ‘æœ€å¾Œçš„æˆæœæ”¾åœ¨<a href="https://op8867555.github.io/coscup2017-submissions/index.html">é€™é‚Š</a>ï¼Œé›–ç„¶ä¸å®Œç¾ï¼Œä½†æ˜¯ä¹Ÿè®“æˆ‘åœ¨å¾ˆçŸ­çš„æ™‚é–“å…§å®Œæˆäº†ä¸€å€‹å ªç”¨çš„æˆå“ã€‚</p>
<p><em>åˆ©ç”¨ Vega é€™å€‹å·¥å…·ï¼Œå¯ä»¥è¿…é€Ÿå¾—åšå‡ºç°¡å–®å¥½è®€å¯«ï¼ˆç›¸å°æ–¼ d3.jsï¼‰ï¼Œä½†åˆä¸å¤±å½ˆæ€§çš„è¦–è¦ºåŒ–æˆæœã€‚</em></p>
<p>é¡Œå¤–è©±ï¼Œé›–ç„¶ JSON é‚„ç®—æ˜¯å¥½è®€å¯«ï¼Œä½†æ˜¯å¯¦éš›é‚„æ˜¯ä¸å¤ªé©åˆäººé¡ç›´æ¥ç·¨å¯«ï¼Œè¦çš„è©±ç”¨ YAML æˆ–æ˜¯å†å¹¹ä¸€å€‹ DSL å¯èƒ½æœƒæ¯”è¼ƒæ–¹ä¾¿ã€‚</p>
</section>]]></description>
    <pubDate>Fri, 11 Aug 2017 00:00:00 UT</pubDate>
    <guid>https://op8867555.github.io/posts/2017-08-11-vega.html</guid>
    <dc:creator>Alex Lu</dc:creator>
</item>

    </channel>
</rss>

<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="CLMtF1JkUEd-jPZ3RQateLLiKyn729kaOHg9Hnu_TSo" />
    <title>Alex's Blog - [EN] Use your UNIX toolbox with pandas</title>
    <meta name="robots" content="index, follow" />
    <link rel="alternate" href="../feed.xml" title="Alex Lu's Blog" type="application/atom+xml">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue_grey-indigo.min.css" />
    <link rel="stylesheet" href="../css/default.css" />
    <link rel="stylesheet" href="../css/syntax.css" />
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script defer src="../js/toc.js"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-40612089-3', 'auto');
    ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer ">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <!-- Title -->
          <span class="mdl-layout-title">Alex's Blog</span>
          <a class="mdl-navigation__link" href="../">Home</a>
          <a class="mdl-navigation__link" href="../archive.html">Archive</a>
        </div>
      </header>
      <div class="mdl-layout__drawer">
        <nav class="mdl-navigation" id="drawer">
          <a class="mdl-navigation__link" href="../">
            <i class="material-icons">home</i> Home
          </a>
          <a class="mdl-navigation__link" href="../archive.html">
            <i class="material-icons">folder</i> Archive
          </a>
        </nav>
      </div>
      <main class="mdl-layout__content">
      <div class="page-content">
        <div class="content-grid mdl-grid">
  <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">
    <div class="mdl-card__title mdl-card--expand">
      <h2 class="mdl-card__title-text">[EN] Use your UNIX toolbox with pandas</h2>
    </div>
    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
      <div>
        
        <span>October 13, 2017</span>
      </div>
      
      <div>
      <span>Tags: <a href="../tags/python.html">python</a>, <a href="../tags/pandas.html">pandas</a>, <a href="../tags/data-analysis.html">data-analysis</a>, <a href="../tags/note.html">note</a></span>
      </div>
      
    </div>
    <div class="mdl-color-text--grey-700 mdl-card__supporting-text" id="post-body">
      <p>I do analysis on log / csv / json files with a Python + Pandas + Jupyter Notebook stack at work. These files are so large that I usually need to do some pre-processing before loading them into memory.</p>
<p>UNIX tools are powerful to stream processing files: concatenation, filtering, transforming…, but it is annoying to “context-switch” between Jupyter Notebook and shell. Also, It’s generate immediate files that need to remove later manually, quite annoying.</p>
<p>After some stackoverflow-ing, I found a solution<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> says you can read files in chunks:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">df <span class="op">=</span> pd.concat(process(chunk_df) <span class="co"># do processing in python</span>
               <span class="cf">for</span> chunk_df <span class="kw">in</span> pd.read_csv(<span class="st">'bigdata.csv'</span>, chunksize<span class="op">=</span><span class="dv">10000</span>))</code></pre></div>
<p>But there is a big overhead to create/process immediate data-frames.</p>
<p>Another solution<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> says you can use <code>subprocess</code> with PIPE, a clever idea. So I end up with this:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> pandas <span class="im">as</span> pd
<span class="im">from</span> subprocess <span class="im">import</span> Popen, PIPE

<span class="cf">with</span> Popen(<span class="st">'cat bigdata.csv | grep WHAT_I_CARE_ABOUT | some_transformations'</span>,
           shell<span class="op">=</span><span class="va">True</span>,
           stdout<span class="op">=</span>PIPE) <span class="im">as</span> process:
    df <span class="op">=</span> pd.read_csv(process.stdout)</code></pre></div>
<p>With this trick, I can now do some bash-fu with pandas in Jupyter-Notebook easily.</p>
<p><strong>Reading multiples files</strong></p>
<pre class="shell"><code>cat stats/2017/*/*.csv</code></pre>
<p><strong>JSON query with jq</strong></p>
<pre class="shell"><code>cat data.json | jq '{.loc = .loc}'</code></pre>
<p><strong>filter lines with awk or grep</strong></p>
<pre class="shell"><code>zcat data.csv.gz | grep 'SOME_TAG' | awk '$1 == 2017'</code></pre>
<p><strong>pipe over files in .tar</strong></p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">tar</span> -xOf bigdatas.tar.gz --wildcards <span class="st">&quot;*.data.csv&quot;</span></code></pre></div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://stackoverflow.com/questions/13651117/pandas-filter-lines-on-load-in-read-csv/13653490#13653490">pandas: filter lines on load in read_csv</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="https://stackoverflow.com/questions/39864304/how-to-use-subprocess-and-cat-to-read-in-data-line-by-line/39864368#39864368">How to use subprocess and ‘cat’ to read in data line by line?</a><a href="#fnref2">↩</a></p></li>
</ol>
</div>
    </div>
  </div>
  <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">
    <div class="mdl-card__title mdl-card--expand">
      <h2 class="mdl-card__title-text">Comments</h2>
    </div>
    <div class="mdl-color-text--grey-700 mdl-card__supporting-text" id="disqus_thread">
      <script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
var disqus_config = function () {
this.page.url = "https://op8867555.github.io/posts/2017-10-13-use-your-unix-toolbox-with-pandas.html";
this.page.identifier = "2017-10-13-use-your-unix-toolbox-with-pandas.md";
};
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://alex-lu-blog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  </div>
</div>


      </div>
      </main>
    </div>
  </body>
</html>

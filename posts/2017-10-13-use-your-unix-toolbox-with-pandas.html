<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="CLMtF1JkUEd-jPZ3RQateLLiKyn729kaOHg9Hnu_TSo" />
    <title>Alex's Blog - [EN] Use your UNIX toolbox with pandas</title>
    <meta name="robots" content="index, follow" />
    <link rel="alternate" href="/feed.xml" title="Alex Lu's Blog" type="application/atom+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.3/tufte.min.css" integrity="sha256-RB2fOyr8UMnkP7bVbAtAqgocMxqG+TDqly7ZEjmRJRY=" crossorigin="anonymous" />
    <link rel="stylesheet" href="/css/pandoc.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/syntax.css" />
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-40612089-3', 'auto');
    ga('send', 'pageview');
    </script>
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/contrib/auto-render.js" "></script>
  </head>
  <body>
    <nav>
<a href="../">Home</a>
</nav>
<article>

<header>
<h1 class="title">[EN] Use your UNIX toolbox with pandas</h1>


<p class="byline">October 13, 2017</p>


<p class="byline">Tags: <a href="../tags/python.html">python</a>, <a href="../tags/pandas.html">pandas</a>, <a href="../tags/data-analysis.html">data-analysis</a>, <a href="../tags/note.html">note</a></p>

</header>


<p>I do analysis on log / csv / json files with a Python + Pandas + Jupyter Notebook stack at work. These files are so large that I usually need to do some pre-processing before loading them into memory.</p>
<p>UNIX tools are powerful to stream processing files: concatenation, filtering, transforming…, but it is annoying to “context-switch” between Jupyter Notebook and shell. Also, It’s generate immediate files that need to remove later manually, quite annoying.</p>
<p>After some stackoverflow-ing, I found a solution<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle" /><span class="sidenote"><a href="https://stackoverflow.com/questions/13651117/pandas-filter-lines-on-load-in-read-csv/13653490#13653490">pandas: filter lines on load in read_csv</a><br />
<br />
</span></span> says you can read files in chunks:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1">df <span class="op">=</span> pd.concat(process(chunk_df) <span class="co"># do processing in python</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">               <span class="cf">for</span> chunk_df <span class="kw">in</span> pd.read_csv(<span class="st">'bigdata.csv'</span>, chunksize<span class="op">=</span><span class="dv">10000</span>))</a></code></pre></div>
<p>But there is a big overhead to create/process immediate data-frames.</p>
<p>Another solution<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle" /><span class="sidenote"><a href="https://stackoverflow.com/questions/39864304/how-to-use-subprocess-and-cat-to-read-in-data-line-by-line/39864368#39864368">How to use subprocess and ‘cat’ to read in data line by line?</a><br />
<br />
</span></span> says you can use <code>subprocess</code> with PIPE, a clever idea. So I end up with this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="im">from</span> subprocess <span class="im">import</span> Popen, PIPE</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="cf">with</span> Popen(<span class="st">'cat bigdata.csv | grep WHAT_I_CARE_ABOUT | some_transformations'</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">           shell<span class="op">=</span><span class="va">True</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">           stdout<span class="op">=</span>PIPE) <span class="im">as</span> process:</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    df <span class="op">=</span> pd.read_csv(process.stdout)</a></code></pre></div>
<p>With this trick, I can now do some bash-fu with pandas in Jupyter-Notebook easily.</p>
<p><strong>Reading multiples files</strong></p>
<pre class="shell"><code>cat stats/2017/*/*.csv</code></pre>
<p><strong>JSON query with jq</strong></p>
<pre class="shell"><code>cat data.json | jq '{.loc = .loc}'</code></pre>
<p><strong>filter lines with awk or grep</strong></p>
<pre class="shell"><code>zcat data.csv.gz | grep 'SOME_TAG' | awk '$1 == 2017'</code></pre>
<p><strong>pipe over files in .tar</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="fu">tar</span> -xOf bigdatas.tar.gz --wildcards <span class="st">&quot;*.data.csv&quot;</span></a></code></pre></div>
</article>
<div id="disqus_thread">
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
var disqus_config = function () {
this.page.url = "https://op8867555.github.io/posts/2017-10-13-use-your-unix-toolbox-with-pandas.html";
this.page.identifier = "2017-10-13-use-your-unix-toolbox-with-pandas.md";
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://alex-lu-blog.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

  <script> renderMathInElement(document.body); </script>
  </body>
</html>
